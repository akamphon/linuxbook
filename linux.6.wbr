\chapter{โปร\wbr{}เซส}
ใน\wbr{}บท\wbr{}ที่\wbr{}ผ่าน\wbr{}มา\wbr{}เรา\wbr{}ได้\wbr{}เรียน\wbr{}รู้\wbr{}การ\wbr{}ใช้\wbr{}โปรแกรม\wbr{}คำ\wbr{}สั่ง\wbr{}พื้น\wbr{}ฐาน\wbr{}ต่างๆ\wbr{}ที่\wbr{}ใช้\wbr{}ใน\wbr{}ลิ\wbr{}นุกซ์\wbr{}ไป\wbr{}แล้ว. ใน\wbr{}บท\wbr{}นี้\wbr{}จะ\wbr{}แนะ\wbr{}นำ\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}โดย\wbr{}ซึ่ง\wbr{}ได้\wbr{}แก่\wbr{}ลิ\wbr{}นุกซ์เ\wbr{}คอร์เนล. เนื้อ\wbr{}หา\wbr{}ของ\wbr{}บท\wbr{}นี้\wbr{}ส่วน\wbr{}หนึ่ง\wbr{}จะ\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}กับ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของเ\wbr{}คอร์เนล\wbr{}โดย\wbr{}ใช้\wbr{}มอง\wbr{}ผ่าน\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}เช่น \cmd{ps}, \cmd{kill} เป็นต้น, ช่วย\wbr{}ให้\wbr{}ผู้\wbr{}อ่าน\wbr{}เข้า\wbr{}ใจ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ซึ่ง\wbr{}ได้\wbr{}แก่เ\wbr{}คอร์เนล\wbr{}ได้\wbr{}ดี\wbr{}ยิ่ง\wbr{}ขึ้น.
%ใน\wbr{}บท\wbr{}นี้\wbr{}จะ\wbr{}แนะ\wbr{}นำ\wbr{}โปรแกรม\wbr{}คำ\wbr{}สั่ง\wbr{}ต่างๆ\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}กับ\wbr{}ตัว\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}เช่น\wbr{}คำ\wbr{}สั่ง \cmd{ps}, \cmd{signal} ฯลฯ. การ\wbr{}เรียน\wbr{}รู้\wbr{}คำ\wbr{}สั่ง\wbr{}เหล่า\wbr{}นี้\wbr{}ยัง\wbr{}เป็น\wbr{}การ\wbr{}เรียน\wbr{}รู้\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของเ\wbr{}คอร์เนล\wbr{}ไป\wbr{}ใน\wbr{}ตัว\wbr{}ด้วย.

\section{โปร\wbr{}เซส (process)}\label{sec:process}
นิยาม\wbr{}อย่าง\wbr{}ง่าย\wbr{}ของ\wbr{}โปรแกรม\wbr{}คือ\wbr{}ไฟล์\wbr{}ที่\wbr{}มี\wbr{}เนื้อ\wbr{}หา\wbr{}เป็น\wbr{}ภาษา\wbr{}เครื่อง\wbr{}กล\wbr{}และ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}สามารถ\wbr{}แปล\wbr{}ความ\wbr{}กระทำ\wbr{}การ\wbr{}ได้. ส่วน\wbr{}นิยาม\wbr{}อย่าง\wbr{}ง่าย\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}คือ\wbr{}โปรแกรม\wbr{}ที่\wbr{}กำลัง\wbr{}ทำ\wbr{}งาน\wbr{}อยู่.  เวลา\wbr{}รัน\wbr{}โปรแกรม, เ\wbr{}คอร์เนล\wbr{}จะ\wbr{}อ่าน\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}ไฟล์\wbr{}โปรแกรม\wbr{}เข้า\wbr{}ไป\wbr{}ไว้\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ, และ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}จะ\wbr{}กระทำ\wbr{}การ\wbr{}ตาม\wbr{}คำ\wbr{}สั่ง\wbr{}ต่อ\wbr{}ไป. สภาพ\wbr{}ที่\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}กา\wbr{}รโห\wbr{}ลด\wbr{}ภาษา\wbr{}เครื่อง\wbr{}กล (โปรแกรม) นั้น\wbr{}สู่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}แล้ว\wbr{}กระทำ\wbr{}การ\wbr{}อยู่\wbr{}เรีย\wbr{}กว่า\emph{โปร\wbr{}เซส (process)}\gindex{process}\gindex{โปร\wbr{}เซส}. ใน\wbr{}มุม\wbr{}มอง\wbr{}ของเ\wbr{}คอร์เนล\wbr{}มัก\wbr{}จะ\wbr{}เรียก\wbr{}โปร\wbr{}เซส\wbr{}ว่า\emph{ทาส์ก (task)} ซึ่ง\wbr{}มี\wbr{}ความ\wbr{}หมาย\wbr{}เหมือน\wbr{}กัน.

\begin{figure}[!htb]
\plfigure{.8}{task_switching.eps}{การ\wbr{}สลับ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล.}{task_switching}
\end{figure}


ลิ\wbr{}นุกซ์\wbr{}เป็น\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}แบบ\wbr{}ระบบมัล\wbr{}ติ\wbr{}ทาส์ก, ใน\wbr{}ระบบ\wbr{}มี\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}ลาย\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}งาน\wbr{}หลาย\wbr{}อย่าง\wbr{}พร้อมๆ\wbr{}กัน. ใน\wbr{}ความ\wbr{}เป็น\wbr{}จริง\wbr{}แล้ว\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ซึ่ง\wbr{}เป็น\wbr{}ตัว\wbr{}กระทำ\wbr{}การ\wbr{}ต่างๆ\wbr{}สามารถ\wbr{}ทำ\wbr{}งาน\wbr{}ได้\wbr{}ที\wbr{}ละ\wbr{}หนึ่ง\wbr{}อย่าง, หนึ่ง\wbr{}คำ\wbr{}สั่ง. แต่\wbr{}เนื่อง\wbr{}จาก\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}สั้น\wbr{}มาก\wbr{}ทำ\wbr{}ให้\wbr{}ผู้\wbr{}ใช้\wbr{}รู้\wbr{}สึก\wbr{}เหมือน\wbr{}กับ\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}ลายๆ\wbr{}ตัว\wbr{}ทำ\wbr{}งาน\wbr{}ได้\wbr{}พร้อมๆ\wbr{}กัน. การ\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}เปลี่ยน\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}จาก\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}ไป\wbr{}อีก\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}เรีย\wbr{}กว่า \emph{context switching}\gindex{context switching} คือ\wbr{}เนื้อ\wbr{}หา\wbr{}การ\wbr{}ทำ\wbr{}งาน, ข้อ\wbr{}มูล\wbr{}ที่\wbr{}ต้อง\wbr{}จัด\wbr{}การ\wbr{}เปลี่ยน\wbr{}ไป. หน่วย\wbr{}ประมวล\wbr{}เป็น\wbr{}ตัว\wbr{}ที่\wbr{}คำนวณ\wbr{}ข้อ\wbr{}มูล, เรียก\wbr{}อ่าน\wbr{}ข้อ\wbr{}มูล\wbr{}จาก\wbr{}หน่วย\wbr{}ความ\wbr{}จำ, จาก\wbr{}ฮาร์\wbr{}ดิกส์\wbr{}หรือ\wbr{}ฮาร์ดแวร์. การ\wbr{}เรียก\wbr{}อ่าน\wbr{}เขียน\wbr{}ข้อ\wbr{}มูล\wbr{}โดย\wbr{}เฉพาะ\wbr{}ฮาร์ดดิสก์\wbr{}นั้น\wbr{}จะ\wbr{}ใช้\wbr{}เวลา\wbr{}มาก\wbr{}กว่า\wbr{}การ\wbr{}ประมวล\wbr{}ผล. ดัง\wbr{}นั้น\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้อง\wbr{}เขียน\wbr{}อ่าน\wbr{}ข้อ\wbr{}มูล\wbr{}จะ\wbr{}ถูก\emph{บล็อก (block)} และ\wbr{}เปลี่ยน\wbr{}ไป\wbr{}อยู่\wbr{}ใน\wbr{}สภาพ\wbr{}รอ (wait). กล่าว\wbr{}คือ\wbr{}แทน\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}จะ\wbr{}รอ\wbr{}ให้\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}ต้องการ\wbr{}ใช้\wbr{}มา\wbr{}ถึง\wbr{}ก็\wbr{}จะ\wbr{}หยุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}ชั่ว\wbr{}คราว\wbr{}ไป\wbr{}ใช้\wbr{}เวลา\wbr{}ทำ\wbr{}งาน\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}อื่น\wbr{}เพื่อ\wbr{}ไม่\wbr{}ให้\wbr{}เสีย\wbr{}เวลา. พอ\wbr{}ได้\wbr{}รับ \emph{interrupt} จาก\wbr{}ฮาร์ดแวร์\wbr{}นั้นๆ\wbr{}เช่น\wbr{}เรียก\wbr{}อ่าน\wbr{}เขียน\wbr{}ข้อ\wbr{}มูล\wbr{}เสร็จ\wbr{}แล้ว\wbr{}ก็\wbr{}จะ\wbr{}จัด\wbr{}การ\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}อีก\wbr{}ที.


\begin{figure}[!tb]
%\plfigure{.6}{virt_phy.eps}{ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}และ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง.}{virtualmem}
\plfigure{.75}{process.eps}{ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}และ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ.}{process}
\end{figure}

ตาม\wbr{}ทฤษฎี\wbr{}แล้ว, โปร\wbr{}เซส\wbr{}แต่\wbr{}ละ\wbr{}ตัว\wbr{}จะ\wbr{}มี \emph{address space} %
\myvocab{a}{address space}{หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน (virtual memory) ที่\wbr{}โปร\wbr{}เซส\wbr{}สามารถ\wbr{}ใช้\wbr{}ได้. เ\wbr{}คอร์เนล\wbr{}จะแม็ป (map) address space เข้า\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง (physical memory) เวลา\wbr{}ใช้\wbr{}งาน.}%
เป็น\wbr{}ของ\wbr{}ตัว\wbr{}เอง. Address space คือ\wbr{}พื้น\wbr{}ที่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน (virtual memory) เป็น\wbr{}ที่\wbr{}เก็บ\wbr{}ข้อ\wbr{}มูล\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}สำคัญๆ\wbr{}เช่น \emph{code}, %
\myvocab{c}{code}{ส่วน\wbr{}ที่\wbr{}เป็น\wbr{}ข้อ\wbr{}มูล\wbr{}สำหรับ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง.}%
 \emph{data}, %
\myvocab{d}{data}{ส่วน\wbr{}ที่\wbr{}เป็น\wbr{}ข้อ\wbr{}มูล\wbr{}ตัวแปร\wbr{}ส่วน\wbr{}กลาง (global variable) ของ\wbr{}โปร\wbr{}เซส.}%
\emph{stack}. %
\myvocab{s}{stack}{โครง\wbr{}สร้าง\wbr{}ข้อ\wbr{}มูล (data structure) แบบ\wbr{}เข้า\wbr{}ก่อน\wbr{}ออก\wbr{}หลัง (first-in last-out) สำหรับ\wbr{}เก็บ\wbr{}ตัวแปร\wbr{}เฉพาะ\wbr{}ที่ (local variable) ใน\wbr{}ฟังก์ชัน ฯลฯ. พื้น\wbr{}ที่\wbr{}สำหรับ stack จะ\wbr{}อยู่\wbr{}ท้ายๆ\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ.}%
หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}สำหรับ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}สถาปัตยกรรม\wbr{}แบบ 32 บิต\wbr{}จะ\wbr{}มี\wbr{}พื้น\wbr{}ที่ 4GB ($2^{32}$ ไบต์) และ\wbr{}พื้น\wbr{}ที่ 1GB ท้าย\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จะ\wbr{}ใช้\wbr{}โดยเ\wbr{}คอร์เนล. พื้น\wbr{}ที่\wbr{}ที่\wbr{}ใช้\wbr{}โดยเ\wbr{}คอร์เนล\wbr{}จะ\wbr{}เป็น\wbr{}ส่วน\wbr{}เดียว\wbr{}กัน\wbr{}สำหรับ\wbr{}ทุก\wbr{}โปร\wbr{}เซส. เ\wbr{}คอร์เนล\wbr{}เป็น\wbr{}ตัว\wbr{}จัด\wbr{}การ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}โดยแม็ป (map) หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}นี้\wbr{}เข้า\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง (physical memory) ซึ่ง\wbr{}ไม่\wbr{}จำ\wbr{}เป็น\wbr{}ต้องแม็ป\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ทั้ง\wbr{}หมด\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}เข้า\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง. ส่วน\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ไม่\wbr{}จำ\wbr{}เป็น\wbr{}ต้อง\wbr{}อยู่\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}จะ\wbr{}ถูกเ\wbr{}คอร์เนล swap out ไป\wbr{}เก็บ\wbr{}ไว้\wbr{}ที่\wbr{}ฮาร์ดดิสก์\wbr{}ส่วน\wbr{}ที่\wbr{}เป็น swap. เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}ต้อง\wbr{}พยายาม\wbr{}เข้า\wbr{}ถึง address ที่\wbr{}ข้อ\wbr{}มูล\wbr{}ไม่\wbr{}อยู่\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง, จะ\wbr{}เกิด \emph{page fault}\gindex{page fault} คือ\wbr{}มี\wbr{}ข้อ\wbr{}มูล\wbr{}ใน address ที่\wbr{}ระบุ\wbr{}แต่\wbr{}ข้อ\wbr{}มูล\wbr{}นั้น\wbr{}ไม่\wbr{}ได้\wbr{}อยู่\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง, เ\wbr{}คอร์เนล\wbr{}ต้อง\wbr{}ไป\wbr{}ดึง\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}อยู่\wbr{}ใน swap กลับ\wbr{}มา\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง.


เวลา\wbr{}ที่\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}ทำ\wbr{}งาน, หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}จะ\wbr{}ทำ\wbr{}งาน\wbr{}และ\wbr{}ใช้\wbr{}เวลา\wbr{}ใน\wbr{}การ\wbr{}แปล\wbr{}คำ\wbr{}สั่ง\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}นั้นๆ. เวลา\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ทำ\wbr{}งาน\wbr{}จะ\wbr{}มี\wbr{}สภาพ\wbr{}แบบ\wbr{}ใด\wbr{}แบบ\wbr{}หนึ่ง\wbr{}ได้\wbr{}แก่ \emph{user mode}\gindex{user mode} หรือ \emph{kernel mode}\gindex{kernel mode}. เวลา\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}ใน user mode, การ\wbr{}เข้า\wbr{}ถึง\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จะ\wbr{}ถูก\wbr{}จำกัด\wbr{}ไว้\wbr{}ใน\wbr{}ส่วน\wbr{}ที่\wbr{}อนุญาต\wbr{}ให้\wbr{}เข้า\wbr{}ถึง\wbr{}ได้\wbr{}เท่า\wbr{}นั้น\wbr{}และ\wbr{}ไม่\wbr{}สามารถ\wbr{}ใช้\wbr{}ฮาร์ดแวร์\wbr{}ต่างๆ\wbr{}ได้\wbr{}โดย\wbr{}ตรง. การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}ทั่ว\wbr{}ไป\wbr{}จะ\wbr{}อยู่\wbr{}ใน user mode. เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}เรียก\wbr{}ใช้\wbr{}ซิส\wbr{}เต็ม\wbr{}คอล (system call), หน่วย\wbr{}ประมวล\wbr{}จะ\wbr{}เปลี่ยน\wbr{}สภาพ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ไป\wbr{}อยู่\wbr{}ใน kernel mode. ใน kernel mode, หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}สามารถ\wbr{}เข้า\wbr{}ถึง\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ได้\wbr{}ทุก\wbr{}ส่วน\wbr{}และ\wbr{}ติด\wbr{}ต่อ\wbr{}กับ\wbr{}ฮาร์ดแวร์\wbr{}ได้. เมื่อ\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ใน kernel mode แล้ว\wbr{}ก็\wbr{}จะ\wbr{}กลับ\wbr{}ไป\wbr{}เป็น user mode ใหม่. เป็น\wbr{}เช่น\wbr{}นี้\wbr{}ไป\wbr{}เรื่อยๆ.

โปร\wbr{}เซส





\section{สำรวจ\wbr{}โปร\wbr{}เซส}

คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ใช้\wbr{}แสดง\wbr{}ราย\wbr{}การ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}มี\wbr{}อยู่\wbr{}ระบบ\wbr{}ได้\wbr{}แก่ \cmd{ps}\cindex{ps}\refcmd{ps}. คำ\wbr{}สั่ง\wbr{}จะ\wbr{}แสดง\wbr{}ราย\wbr{}การ\wbr{}โปร\wbr{}เซส (ชื่อ\wbr{}โปรแกรม) แบบ foreground และ background ที่\wbr{}เกิด\wbr{}จากเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}นั้น\wbr{}โดย\wbr{}ปริยาย\wbr{}ถ้า\wbr{}ไม่\wbr{}ระบุ\wbr{}อาร์กิวเ\wbr{}มนต์.

\begin{MyExample}[ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{ps} โดย\wbr{}ไม่\wbr{}มี\wbr{}อาร์กิวเ\wbr{}มนต์.]
\begin{MyEx}
$ \cin{ps}
  PID TTY          TIME CMD
10523 pts/1    00:00:00 bash
11556 pts/1    00:00:00 firefox
11595 pts/1    00:00:00 run-mozilla.sh
11600 pts/1    00:00:05 firefox-bin
11690 pts/1    00:00:00 ps
\end{MyEx}
\end{MyExample}%$

ข้อ\wbr{}มูล\wbr{}ที่\wbr{}คำ\wbr{}สั่ง \cmd{ps} แสดง\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item PID (Process ID)\\
โปร\wbr{}เซส\wbr{}ทุก\wbr{}โปร\wbr{}เซส\wbr{}จะ\wbr{}มี\wbr{}เลข\wbr{}ประจำ\wbr{}ตัว\wbr{}เฉพาะ\wbr{}ที่\wbr{}เรีย\wbr{}กว่า\emph{โปร\wbr{}เซส ID (process ID)}\gindex{process!ID} เพื่อ\wbr{}ใช้\wbr{}อ้าง\wbr{}อิง. หมาย\wbr{}เลข\wbr{}โปร\wbr{}เซส\wbr{}จะ\wbr{}เริ่ม\wbr{}ต้น\wbr{}ด้วย 0 จน\wbr{}ถึง 32767\mymemo{ค่า\wbr{}โปร\wbr{}เซส ID สูง\wbr{}สุด\wbr{}สามารถ\wbr{}ดู\wbr{}ได้\wbr{}จาก\wbr{}ไฟล์ \cmd{/proc/sys/kernel/pid\_max}} \cite{ulk}. ถ้า\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}ใหม่\wbr{}เกิด\wbr{}ขึ้น\wbr{}ก็\wbr{}จะ\wbr{}ใช้\wbr{}โปร\wbr{}เซส ID ที่\wbr{}มี\wbr{}ค่า\wbr{}ถัด\wbr{}จาก\wbr{}โปร\wbr{}เซส ID ตัว\wbr{}สุด\wbr{}ท้าย\wbr{}ใน\wbr{}ระบบ\wbr{}ไป\wbr{}เรื่อยๆ. ถ้า\wbr{}โปร\wbr{}เซส ID เกิน 32767 ก็\wbr{}จะ\wbr{}ใช้\wbr{}โปร\wbr{}เซส ID เริ่ม\wbr{}ตั้ง\wbr{}แต่ 0 ใหม่\wbr{}โดย\wbr{}จะ\wbr{}ใช้\wbr{}โปร\wbr{}เซส ID ที่\wbr{}ยัง\wbr{}ไม่\wbr{}ซ้ำ\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}กำลัง\wbr{}ทำ\wbr{}งาน\wbr{}อยู่.
\item TTY (Teletype)\\
โปร\wbr{}เซส\wbr{}แต่\wbr{}ละ\wbr{}โปร\wbr{}เซส\wbr{}จะ\wbr{}มีเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\wbr{}ซึ่ง\wbr{}โดย\wbr{}ปรกติ\wbr{}คือเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ที่\wbr{}รัน\wbr{}โปร\wbr{}เซส\wbr{}นั้น. โปร\wbr{}เซส\wbr{}บาง\wbr{}ตัว\wbr{}ที่\wbr{}ไม่\wbr{}ได้\wbr{}เกิด\wbr{}จาก\wbr{}การ\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง\wbr{}ทางเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}เช่น\wbr{}โปร\wbr{}เซส\wbr{}ของเ\wbr{}ซิฟร์\wbr{}เวอร์\wbr{}ต่างๆ ใน\wbr{}คอลัมน์\wbr{}ที่\wbr{}แสดงเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ควบ\wbr{}คุม\wbr{}จะ\wbr{}เป็น\wbr{}เครื่อง\wbr{}หมาย \cmd{?}.
\item TIME\\
ระยะ\wbr{}เวลา\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}ทำ\wbr{}งาน\wbr{}โดย\wbr{}โปร\wbr{}เซส. ค่า TIME ไม่\wbr{}ใช่\wbr{}ระยะ\wbr{}เวลา\wbr{}ที่\wbr{}รัน\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}จน\wbr{}ถึง\wbr{}ปัจจุบัน\wbr{}แต่\wbr{}เป็น\wbr{}ระยะ\wbr{}เวลา\wbr{}จริง\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}นั้น. ระยะ\wbr{}เวลา\wbr{}นี้\wbr{}สั้น\wbr{}มาก\wbr{}ดัง\wbr{}นั้น\wbr{}ค่า TIME ของ\wbr{}บาง\wbr{}โปร\wbr{}เซ\wbr{}สมี\wbr{}ค่า\wbr{}ประมาณ\wbr{}เป็น\wbr{}ศูนย์.
\item CMD\\
ชื่อ\wbr{}โปร\wbr{}เซส\wbr{}แบบ\wbr{}สั้น\wbr{}ซึ่ง\wbr{}ได้\wbr{}แก่\wbr{}ชื่อ\wbr{}โปรแกรม\wbr{}ที่\wbr{}กระทำ\wbr{}การ.
\end{itemize}

ถ้า\wbr{}ต้องการ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ทั้ง\wbr{}หมด\wbr{}ที่\wbr{}มี\wbr{}อยู่\wbr{}ใน\wbr{}ระบบ\wbr{}ให้\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-e} (everything) หรือ \cmd{-A} (All).
\begin{MyExample}[แสดง\wbr{}โปร\wbr{}เซส\wbr{}ทั้ง\wbr{}หมด\wbr{}ใน\wbr{}ระบบ.]
\begin{MyEx}
$ \cin{ps -e} \mycomment{หรือ} ps -A
  PID TTY          TIME CMD
    1 ?        00:00:04 init
    2 ?        00:00:00 ksoftirqd/0
    3 ?        00:00:00 events/0
    4 ?        00:00:00 kblockd/0
\abb
\end{MyEx}
\end{MyExample}%$

\subsection{โปร\wbr{}เซส\wbr{}และ\wbr{}เจ้า\wbr{}ของ}
ใน\wbr{}ระบบมัล\wbr{}ติ\wbr{}ยูสเ\wbr{}ซอร์, โปร\wbr{}เซส\wbr{}ทุก\wbr{}ตัว\wbr{}จะ\wbr{}มี\wbr{}เจ้า\wbr{}ของ\wbr{}ซึ่ง\wbr{}โดย\wbr{}ปรกติ\wbr{}แล้\wbr{}วจะ\wbr{}เป็น\wbr{}ผู้\wbr{}ที่\wbr{}สร้าง\wbr{}โปร\wbr{}เซส\wbr{}นั้น. การ\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\wbr{}เช่น\wbr{}สั่ง\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}จะ\wbr{}สามารถ\wbr{}ทำ\wbr{}ได้\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เป็น\wbr{}เจ้า\wbr{}ของ\wbr{}เท่า\wbr{}นั้น. แต่\wbr{}สำหรับ\wbr{}ผู้\wbr{}ใช้ root มี\wbr{}สิทธิ์\wbr{}พิเศษ\wbr{}สามารถ\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}ทุก\wbr{}ตัว\wbr{}ใน\wbr{}ระบบ. การ\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}การ\wbr{}ส่ง\wbr{}สัญญาณ (signal) ให้\wbr{}โปร\wbr{}เซส\wbr{}รับ\wbr{}รู้\wbr{}ซึ่ง\wbr{}จะ\wbr{}แนะ\wbr{}นำ\wbr{}ใน\wbr{}ช่วง\wbr{}ถัด\wbr{}ไป (หน้า \pageref{sec:signal}).

เรา\wbr{}สามารถ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-f} เพื่อ\wbr{}แสดง\wbr{}เจ้า\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}และ\wbr{}ข้อ\wbr{}มูล\wbr{}เพิ่ม\wbr{}เติม\wbr{}เกี่ยว\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}ด้วย. ถ้า\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก\wbr{}นี้\wbr{}กับ\wbr{}ตัว\wbr{}เลือก \cmd{-e} ก็\wbr{}จะ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ทั้ง\wbr{}หมด\wbr{}ใน\wbr{}ระบบ\wbr{}และ\wbr{}ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}โปร\wbr{}เซส.
\begin{MyExample}[แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ด้วย\wbr{}ตัว\wbr{}เลือก \cmd{-f}]\label{ex:init}
\begin{MyEx}
$ \cin{ps -ef}
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 09:01 ?        00:00:04 init [3]
root         2     1  0 09:01 ?        00:00:00 [ksoftirqd/0]
root         3     1  0 09:01 ?        00:00:00 [events/0]
root         4     3  0 09:01 ?        00:00:00 [kblockd/0]
\abb
\end{MyEx}
\end{MyExample}%$
ราย\wbr{}เอียด\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}เพิ่ม\wbr{}เติม\wbr{}จาก\wbr{}ค่า\wbr{}ปริยาย\wbr{}ที่\wbr{}แสดง\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item UID (User ID)\\
 แสดง\wbr{}เจ้า\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}ใช้\wbr{}ชื่อล็\wbr{}อก\wbr{}อิน.
\item PPID (Parent Process ID)\\
โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่, แสดง\wbr{}โปร\wbr{}เซส ID ที่\wbr{}เป็น\wbr{}ตัว\wbr{}สร้าง\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}แสดง\wbr{}อยู่.
\item C\\
ข้อ\wbr{}มูล\wbr{}ดิบ\wbr{}ของ\wbr{}ระยะ\wbr{}เวลา\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ใน\wbr{}หน่วย clock tick. %ระยะ\wbr{}เวลา\wbr{}นี้\wbr{}ไม่\wbr{}ใช่\wbr{}เวลา\wbr{}สะสม\wbr{}แต่\wbr{}เป็น\wbr{}ระยะ\wbr{}เวลา\wbr{}ใน\wbr{}ช่วง\wbr{}หนึ่ง\wbr{}ซึ่ง\wbr{}จะ\wbr{}สามารถ\wbr{}นำ\wbr{}มา\wbr{}คำนวณ\wbr{}เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ได้.
\item STIME (Start TIME)\\
เวลา\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}เริ่ม\wbr{}ทำ\wbr{}งาน.
\end{itemize}

สำหรับ\wbr{}ผู้\wbr{}ดู\wbr{}แล\wbr{}ระบบ\wbr{}ที่\wbr{}ต้อง\wbr{}ดู\wbr{}ว่า\wbr{}ยูสเ\wbr{}ซอร์\wbr{}รัน\wbr{}โปร\wbr{}เซส\wbr{}อะไร\wbr{}อยู่, สามารถ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-u \textit{user}}  ดู\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}ระบุ\wbr{}ยูสเ\wbr{}ซอร์\wbr{}ที่\wbr{}ต้องการ\wbr{}ได้.
\begin{MyExample}[ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps} เลือก\wbr{}ดู\wbr{}โปร\wbr{}เซส\wbr{}ของ\wbr{}ผู้\wbr{}ใช้\wbr{}ที่\wbr{}ต้องการ.]\label{ex:psfu}
\begin{MyEx}
$ \cin{ps -fu poonlap}
  PID TTY          TIME CMD
 7099 ?        00:00:00 gam_server
10197 ?        00:00:00 esd
10291 ?        00:00:01 gnome-session
\abb
10523 pts/1    00:00:00 bash
10642 pts/2    00:00:00 bash
10679 pts/2    00:00:01 ssh
11556 pts/1    00:00:00 firefox
11595 pts/1    00:00:00 run-mozilla.sh
11600 pts/1    00:00:17 firefox-bin
13715 pts/1    00:00:00 ps
\end{MyEx}
\end{MyExample}%$
อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}ตัว\wbr{}เลือก \cmd{-u} จะ\wbr{}เป็น\wbr{}ชื่อล็\wbr{}อก\wbr{}อิน\wbr{}หรือ UID ก็\wbr{}ได้.

ใน\wbr{}กรณี\wbr{}ที่\wbr{}ยูสเ\wbr{}ซอร์\wbr{}ใช้เ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}อยู่\wbr{}หลาย\wbr{}ตัว\wbr{}และ\wbr{}เรา\wbr{}ต้องการ\wbr{}เลือก\wbr{}ดู\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}อยู่\wbr{}ในเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ทีท\wbr{}ต้องการ, ให้\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก  \cmd{-t \textit{tty}}.
\begin{MyExample}[เลือก\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ตามเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ที่\wbr{}ต้องการ.]
\begin{MyEx}
$ \cin{ps -ft pts/2}
UID        PID  PPID  C STIME TTY          TIME CMD
poonlap  10642 10499  0 10:26 pts/2    00:00:00 bash
poonlap  10679 10642  0 10:26 pts/2    00:00:01 ssh -X poonlap@10.0.0.1
\end{MyEx}
\end{MyExample}%$
จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}เป็น\wbr{}การ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ควบ\wbr{}คุม\wbr{}โดยเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล pts/2 และ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-f} แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ประกอบ. ลำดับ\wbr{}ของ\wbr{}ตัว\wbr{}เลือก\wbr{}มี\wbr{}ความ\wbr{}สำคัญ, ไม่\wbr{}สามารถ\wbr{}สลับ\wbr{}กัน\wbr{}ได้\wbr{}เพราะ pts/2 เป็น\wbr{}อาร์กิวเ\wbr{}มนต์\wbr{}ของ \cmd{-t} ไม่\wbr{}ใช่ \cmd{-f}.


\subsection{ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส}
การ\wbr{}สร้าง\wbr{}โปร\wbr{}เซส\wbr{}คือ\wbr{}การ\wbr{}รัน\wbr{}โปรแกรม\wbr{}ซึ่ง\wbr{}สามารถ\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง\wbr{}ใน\wbr{}เชลล์\wbr{}พร\wbr{}อมต์, หรือ\wbr{}เลือก\wbr{}โปรแกรม\wbr{}ที่\wbr{}ต้องการ\wbr{}ใช้\wbr{}จาก\wbr{}เมนู\wbr{}เป็นต้น. ใน\wbr{}กรณี\wbr{}ที่\wbr{}ใช้\wbr{}เชลล์\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง, โปร\wbr{}เซส\wbr{}ใหม่\wbr{}จะ\wbr{}สร้าง\wbr{}โดย\wbr{}เชลล์\wbr{}และ\wbr{}จะ\wbr{}เกิด\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เป็น\wbr{}ผู้\wbr{}สร้าง\wbr{}และ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ถูก\wbr{}สร้าง. เรา\wbr{}จะ\wbr{}เรียก\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เป็น\wbr{}ผู้\wbr{}สร้าง\wbr{}ว่า\emph{โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่\gindex{โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่} (parent process)\gindex{process!parent}} และ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ถูก\wbr{}สร้าง\wbr{}ใหม่\wbr{}ว่า\emph{โปร\wbr{}เซส\wbr{}ลูก\gindex{โปร\wbr{}เซส\wbr{}ลูก} (child process)\gindex{process!child}}. โปร\wbr{}เซส\wbr{}ที่\wbr{}เกิด\wbr{}ใหม่\wbr{}จะ\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่\wbr{}เสมอ\wbr{}ซึ่ง\wbr{}จะ\wbr{}ดู\wbr{}ได้\wbr{}จาก\wbr{}คอลัมน์ PPID ของ\wbr{}คำ\wbr{}สั่ง \cmd{ps}.

คำ\wbr{}สั่ง \cmd{pstree}\cindex{pstree} ช่วย\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}ใช้\wbr{}แผน\wbr{}ภาพ\wbr{}ต้น\wbr{}ไม้\wbr{}ทำ\wbr{}ให้\wbr{}ดู\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}ง่าย\wbr{}ขึ้น. เรา\wbr{}ลอง\wbr{}มา\wbr{}ดู\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ของ\wbr{}โปร\wbr{}เซส bash (PID 10523) ที่\wbr{}แสดง\wbr{}ใน\wbr{}ตัว\wbr{}อย่าง \ref{ex:psfu} ด้วย\wbr{}คำ\wbr{}สั่ง \cmd{pstree} ดัง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้.
\begin{MyExample}[แผน\wbr{}ภาพ\wbr{}ต้น\wbr{}ไม้\wbr{}ของ\wbr{}โปร\wbr{}เซส.]
\begin{MyEx}
$ \cin{pstree -pu 10523}
bash(10523,poonlap)-+-firefox(11556)---run-mozilla.sh(11595)---firefox-bin(1160+
                    `-pstree(16346)
\end{MyEx}
\end{MyExample}%$
ตัว\wbr{}เลือก \cmd{-p} และ \cmd{-u} ใช้\wbr{}สำหรับ\wbr{}แสดง\wbr{}โปร\wbr{}เซส ID และ\wbr{}ชื่อ\wbr{}ยูสเ\wbr{}ซอร์\wbr{}ใน\wbr{}วง\wbr{}เล็บ\wbr{}ตาม\wbr{}ลำดับ. จาก\wbr{}คำ\wbr{}สั่ง \cmd{pstree} ทำ\wbr{}ให้\wbr{}เรา\wbr{}เห็น\wbr{}ภาพ\wbr{}ชัดเจน\wbr{}ขึ้น\wbr{}ว่า bash เป็น\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่\wbr{}ของ firefox. ต่อ\wbr{}จาก\wbr{}นั้น firefox สร้าง\wbr{}โปร\wbr{}เซส\wbr{}ตัว\wbr{}ใหม่\wbr{}ชื่อ run-mozilla.sh, และ\wbr{}สุด\wbr{}ท้าย\wbr{}โปร\wbr{}เซส run-mozilla.sh สร้าง\wbr{}โปร\wbr{}เซส firefox-bin ซึ่ง\wbr{}เป็นไบ\wbr{}นารี\wbr{}ไฟล์\wbr{}จริงๆ\wbr{}ของ\wbr{}โปรแกรมเบ\wbr{}ราเ\wbr{}ซอร์ Firefox.

อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{pstree} สามารถ\wbr{}เป็น\wbr{}ได้\wbr{}ทั้ง\wbr{}โปร\wbr{}เซส ID หรือ\wbr{}ชื่อ\wbr{}ยูสเ\wbr{}ซอร์. ใน\wbr{}กรณี\wbr{}ที่\wbr{}ไม่\wbr{}ระบุ\wbr{}โปร\wbr{}เซส ID หรือ\wbr{}ชื่อ\wbr{}ยูสเ\wbr{}ซอร์, จะ\wbr{}แสดง\wbr{}แผน\wbr{}ภาพ\wbr{}โปร\wbr{}เซส\wbr{}ของ\wbr{}ระบบ.

\begin{MyExample}[ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}ต่างๆ\wbr{}ใน\wbr{}ระบบ.]
\begin{MyEx}
$ \cin{ps -cpun}
init(1)-+-ksoftirqd/0(2)
        |-events/0(3)-+-khelper(4)
        |             |-kacpid(5)
        |             |-kblockd/0(24)
        |             |-pdflush(34)
        |             |-pdflush(35)
        |             `-aio/0(37)
        |-khubd(25)
\abb
        |-mapping-daemon(10483,poonlap)
        |-gnome-terminal(10499,poonlap)-+-gnome-pty-helpe(10522)
        |                               |-bash(10523)-+-firefox(11556)---run-mo+
        |                               |             `-pstree(17205)
        |                               `-bash(10642)---ssh(10679)
        |-wnck-applet(10503,poonlap)
        |-multiload-apple(10507,poonlap)
        |-clock-applet(10509,poonlap)
        |-mixer_applet2(10512,poonlap)
        |-gnome-keyboard-(10515,poonlap)
        `-notification-ar(10518,poonlap)
\end{MyEx}
\end{MyExample}%$
ตัว\wbr{}อย่าง\wbr{}ข้าง\wbr{}บน\wbr{}เป็น\wbr{}การ\wbr{}แสดง\wbr{}ผล\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{pstree} ตาม\wbr{}ลำดับ\wbr{}การ\wbr{}สร้าง\wbr{}โปร\wbr{}เซส\wbr{}ต่างๆ\wbr{}ใน\wbr{}ระบบ (ตัว\wbr{}เลือก \cmd{-n}), แสดง\wbr{}โปร\wbr{}เซส ID (ตัว\wbr{}เลือก \cmd{-p}), และ\wbr{}แสดง\wbr{}ชื่อล็\wbr{}อก\wbr{}อิน\wbr{}ที่\wbr{}เป็น\wbr{}เจ้า\wbr{}ของ\wbr{}โปร\wbr{}เซส (ตัว\wbr{}เลือก \cmd{-u}).

ใน\wbr{}ทาง\wbr{}เทคนิค, การ\wbr{}สร้าง\wbr{}โปร\wbr{}เซส\wbr{}ใหม่\wbr{}จะ\wbr{}เรีย\wbr{}กว่า\wbr{}การ fork\mymemo{fork เป็น\wbr{}คำ\wbr{}กริยา\wbr{}แปล\wbr{}ว่า\wbr{}การ\wbr{}แยก\wbr{}ออก\wbr{}เป็น\wbr{}กิ่ง\wbr{}ก้าน\wbr{}สาขา.}\gindex{fork}. ใน\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ลิ\wbr{}นุกซ์, โปร\wbr{}เซส\wbr{}ตัว\wbr{}แรก\wbr{}ที่\wbr{}เป็น\wbr{}โปร\wbr{}เซส\wbr{}เริ่ม\wbr{}ต้น\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ทั้ง\wbr{}หมด\wbr{}คือ init\gindex{init}. เนื่อง\wbr{}จาก\wbr{}เป็น\wbr{}โปร\wbr{}เซส\wbr{}ตัว\wbr{}แรก, จึง\wbr{}มี\wbr{}โปร\wbr{}เซส ID เป็น\wbr{}เลข 1 เสมอ. ถัด\wbr{}จาก\wbr{}โปร\wbr{}เซส init จะ\wbr{}เป็น\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เกิด\wbr{}จากเ\wbr{}คอร์เนล\wbr{}เช่น ksoftirqd, eventd, khelper ฯลฯ. โปร\wbr{}เซส\wbr{}เหล่า\wbr{}นี้\wbr{}เรีย\wbr{}กว่า \emph{kernel thread}\gindex{kernel thread} เป็น\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ช่วย\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของเ\wbr{}คอร์เนล. ถ้า\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps -ef} จะ\wbr{}แสดง kernel thread ใน\wbr{}วง\wbr{}เล็บ\wbr{}เหลี่ยม.

จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}จะ\wbr{}เห็น\wbr{}ว่า firefox เป็น\wbr{}โปร\wbr{}เซส\wbr{}ลูก\wbr{}ของ\wbr{}โปร\wbr{}เซส bash. จะ\wbr{}เกิด\wbr{}อะไร\wbr{}ขึ้น\wbr{}ถ้า\wbr{}โปร\wbr{}เซส bash ตาย\wbr{}ไป? ถ้า\wbr{}โปร\wbr{}เซส firefox เป็น\wbr{}โปร\wbr{}เซส\wbr{}แบบ foreground, โปร\wbr{}เซส firefox จะ\wbr{}ตาย\wbr{}ตาม\wbr{}ไป\wbr{}ด้วย. แต่\wbr{}ถ้า firefox เป็น\wbr{}โปร\wbr{}เซส background, โปร\wbr{}เซส firefox จะ\wbr{}กลาย\wbr{}เป็น\emph{โปร\wbr{}เซส\wbr{}กำพร้า (orphan process)}\gindex{โปร\wbr{}เซส\wbr{}กำพร้า}\gindex{orphan process} ไม่\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่. ใน\wbr{}กรณี\wbr{}นี้\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}ของ firefox จะ\wbr{}กลาย\wbr{}เป็น\wbr{}โปร\wbr{}เซส init โดย\wbr{}ปริยาย. จะ\wbr{}สังเกต\wbr{}ได้\wbr{}ว่า\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}ลาย\wbr{}ตัว\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่\wbr{}เป็น\wbr{}โปร\wbr{}เซส init เช่น wnck-applet, multiload-apple ฯลฯ. โปร\wbr{}เซส\wbr{}เหล่า\wbr{}นี้\wbr{}จะ\wbr{}ไม่\wbr{}มีเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ควบ\wbr{}คุม.

โปร\wbr{}เซส\wbr{}อีก\wbr{}ประเภท\wbr{}หนึ่ง\wbr{}ซึ่ง\wbr{}ไม่\wbr{}พบ\wbr{}บ่อย\wbr{}นัก\wbr{}ได้\wbr{}แก่\wbr{}โปร\wbr{}เซส zombie\gindex{zombie|see{process}}\gindex{process!zombie}\gindex{โปร\wbr{}เซส!zombie}. โปร\wbr{}เซส zombie คือ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ตาย\wbr{}ไป\wbr{}แต่\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่\wbr{}ไม่\wbr{}ได้\wbr{}รับ\wbr{}รู้, ทำ\wbr{}ให้\wbr{}ชื่อ\wbr{}โปร\wbr{}เซส\wbr{}ยัง\wbr{}อยู่\wbr{}ใน\wbr{}ตา\wbr{}ราง\wbr{}โปร\wbr{}เซส\wbr{}ของเ\wbr{}คอร์เนล. คำ\wbr{}สั่ง \cmd{ps} จะ\wbr{}แสดง\wbr{}ชื่อ\wbr{}โปร\wbr{}เซส zombie ตาม\wbr{}ด้วย\wbr{}คำ\wbr{}ว่า <defunct>. โปร\wbr{}เซส zombie เป็น\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ตาย\wbr{}ไป\wbr{}แล้ว\wbr{}ไม่\wbr{}ได้\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}ใดๆ\wbr{}ใน\wbr{}ระบบ, ไม่\wbr{}มี\wbr{}อันตราย\wbr{}ใดๆ.

\begin{MyExample}[โปร\wbr{}เซส zombie.]\label{ex:zombie}
\begin{MyEx}
$ \cin{ps -ly 21634}
S   UID   PID  PPID  C PRI  NI  RSS    SZ WCHAN  TTY        TIME CMD
Z   500 21634 11600  0  77   0    0     0 exit   pts/1      0:00 [netstat] <defu\wrap
nct>
\end{MyEx}
\end{MyExample}%$



\subsection{เกี่ยว\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{ps}}
คำ\wbr{}สั่ง \cmd{ps} เป็น\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ใช้\wbr{}มา\wbr{}นาน\wbr{}ตั้ง\wbr{}แต่\wbr{}สมัย\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ยู\wbr{}นิกซ์. ตัว\wbr{}เลือก\wbr{}ต่างๆ\wbr{}ของ\wbr{}คำ\wbr{}สั่ง\wbr{}ดั้งเดิม\wbr{}จะ\wbr{}แตก\wbr{}ต่าง\wbr{}กัน\wbr{}ตาม\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ยู\wbr{}นิกซ์\wbr{}ที่\wbr{}ใช้\wbr{}เช่น SysV หรือ BSD. สำหรับ\wbr{}คน\wbr{}ที่\wbr{}เคย\wbr{}ใช้\wbr{}ยู\wbr{}นิกซ์\wbr{}มา\wbr{}ก่อน\wbr{}อาจ\wbr{}จะ\wbr{}รู้\wbr{}มา\wbr{}ว่า\wbr{}ถ้า\wbr{}ต้องการ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ใน\wbr{}ระบบ\wbr{}ทั้ง\wbr{}หมด\wbr{}ให้\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps aux}. การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps} และ\wbr{}ตัว\wbr{}เลือก\wbr{}โดย\wbr{}ไม่\wbr{}ใช้\wbr{}เครื่อง\wbr{}หมาย \cmd{-} นำ\wbr{}หน้า\wbr{}ตัว\wbr{}เลือก\wbr{}เป็น\wbr{}การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps} ส\wbr{}ไตล์ BSD. เพื่อ\wbr{}ความ\wbr{}เป็น\wbr{}มาตร\wbr{}ฐาน\wbr{}และ\wbr{}ไม่\wbr{}สับ\wbr{}สน\wbr{}ควร\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps} แบบ\wbr{}มาตร\wbr{}ฐาน\wbr{}ตาม The Single UNIX Specification Version 3 (SusV3) \cite{susv3} ซึ่ง\wbr{}จะ\wbr{}ใช้\wbr{}เครื่อง\wbr{}หมาย \cmd{-} นำ\wbr{}หน้า\wbr{}ตัว\wbr{}เลือก\wbr{}เสมอ. ใน\wbr{}หนังสือ\wbr{}เล่ม\wbr{}นี้\wbr{}จะ\wbr{}ยึด\wbr{}ตาม\wbr{}หลัก SusV3. สำหรับ\wbr{}ราย\wbr{}ละเอียด\wbr{}เพิ่ม\wbr{}เติม\wbr{}เกี่ยว\wbr{}กับ\wbr{}การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps} ส\wbr{}ไตล์ BSD สามารถ\wbr{}อ่าน\wbr{}ได้\wbr{}จาก \cmd{man ps}.

\subsubsection{ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}ตัว\wbr{}เลือก}
คำ\wbr{}สั่ง \cmd{ps} มี\wbr{}ความ\wbr{}ยืด\wbr{}หยุ่น\wbr{}สูง\wbr{}สามารถ\wbr{}แสดง\wbr{}ข้อ\wbr{}มูล\wbr{}ต่างๆ\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เรา\wbr{}ต้องการ\wbr{}ได้. ตัว\wbr{}อย่าง\wbr{}เช่น\wbr{}ตัว\wbr{}เลือก \cmd{-f} (full-format) ใช้\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}ใน\wbr{}ระดับ\wbr{}ที่\wbr{}พอ\wbr{}ควร. นอก\wbr{}จาก\wbr{}นั้น\wbr{}ยัง\wbr{}มี\wbr{}ตัว\wbr{}เลือก \cmd{-F} (extra full-format) ซึ่ง\wbr{}จะ\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ให้\wbr{}ละเอียด\wbr{}ขึ้น\wbr{}อีก, และ\wbr{}ตัว\wbr{}เลือก \cmd{-l} (long format) แสดง\wbr{}ราย\wbr{}เอียด\wbr{}แบบ\wbr{}ยาว.

\begin{MyExample}[เปรียบ\wbr{}เทียบ\wbr{}ตัว\wbr{}เลือก\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}โปร\wbr{}เซส.]
\begin{MyEx}
$ \cin{ps -f}
UID        PID  PPID  C STIME TTY          TIME CMD
poonlap  18519  7868  0 12:07 pts/7    00:00:00 -bash
poonlap  22212 18519  0 14:00 pts/7    00:00:00 ps -f
$ \cin{ps -F}
UID        PID  PPID  C    SZ   RSS PSR STIME TTY          TIME CMD
poonlap  18519  7868  0   561  1292   0 12:07 pts/7    00:00:00 -bash
poonlap  22215 18519  0   605   828   0 14:00 pts/7    00:00:00 ps -F
$ \cin{ps -l}
F S   UID   PID  PPID  C PRI  NI ADDR SZ WCHAN  TTY          TIME CMD
0 S  1000 18519  7868  0  75   0 -   561 wait4  pts/7    00:00:00 bash
0 R  1000 22218 18519  0  77   0 -   559 -      pts/7    00:00:00 ps
$ \cin{ps -ly}
S   UID   PID  PPID  C PRI  NI   RSS    SZ WCHAN  TTY          TIME CMD
S  1000 18519  7868  0  75   0  1292   561 wait4  pts/7    00:00:00 bash
R  1000 22232 18519  0  77   0   668   559 -      pts/7    00:00:00 ps
\end{MyEx}
\end{MyExample}

ราย\wbr{}ละเอียด\wbr{}ต่าง\wbr{}ของ\wbr{}แต่\wbr{}คอลัมน์\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item SZ\\
ขนาด\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}มี\wbr{}หน่วย\wbr{}เป็น \emph{page} %
\myvocab{p}{page}{หน่วย\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ. ใน\wbr{}ระบบ\wbr{}ยู\wbr{}นิกซ์\wbr{}รวม\wbr{}ถึง\wbr{}ลิ\wbr{}นุกซ์\wbr{}จะ\wbr{}แบ่ง\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เป็น\wbr{}กลุ่ม\wbr{}ขนาด\wbr{}เล็ก\wbr{}เรีย\wbr{}กว่า page. โดย\wbr{}ทั่ว\wbr{}ไป page จะ\wbr{}มี\wbr{}ขนาด 4Kb (4096 ไบต์).}%
หน่วย\wbr{}ความ\wbr{}จำ\wbr{}นี้\wbr{}คือ\wbr{}เนื้อ\wbr{}ที่\wbr{}ที่\wbr{}ใช้\wbr{}สำหรับ\wbr{}ข้อ\wbr{}มูล text, data และ stack ของ\wbr{}โปร\wbr{}เซส. อีก\wbr{}ความ\wbr{}หมาย\wbr{}หนึ่ง\wbr{}คือ\wbr{}ขนาด\wbr{}ของ\emph{หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน (virtual memory)}\gindex{virtual memory} %
\myvocab{v}{virtual memory}{\emph{หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน}. พื้น\wbr{}ที่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ (address space) ที่\wbr{}โปร\wbr{}เซ\wbr{}สมอง\wbr{}เห็น\wbr{}ซึ่ง\wbr{}โดย\wbr{}ทั่ว\wbr{}ไป\wbr{}จะ\wbr{}มี\wbr{}ขนาด\wbr{}ไม่\wbr{}เท่า\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง (physical memory). ใน\wbr{}ระบบ\wbr{}สถาปัตยกรรม 32 บิต\wbr{}พื้น\wbr{}ที่\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}เห็น\wbr{}จะ\wbr{}มี\wbr{}ขนาด 4GB.}%
ของ\wbr{}โปร\wbr{}เซส.
\item \label{sec:rss}RSS (Resident Set Size)\gindex{rss@RSS}\gindex{resident set size@Residen set size}\\
จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}อยู่\wbr{}จริง. มี\wbr{}หน่วย\wbr{}เป็น kB. สมมติ\wbr{}ว่า\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}ต้องการ\wbr{}ใช้\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ทั้ง\wbr{}หมด x กิโลไบต์, โดย\wbr{}ปรกติ\wbr{}แล้วเ\wbr{}คอร์เนล\wbr{}จะ\wbr{}จัด\wbr{}การ\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ของ\wbr{}ระบบ\wbr{}และ\wbr{}จะ\wbr{}จัด\emph{หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง (physical memory)}\gindex{physical memory} %
\myvocab{p}{physical memory}{\emph{หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง}. คือ\wbr{}จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}มี\wbr{}จริง\wbr{}ใน\wbr{}ระบบ\wbr{}หมาย\wbr{}ถึง\wbr{}ตัว\wbr{}ฮาร์ดแวร์ (memory). เ\wbr{}คอร์เนล\wbr{}จะ\wbr{}ใช้\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}โดย\wbr{}แบ่ง\wbr{}เป็น page, มัก\wbr{}จะ\wbr{}เรีย\wbr{}กว่า freame.}%
 ให้\wbr{}ซึ่ง\wbr{}ไม่\wbr{}จำ\wbr{}เป็น\wbr{}ต้อง\wbr{}เท่า\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ต้องการ\wbr{}ทั้ง\wbr{}หมด.
\item PSR (Processor)\\
หน่วย\wbr{}ประมวล\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}โปร\wbr{}เซส\wbr{}นั้น. มี\wbr{}ความ\wbr{}หมาย\wbr{}สำหรับ\wbr{}เครื่อง\wbr{}คอมพิวเตอร์\wbr{}ที่\wbr{}มี\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}หลาย\wbr{}ตัว.
\item F และ ADDR\mymemo{ข้อ\wbr{}มูล\wbr{}ของ flag ของ\wbr{}โปร\wbr{}เซ\wbr{}สอ\wbr{}ยู่\wbr{}ใน\wbr{}ไฟล์ \cmd{/usr/include/linux/sched.h}}\\
เป็น\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}ไม่\wbr{}ค่อย\wbr{}ใช้\wbr{}กัน\wbr{}และ\wbr{}มัก\wbr{}จะ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-y} กับ \cmd{-l} เพื่อ\wbr{}ไม่\wbr{}แสดง flag และ\wbr{}เปลี่ยน \cmd{ADDR} ให้\wbr{}เป็น \cmd{RSS} แทน.
\item S (Status)\\
สภาพ\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item D~~    Uninterruptible sleep
\item R~~    Running หรือ runnable คือ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}อยู่\wbr{}ใน\emph{รัน\wbr{}คิว (run queue)} หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}กำลัง\wbr{}ทำ\wbr{}งาน\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}อยู่, หรือ\wbr{}รอ\wbr{}หน่วย\wbr{}ประมวล\wbr{}อยู่.
\item S~~    Interruptible sleep, กำลัง\wbr{}รอ\wbr{}เหตุ\wbr{}การณ์\wbr{}ใด\wbr{}เหตุ\wbr{}การณ์\wbr{}หนึ่ง\wbr{}ให้\wbr{}เสร็จ
\item T~~    Stopped หมาย\wbr{}ถึง\wbr{}หยุด\wbr{}ทำ\wbr{}งาน\wbr{}ชั่ว\wbr{}คราว\wbr{}ไม่\wbr{}ใช่\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน.
\item W~~    paging (ยก\wbr{}เลิก\wbr{}หลัง\wbr{}จากเ\wbr{}คอร์เนล 2.6)
\item X~~    dead คือ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ตาย\wbr{}ไป\wbr{}แล้ว. จริงๆ\wbr{}แล้\wbr{}วจะ\wbr{}ไม่\wbr{}เห็น\wbr{}ใน\wbr{}ราย\wbr{}การ\wbr{}โปร\wbr{}เซส.
\item Z~~    Defunct process หรือ\wbr{}เรียก\wbr{}อีก\wbr{}อย่าง\wbr{}ว่า\wbr{}โปร\wbr{}เซส \emph{zombie}\gindex{zombie process} คือ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ตาย\wbr{}ไป\wbr{}แล้ว\wbr{}แต่\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่\wbr{}ไม่\wbr{}ได้\wbr{}รับ\wbr{}รู้\wbr{}ทำ\wbr{}ให้\wbr{}ยัง\wbr{}แสดง\wbr{}อยู่\wbr{}ใน\wbr{}ราย\wbr{}การ\wbr{}โปร\wbr{}เซส. จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}ที่ \ref{ex:zombie} จะ\wbr{}เห็น\wbr{}ว่า SZ และ RSS มี\wbr{}ค่า\wbr{}เป็น 0 คือ\wbr{}ไม่\wbr{}ได้\wbr{}ใช้\wbr{}ทรัพยากร.
\end{itemize}
\item PRI (Priority)\\
แสดง priority ของ\wbr{}โปร\wbr{}เซส\wbr{}ตัว\wbr{}เลข\wbr{}อยู่\wbr{}ระหว่าง 0 ถึง 99. สำหรับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}รัน\wbr{}คิว, โปร\wbr{}เซส\wbr{}ที่\wbr{}มี\wbr{}ค่า PRI สูง\wbr{}กว่า\wbr{}จะ\wbr{}ทำ\wbr{}งาน\wbr{}ก่อน.
\item NI (Nice)\\
ตัว\wbr{}เลข\wbr{}นี้\wbr{}ช่วย\wbr{}บอก\wbr{}ให้เ\wbr{}คอร์เนล\wbr{}รู้\wbr{}ว่า\wbr{}ควร\wbr{}จะ\wbr{}รัน\wbr{}โปร\wbr{}เซส\wbr{}นี้\wbr{}บ่อย\wbr{}หรือ\wbr{}ให้\wbr{}เวลา\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}อย่าง\wbr{}ไร. ค่า\wbr{}โดย\wbr{}ปริยาย\wbr{}จะ\wbr{}เป็น 0. NI จะ\wbr{}มี\wbr{}ค่า\wbr{}ตั้ง\wbr{}แต่ -20 ถึง 19. ตัว\wbr{}เลข\wbr{}ยิ่ง\wbr{}มาก\wbr{}จะ\wbr{}ได้\wbr{}เวลา\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}น้อย, ค่า\wbr{}น้อยๆ\wbr{}จะ\wbr{}ได้\wbr{}เวลา\wbr{}ประมวล\wbr{}ผล\wbr{}มาก. Nice ใน\wbr{}ที่\wbr{}นี้\wbr{}หมาย\wbr{}ถึง\wbr{}ดี (nice) ต่อ\wbr{}โปร\wbr{}เซส\wbr{}อื่นๆ.
\item WCHAN (Wait)\\
โปร\wbr{}เซส\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}ระบบ\wbr{}ไม่\wbr{}จำ\wbr{}เป็น\wbr{}ต้อง\wbr{}กำลัง\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}ทุก\wbr{}ตัว. ส่วน\wbr{}มาก\wbr{}จะ sleep รอ\wbr{}เหตุ\wbr{}การณ์\wbr{}ใด\wbr{}เหตุ\wbr{}การณ์\wbr{}หนึ่ง\wbr{}อยู่\wbr{}และ\wbr{}คอลัมน์ WCHAN แสดง\wbr{}ชื่อ\wbr{}ฟังก์ชันเ\wbr{}คอร์เนล\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}กำลัง\wbr{}รอ\wbr{}อยู่. ตัว\wbr{}อย่าง\wbr{}เช่น\wbr{}โปร\wbr{}เซส bash อยู่\wbr{}ใน\wbr{}สภาพ sleep (S) โดย\wbr{}ฟังก์ชัน wait4\mymemo{wait4 เป็น\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์. อ่าน\wbr{}ราย\wbr{}ละเอียด\wbr{}ได้\wbr{}จาก \cmd{man wait4}.}. เรา\wbr{}พอ\wbr{}จะ\wbr{}เดา\wbr{}ได้\wbr{}ว่า\wbr{}เชลล์\wbr{}กำลัง\wbr{}รอ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส ps ให้\wbr{}เสร็จ\wbr{}อยู่.
\end{itemize}

\medskip
คำ\wbr{}สั่ง \cmd{ps} มี\wbr{}ตัว\wbr{}เลือก\wbr{}สามารถ\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}ต้องการ\wbr{}เอง\wbr{}ได้\wbr{}โดย\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-o}. ตัว\wbr{}อย่าง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้\wbr{}จะ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}เลือก\wbr{}ยูสเ\wbr{}ซอร์, จัด\wbr{}คอลัมน์\wbr{}ใหม่\wbr{}โดย\wbr{}ระบุ\wbr{}ค่าที่\wbr{}ต้องการ\wbr{}ดู\wbr{}และ\wbr{}แสดง\wbr{}เป็น\wbr{}แผน\wbr{}ภาพ\wbr{}ต้น\wbr{}ไม้\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}ด้วย\wbr{}ตัว\wbr{}เลือก \cmd{--forest}.
\begin{MyExample}[โปร\wbr{}เซส\wbr{}ของ\wbr{}ยูสเ\wbr{}ซอร์\wbr{}ที่\wbr{}ระบุ\wbr{}และ\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส.]\label{ex:psforest}
\begin{MyEx}
$ \cin{ ps -u poonlap -o pid,ppid,tty,stime,comm --forest}
  PID  PPID TT       STIME COMMAND
10291  3725 ?        10:25 gnome-session
10373 10291 ?        10:25  \bs{}_ ssh-agent
10518     1 ?        10:26 notification-ar
10515     1 ?        10:26 gnome-keyboard-
10512     1 ?        10:26 mixer_applet2
10509     1 ?        10:26 clock-applet
10507     1 ?        10:26 multiload-apple
10503     1 ?        10:26 wnck-applet
10499     1 ?        10:26 gnome-terminal
10522 10499 ?        10:26  \bs{}_ gnome-pty-helpe
10523 10499 pts/1    10:26  \bs{}_ bash
11556 10523 pts/1    10:34  |   \bs{}_ firefox
11595 11556 pts/1    10:34  |   |   \bs{}_ run-mozilla.sh
11600 11595 pts/1    10:34  |   |       \bs{}_ firefox-bin
21634 11600 pts/1    12:54  |   |           \bs{}_ netstat <defunct>
 9394 10523 pts/1    17:41  |   \bs{}_ ps
10642 10499 pts/2    10:26  \bs{}_ bash
10679 10642 pts/2    10:26  |   \bs{}_ ssh
 1733 10499 pts/3    15:53  \bs{}_ bash
10483     1 ?        10:26 mapping-daemon
10477     1 ?        10:25 gnome-vfs-daemo
10466     1 ?        10:25 eggcups
10464     1 ?        10:25 pam-panel-icon
10459     1 ?        10:25 gnome-volume-ma
10457     1 ?        10:25 nautilus
10455     1 ?        10:25 gnome-panel
10450     1 ?        10:25 metacity
10413     1 ?        10:25 xscreensaver
10398     1 ?        10:25 gnome-settings-
10393     1 ?        10:25 bonobo-activati
10391     1 ?        10:25 gnome-keyring-d
10382     1 ?        10:25 gconfd-2
10377     1 ?        10:25 dbus-daemon-1
10376     1 ?        10:25 dbus-launch
10197     1 ?        10:24 esd
 7099     1 ?        09:58 gam_server
\end{MyEx}
\end{MyExample}%$
คำ\wbr{}สั่ง \cmd{ps} เป็น\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ค่อน\wbr{}ข้าง\wbr{}ซับ\wbr{}ซ้อน. ผู้\wbr{}อ่าน\wbr{}สามารถ\wbr{}ดู\wbr{}ราย\wbr{}ละเอียด\wbr{}เพิ่ม\wbr{}เติม\wbr{}ได้\wbr{}จาก \cmd{man ps}.
\subsection{โปร\wbr{}เซส และ thread}
โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}โปร\wbr{}เซส\wbr{}สามารถ\wbr{}ทำ\wbr{}งาน\wbr{}เป็น\wbr{}ขั้น\wbr{}ตอน\wbr{}ที่\wbr{}กำหนด\wbr{}ไว้\wbr{}ตั้ง\wbr{}แต่\wbr{}ต้น\wbr{}จน\wbr{}จบ\wbr{}ได้\wbr{}หนึ่ง\wbr{}ชุด. ถ้า\wbr{}เรา\wbr{}มี\wbr{}สาย\wbr{}งาน\wbr{}อยู่\wbr{}สอง\wbr{}ชุด\wbr{}ที่\wbr{}ต้อง\wbr{}ทำ\wbr{}พร้อมๆ\wbr{}กัน\wbr{}จะ\wbr{}ทำ\wbr{}อย่าง\wbr{}ไร? วิธี\wbr{}หนึ่ง\wbr{}คือ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อาจ\wbr{}จะ\wbr{}สร้าง\wbr{}โปร\wbr{}เซส\wbr{}เพิ่ม\wbr{}โดย\wbr{}การ fork และ\wbr{}ให้\wbr{}โปร\wbr{}เซส\wbr{}ลูก\wbr{}นั้น\wbr{}ทำ\wbr{}งาน\wbr{}ที่\wbr{}สอง\wbr{}พร้อมๆ\wbr{}กัน. การ\wbr{}ใช้\wbr{}วิธี fork เป็น\wbr{}การ\wbr{}ใช้\wbr{}โปร\wbr{}เซส\wbr{}สอง\wbr{}ตัว. อีก\wbr{}วิธี\wbr{}หนึ่ง\wbr{}คือ\wbr{}การ\wbr{}ใช้ \emph{thread}\gindex{thread}. %
\myvocab{t}{thread}{สาย\wbr{}งาน\wbr{}ที่\wbr{}อยู่\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}สามารถ\wbr{}ทำ\wbr{}งาน\wbr{}ได้\wbr{}พร้อมๆ\wbr{}กัน. โปรแกรม\wbr{}ที่\wbr{}ใช้ thread ได้\wbr{}จะ\wbr{}ใช้ไ\wbr{}ลบ\wbr{}รา\wbr{}รี pthread.}%
Thread คือ\wbr{}สาย\wbr{}งาน\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}โปร\wbr{}เซส. โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}อาจ\wbr{}จะ\wbr{}มี\wbr{}ได้\wbr{}หลาย\wbr{}สาย\wbr{}งาน\wbr{}คือ\wbr{}มี thread หลาย\wbr{}สาย\wbr{}ทำ\wbr{}งาน\wbr{}ได้\wbr{}พร้อมๆ\wbr{}กัน\wbr{}ซึ่ง\wbr{}แต่\wbr{}ละ\wbr{}สาย\wbr{}งาน\wbr{}อาจ\wbr{}จะ\wbr{}เหมือน\wbr{}กัน\wbr{}หรือ\wbr{}ต่าง\wbr{}กัน\wbr{}ก็\wbr{}ได้. การ\wbr{}ใช้ thread มี\wbr{}ข้อ\wbr{}ดี\wbr{}ที่\wbr{}ว่า\wbr{}ไม่\wbr{}มี\wbr{}การ\wbr{}สลับ\wbr{}เปลี่ยน\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}โปร\wbr{}เซส\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}เพราะ thread เป็น\wbr{}สาย\wbr{}งาน\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}โปร\wbr{}เซส\wbr{}และ thread สามารถ\wbr{}ใช้\wbr{}ข้อ\wbr{}มูล\wbr{}บาง\wbr{}อย่าง\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ร่วม\wbr{}กัน\wbr{}ได้. ส่วน\wbr{}การ\wbr{}แบ่ง\wbr{}เวลา\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ thread ใน\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}จะ\wbr{}ใช้ไ\wbr{}ลบ\wbr{}รา\wbr{}รีไ\wbr{}ลบ\wbr{}รา\wbr{}รี pthread\gindex{pthread} (POSIX thread library).

ไ\wbr{}ลบ\wbr{}รา\wbr{}รี thread สำหรับ\wbr{}ลิ\wbr{}นุกซ์\wbr{}ใน\wbr{}ช่วง\wbr{}แรกๆ\wbr{}ไม่\wbr{}สมบูรณ์\wbr{}และ\wbr{}มี\wbr{}ปัญหา\wbr{}หลาย\wbr{}อย่าง \cite{nptl}. ตัว\wbr{}อย่าง\wbr{}ที่\wbr{}เห็น\wbr{}ได้\wbr{}ชัด\wbr{}เช่น\wbr{}โปรแกรม\wbr{}ที่\wbr{}ใช้ไ\wbr{}ลบ\wbr{}รา\wbr{}รี\wbr{}รุ่น\wbr{}เก่า\wbr{}เวลา\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ด้วย\wbr{}คำ\wbr{}สั่ง \cmd{ps} จะ\wbr{}เห็น thread เป็น\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}ลาย\wbr{}โปร\wbr{}เซส\wbr{}แยก\wbr{}แยะ\wbr{}ไม่\wbr{}ออ\wbr{}กว่า\wbr{}จริงๆ\wbr{}แล้ว\wbr{}โปร\wbr{}เซส\wbr{}ไหน\wbr{}เป็น thread หรือ\wbr{}โปร\wbr{}เซส\wbr{}จริงๆ. ไ\wbr{}ลบ\wbr{}รา\wbr{}รี thread รุ่น\wbr{}ใหม่\wbr{}ที่\wbr{}เรีย\wbr{}กว่า \emph{Native POSIX Thread Library (NPTL)}\gindex{nptl@NPTL|see{Native POSIX thread library}}\gindex{native posix thread library@Native POSIX thread library} จะ\wbr{}ไม่\wbr{}มี\wbr{}ปัญหา\wbr{}แบบ\wbr{}นี้. เวลา\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{ps} แสดง\wbr{}โปร\wbr{}เซส\wbr{}จะ\wbr{}เห็น\wbr{}เป็น\wbr{}โปร\wbr{}เซส\wbr{}เดียว.

คำ\wbr{}สั่ง \cmd{ps} มี\wbr{}ตัว\wbr{}เลือก\wbr{}ที่\wbr{}ใช้\wbr{}แสดง thread ID (LWP) ได้\wbr{}แก่ \cmd{-L}. ถ้า\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก\wbr{}นี้\wbr{}ร่วม\wbr{}กับ\wbr{}ตัว\wbr{}เลือก \cmd{-f} จะ\wbr{}แสดง\wbr{}จำนวน thread (NLWP) ของ\wbr{}โปร\wbr{}เซส\wbr{}ด้วย.

\begin{MyExample}[โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้ thread.]
\begin{MyEx}
$ \cin{ps -e | grep firefox-bin} \mycomment{หา\wbr{}โปร\wbr{}เซส ID ของ firefox-bin}
 7379 pts/0    00:17:03 firefox-bin
$ \cin{ps -fLp 7379}
UID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD
poonlap   7379  7369  7379  0    6 Nov15 pts/0    00:17:03 /usr/lib/MozillaFiref\wrap
ox/firefox-bin
poonlap   7379  7369  7389  0    6 Nov15 pts/0    00:00:04 /usr/lib/MozillaFiref\wrap
ox/firefox-bin
poonlap   7379  7369  7391  0    6 Nov15 pts/0    00:00:06 /usr/lib/MozillaFiref\wrap
ox/firefox-bin
poonlap   7379  7369  7781  0    6 Nov15 pts/0    00:00:00 /usr/lib/MozillaFiref\wrap
ox/firefox-bin
poonlap   7379  7369 12544  0    6 Nov16 pts/0    00:00:00 /usr/lib/MozillaFiref\wrap
ox/firefox-bin
poonlap   7379  7369 12545  0    6 Nov16 pts/0    00:00:00 /usr/lib/MozillaFiref\wrap
ox/firefox-bin
\end{MyEx}
\end{MyExample}

จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}จะ\wbr{}เห็น\wbr{}ว่า\wbr{}โปร\wbr{}เซส firefox-bin มี\wbr{}โปร\wbr{}เซส ID เป็น 7379 และ\wbr{}มี thread อยู่ 6 ตัว. Thread แต่\wbr{}ละ\wbr{}ตัว\wbr{}จะ\wbr{}มี\wbr{}หมาย\wbr{}เลข\wbr{}เฉพาะ\wbr{}แสดง\wbr{}ใน\wbr{}คอลัมน์ LWP\gindex{lwp@LWP|see{Light Weight Process}} ซึ่ง\wbr{}ย่อ\wbr{}มา\wbr{}จาก\wbr{}คำ\wbr{}ว่า \emph{Light Weight Process}\gindex{light weight process@Light Weight Process} ซึ่ง\wbr{}คือ thread นั่น\wbr{}เอง.


\subsection{หา\wbr{}โปร\wbr{}เซส ID}
คำ\wbr{}สั่ง \cmd{ps} เป็น\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}แสดง\wbr{}ข้อ\wbr{}มูล\wbr{}ต่างๆ\wbr{}เกี่ยว\wbr{}กับ\wbr{}โปร\wbr{}เซส. ถ้า\wbr{}เรา\wbr{}รู้\wbr{}ชื่อ\wbr{}โปร\wbr{}เซส\wbr{}หรือ\wbr{}ชื่อ\wbr{}โปรแกรม\wbr{}แล้ว\wbr{}ต้องการ\wbr{}หา\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปร\wbr{}เซส\wbr{}นั้น, อาจ\wbr{}จะ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{grep} ช่วย\wbr{}ใน\wbr{}การ\wbr{}กรอง\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{ps} อีก\wbr{}ที. ตัว\wbr{}อย่าง\wbr{}เช่น\wbr{}เรา\wbr{}ต้องการ\wbr{}ค้น\wbr{}หา\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปรแกรม \cmd{emacs} ก็\wbr{}สามารถ\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง\wbr{}ดัง\wbr{}นี้

\begin{MyExample}[การ\wbr{}ใช้ \cmd{ps} ร่วม\wbr{}กับ \cmd{grep} เพื่อ\wbr{}หา\wbr{}โปร\wbr{}เซส ID จาก\wbr{}ชื่อ]\label{ex:psgrep}
\begin{MyEx}
$ \cin{ps -ef | grep emacs}
poonlap   4837  4831  0 14:51 pts/2    00:02:41 emacs
poonlap   6162  4811  0 22:01 pts/1    00:00:00 grep emacs
\end{MyEx}
\end{MyExample}%$

ใน\wbr{}กรณี\wbr{}นี้\wbr{}เรา\wbr{}ก็\wbr{}จะ\wbr{}รู้\wbr{}ว่า\wbr{}โปร\wbr{}เซส ID ของ \cmd{emacs} คือ 4837. หลัง\wbr{}จาก\wbr{}นั้น\wbr{}ถ้า\wbr{}เรา\wbr{}ต้องการ\wbr{}ติด\wbr{}ต่อ\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}นี้\wbr{}เช่น หยุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}นี้\wbr{}ก็\wbr{}สามารถ\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}อ้าง\wbr{}อิง\wbr{}โปร\wbr{}เซส ID ที่\wbr{}ได้\wbr{}มา.
การ\wbr{}ใช้ \cmd{grep} เข้า\wbr{}ช่วย\wbr{}ทำ\wbr{}ให้\wbr{}รู้\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปรแกรม\wbr{}ที่\wbr{}ต้องการ\wbr{}แต่\wbr{}สุด\wbr{}ท้าย\wbr{}เรา\wbr{}ต้อง\wbr{}มา\wbr{}ดู\wbr{}อยู่\wbr{}ดี\wbr{}ว่า\wbr{}โปร\wbr{}เซส ID ของ \cmd{emacs} คือ\wbr{}ตัว\wbr{}เลข\wbr{}ที่\wbr{}อยู่\wbr{}บรรทัด\wbr{}แรก\wbr{}คอลัมน์\wbr{}ที่\wbr{}สอง.


คำ\wbr{}สั่ง \cmd{pgrep}\cindex{pgrep}\refcmd{pgrep} เป็น\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}รวม\wbr{}ความ\wbr{}สามารถ\wbr{}ของ \cmd{ps} และ \cmd{grep} เข้า\wbr{}ด้วย\wbr{}กัน\wbr{}ใช้\wbr{}หา\wbr{}โปร\wbr{}เซส ID โดย\wbr{}ระบุ\wbr{}ชื่อ\wbr{}โปร\wbr{}เซส\wbr{}แบบ regular expression โดย\wbr{}ปริยาย\wbr{}ถ้า\wbr{}ไม่\wbr{}ระบุ\wbr{}ตัว\wbr{}เลือก.

\begin{MyExample}[การ\wbr{}ใช้\wbr{}โปรแกรม \cmd{pgrep} หา\wbr{}โปร\wbr{}เซส ID]
\begin{MyEx}
$ \cin{pgrep -x emacs}
4837
$ \cin{pgrep -lx emacs}
4837 emacs
\end{MyEx}
\end{MyExample}
จาก\wbr{}ตัว\wbr{}อย่าง, เป็น\wbr{}การ\wbr{}หา\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปร\wbr{}เซส\wbr{}ชื่อ \cmd{emacs} โดย\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-x} เพื่อ\wbr{}ให้\wbr{}คำ\wbr{}สั่งแมชท์\wbr{}คำ\wbr{}นั้น\wbr{}ตรง\wbr{}ตัว. ถ้า\wbr{}ไม่\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-x} ประกอบ, คำ\wbr{}สั่ง \cmd{pgrep} อาจ\wbr{}จะ\wbr{}แสดง\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}มี\wbr{}คำ\wbr{}ว่า \cmd{emacs} อยู่\wbr{}ซึ่ง\wbr{}อาจ\wbr{}จะ\wbr{}เป็น \cmd{emacs}, \cmd{xemacs}, \cmd{emacsclient} ฯลฯ เพราะ\wbr{}คำ\wbr{}ที่\wbr{}ระบุ\wbr{}เป็น regular expression. ตัว\wbr{}เลือก \cmd{-l} ใช้\wbr{}แสดง\wbr{}ชื่อ\wbr{}โปร\wbr{}เซส\wbr{}ร่วม\wbr{}กับ\wbr{}โปร\wbr{}เซส ID.




\section{สัญญาณ (signal)}\label{sec:signal}
\emph{สัญญาณ (signal)}\gindex{signal} เป็น\wbr{}วิธี\wbr{}สื่อ\wbr{}สาร\wbr{}วิธี\wbr{}หนึ่ง\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส. ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ลิ\wbr{}นุกซ์\wbr{}ได้\wbr{}มี\wbr{}การ\wbr{}กำหนด\wbr{}สัญญาณ\wbr{}ต่างๆ\wbr{}ซึ่ง\wbr{}คล้าย\wbr{}เหมือน\wbr{}กับ\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ยู\wbr{}นิกซ์. เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}ใด\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ\wbr{}หนึ่ง\wbr{}จะ\wbr{}มี\wbr{}การ\wbr{}ตอบ\wbr{}สนอง\wbr{}ต่อ\wbr{}สัญญาณ\wbr{}นั้นๆ\wbr{}โดย\wbr{}ปริยาย. ตา\wbr{}ราง\wbr{}ที่ \ref{tab:signal} แสดง\wbr{}ราย\wbr{}การ\wbr{}สัญญาณ\wbr{}ทั่วๆ\wbr{}ไป\wbr{}ที่\wbr{}ใช้\wbr{}กัน.

\bigskip
\tablecaption{สัญญาณ\wbr{}ต่างๆ\wbr{}และ\wbr{}หมาย\wbr{}เลข\wbr{}ที่\wbr{}กำหนด\wbr{}โดย\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ}\label{tab:signal}
\tablefirsthead{\hline \multicolumn{1}{c|}{สัญญาณ} & \multicolumn{1}{|c|}{หมาย\wbr{}เลข} & \multicolumn{1}{|c|}{การ\wbr{}ตอบ\wbr{}สนอง} & \multicolumn{1}{|c}{คำ\wbr{}อธิบาย}\\
\hline
}
\tablehead{\multicolumn{4}{l}{{\slshape ต่อ\wbr{}จาก\wbr{}หน้า\wbr{}ที่\wbr{}แล้ว}}\\ \hline \multicolumn{1}{c|}{สัญญาณ} & \multicolumn{1}{|c|}{หมาย\wbr{}เลข} & \multicolumn{1}{|c|}{การ\wbr{}ตอบ\wbr{}สนอง} & \multicolumn{1}{|c}{คำ\wbr{}อธิบาย}\\
\hline
}
\tabletail{\hline \multicolumn{4}{r}{\slshape ต่อ\wbr{}หน้า\wbr{}ถัด\wbr{}ไป}\\}
\tablelasttail{\hline}
\begin{supertabular}{l|r|c|p{.4\linewidth}}
SIGHUP  & 1& Term & รับ\wbr{}รู้\wbr{}การ hangup จากเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ที่\wbr{}ควบ\wbr{}คุม\wbr{}อยู่\wbr{}หรือ\wbr{}สูญ\wbr{}เสีย\wbr{}การ\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\\
SIGINT  & 2& Term & ยับยั้ง\wbr{}จาก\wbr{}คีย์\wbr{}บอร์ด\\
SIGQUIT &      3   &    Core&    จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}จาก\wbr{}คีย์\wbr{}บอร์ด\\
SIGILL  &      4   &    Core&    คำ\wbr{}สั่ง\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ที่\wbr{}ไม่\wbr{}ถูก\wbr{}ต้อง\\
SIGABRT &      6   &    Core&    ทำ\wbr{}ให้\wbr{}ล้ม\wbr{}เหลว\wbr{}จาก\wbr{}ซิส\wbr{}เต็ม\wbr{}คอล abort\\
SIGFPE  &      8   &    Core&    ข้อ\wbr{}ยก\wbr{}เว้น (exception) แบบ floating point \\
SIGKILL &      9   &    Term&    สัญญาณ kill\\
SIGSEGV &     11   &    Core&    การ\wbr{}อ้าง\wbr{}อิง\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}เป็น\wbr{}โมฆะ\\
SIGPIPE &     13   &    Term&    การ\wbr{}ส่ง\wbr{}ต่อ\wbr{}ข้อ\wbr{}มูล\wbr{}ให้\wbr{}ไปป์\wbr{}ที่\wbr{}ไม่\wbr{}มี\wbr{}ตัว\wbr{}รับ\wbr{}ข้อ\wbr{}มูล\wbr{}ต่อ (broken pipe)\\
SIGALRM &     14   &    Term&    การ\wbr{}ปลุก\wbr{}จาก\wbr{}ซิส\wbr{}เต็ม\wbr{}คอล alarm\\
SIGTERM &     15   &    Term&    สัญญาณ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\\
SIGUSR1 &  30,10,16&    Term&    สัญญาณ\wbr{}กำหนด\wbr{}โดย\wbr{}ผู้\wbr{}ใช้ 1\\
SIGUSR2 &  31,12,17&    Term&    สัญญาณ\wbr{}กำหนด\wbr{}โดย\wbr{}ผู้\wbr{}ใช้ 2\\
SIGCHLD &  20,17,18&    Ign &    โปร\wbr{}เซส\wbr{}ลูก\wbr{}ถูก\wbr{}หยุด\wbr{}หรือ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\\
SIGCONT &  19,18,25&        &    กระทำ\wbr{}การ\wbr{}ต่อ\wbr{}ไป\wbr{}ถ้า\wbr{}หยุด\wbr{}อยู่\\
SIGSTOP &  17,19,23&    Stop&    หยุด\wbr{}โปร\wbr{}เซส\\
SIGTSTP &  18,20,24&    Stop&    หยุด\wbr{}การ\wbr{}พิมพ์\wbr{}จากเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\\
\end{supertabular}
\medskip

การ\wbr{}ตอบ\wbr{}สนอง\wbr{}โดย\wbr{}ปริยาย\wbr{}มี\wbr{}หลาย\wbr{}ประเภท\wbr{}เช่น
\begin{itemize}
\item \textbf{Term}\\
สิ้น\wbr{}สุด\wbr{}โปร\wbr{}เซส. การ\wbr{}สิ้น\wbr{}สุด\wbr{}โปร\wbr{}เซส\wbr{}นี้\wbr{}ไม่\wbr{}ได้\wbr{}หมาย\wbr{}ถึง\wbr{}โปร\wbr{}เซส\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}โดย\wbr{}สมบูรณ์\wbr{}แบบ\wbr{}แต่\wbr{}หมาย\wbr{}ถึง\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ตอบ\wbr{}สนอง\wbr{}นั้น\wbr{}จะ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}กระทำ\wbr{}การ\wbr{}ทัน\wbr{}ที\wbr{}ไม่\wbr{}ว่า\wbr{}งาน\wbr{}ที่\wbr{}ทำ\wbr{}อยู่\wbr{}นั้น\wbr{}จะ\wbr{}เสร็จ\wbr{}บริบูรณ์\wbr{}หรือ\wbr{}ไม่\wbr{}ก็\wbr{}ตาม.\mymemo{การ\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}โดย\wbr{}สมบูรณ์\wbr{}หมาย\wbr{}ถึง\wbr{}โปร\wbr{}เซ\wbr{}สมี\wbr{}โอกาส\wbr{}สามารถ\wbr{}กระทำ\wbr{}การ\wbr{}สิ่ง\wbr{}ต่างๆ\wbr{}ที่\wbr{}จำ\wbr{}เป็น\wbr{}ก่อน\wbr{}ที่\wbr{}จะ\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน.}
\item \textbf{Ign}\\
เป็น\wbr{}การ\wbr{}ตอบ\wbr{}สนอง\wbr{}โดย\wbr{}เพิกเฉย\wbr{}ต่อ\wbr{}สัญญาณ\wbr{}ที่\wbr{}ได้\wbr{}รับ.
\item \textbf{Core}\\
ตอบ\wbr{}สนอง\wbr{}โดย\wbr{}การ\wbr{}สิ้น\wbr{}สุด\wbr{}โปร\wbr{}เซส\wbr{}และ\emph{ดัมพ์ (dump)} เนื้อ\wbr{}หา\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}ใช้\wbr{}ลง\wbr{}ไฟล์\wbr{}ชื่อ\wbr{}ว่า \cmd{core}. โดย\wbr{}ทั่ว\wbr{}ไป\wbr{}เรีย\wbr{}กว่า \emph{core dump}\gindex{core dump}.
\item \textbf{Stop}\\
หยุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ชั่ว\wbr{}คราว. โปร\wbr{}เซส\wbr{}ที่\wbr{}หยุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}นี้\wbr{}สามารถ\wbr{}ทำ\wbr{}ให้\wbr{}ทำ\wbr{}งาน\wbr{}ต่อ\wbr{}ได้.
\end{itemize}
ตัว\wbr{}อย่าง\wbr{}เช่น\wbr{}เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ SIGINT, โปร\wbr{}เซส\wbr{}นั้น\wbr{}ก็\wbr{}จะ\wbr{}ยก\wbr{}เลิก\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}โดย\wbr{}ปริยาย. ถ้า\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}มี\wbr{}ความ\wbr{}สามารถ\wbr{}ดัก\wbr{}จับ\wbr{}รอ\wbr{}สัญญาณ\wbr{}ที่\wbr{}ได้\wbr{}ก็\wbr{}จะ\wbr{}สามารถ\wbr{}กระทำ\wbr{}การ\wbr{}อื่นๆ\wbr{}ที่\wbr{}ไม่\wbr{}ใช่\wbr{}การ\wbr{}ตอบ\wbr{}สนอง\wbr{}โดย\wbr{}ปริยาย\wbr{}ก็\wbr{}ได้. สำหรับ\wbr{}สัญญาณ\wbr{}โดย\wbr{}ทั่วๆ\wbr{}ไป, โปร\wbr{}เซส\wbr{}ที่\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ\wbr{}นั้น\wbr{}สามารถ\wbr{}ดัก, บล็อก\wbr{}หรือ\wbr{}เพิกเฉย\wbr{}การ\wbr{}ตอบ\wbr{}สนอง\wbr{}ที่\wbr{}กำหนด\wbr{}ไว้\wbr{}ได้. สัญญาณ SIGKILL และ SIGSTOP เป็น\wbr{}สัญญาณ\wbr{}ที่\wbr{}ไม่\wbr{}สามารถ\wbr{}ดัก, บล็อก\wbr{}หรือ\wbr{}เพิกเฉย\wbr{}ได้. กล่าว\wbr{}คือ\wbr{}ถ้า\wbr{}โปร\wbr{}เซส\wbr{}ใด\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่ง\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ SIGKILL ก็\wbr{}จะ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ทัน\wbr{}ที\wbr{}เสมอ\wbr{}โดย\wbr{}ไม่\wbr{}มี\wbr{}ข้อ\wbr{}ยก\wbr{}เว้น. ส่วน\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ SIGSTOP ก็\wbr{}จะ\wbr{}หยุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ชั่ว\wbr{}คราว\wbr{}เสมอ\wbr{}โดย\wbr{}ไม่\wbr{}มี\wbr{}ข้อ\wbr{}ยก\wbr{}เว้น\wbr{}เช่น\wbr{}กัน. ตัว\wbr{}อย่าง\wbr{}การ\wbr{}ส่ง\wbr{}สัญญาณ SIGSTOP จาก\wbr{}เชลล์ (\cmd{C-z}) ได้\wbr{}แสดง\wbr{}ไป\wbr{}แล้ว\wbr{}ใน\wbr{}ตอน\wbr{}ต้น.

สัญญาณ SIGINT สามารถ\wbr{}ส่ง\wbr{}ได้\wbr{}โดย\wbr{}การ\wbr{}กด\wbr{}คีย์ \cmd{C-c} จากเ\wbr{}ทอร์\wbr{}มินัล, ใช้\wbr{}ใน\wbr{}การ\wbr{}ยก\wbr{}เลิก\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของจ็\wbr{}อบ\wbr{}แบบ foreground. ตัว\wbr{}อย่าง\wbr{}เช่น

\begin{MyExample}[การ\wbr{}ส่ง\wbr{}สัญญาณ \cmd{SIGINT} ให้\wbr{}โปรแกรม\wbr{}ที่\wbr{}ใช้\wbr{}อยู่\wbr{}ด้วย \cmd{C-c}]
\begin{MyEx}
$ \cin{cat}
`cat' will repeat what you typed from standard input\myenter
`cat' will repeat what you typed from standard input
Now we are going to press C-c\myenter
Now we are going to press C-c
\ovalbox{Ctrl}+\ovalbox{c}
$ \cursorprompt
\end{MyEx}
\end{MyExample}

จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}ดัง\wbr{}กล่าว\wbr{}เป็น\wbr{}การ\wbr{}ยก\wbr{}เลิก\wbr{}การ\wbr{}ทำ\wbr{}งาน, ไม่\wbr{}ใช่\wbr{}การ\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}อย่าง\wbr{}ถูก\wbr{}ต้อง. ใน\wbr{}กรณี\wbr{}ของ\wbr{}โปรแกรม \cmd{cat} จะ\wbr{}เรียก\wbr{}ได้\wbr{}ว่า\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}บริบูรณ์\wbr{}ก็\wbr{}ต่อ\wbr{}เมื่อ\wbr{}ไม่\wbr{}มี\wbr{}ข้อ\wbr{}มูล\wbr{}ป้อน\wbr{}ให้\wbr{}โปรแกรม \cmd{cat} อีก\wbr{}ต่อ\wbr{}ไป. กล่าว\wbr{}คือ\wbr{}เมื่อ\wbr{}ได้\wbr{}รับ\wbr{}อักขระ\wbr{}ควบ\wbr{}คุม EOT (End Of Transmission)\mymemo{EOT บ้าง\wbr{}ก็\wbr{}เรีย\wbr{}กว่า EOF (End Of File).} คือ\wbr{}กด \cmd{C-d}.

โดย\wbr{}ทั่ว\wbr{}ไป\wbr{}ผู้\wbr{}ใช้\wbr{}สามารถ\wbr{}ใช้\wbr{}คีย์ \cmd{C-c} ส่ง\wbr{}สัญญาณ SIGINT เพื่อ\wbr{}ยก\wbr{}เลิก\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปรแกรม foreground ต่างๆ\wbr{}ได้. แต่\wbr{}โปรแกรม\wbr{}ก็\wbr{}มี\wbr{}สิทธิ์\wbr{}ที่\wbr{}จะ\wbr{}เพิกเฉย\wbr{}การ\wbr{}รบ\wbr{}กวน\wbr{}ของ\wbr{}สัญญาณ SIGINT ได้\wbr{}โดย\wbr{}การ\wbr{}ดัก\wbr{}สัญญาณ SIGINT และ\wbr{}กระทำ\wbr{}สิ่ง\wbr{}ที่\wbr{}โปรแกรม\wbr{}กำหนด\wbr{}ไว้. ตัว\wbr{}อย่าง\wbr{}เช่น\wbr{}ถ้า\wbr{}ผู้\wbr{}ใช้\wbr{}ใช้\wbr{}โปรแกรม\wbr{}เครื่อง\wbr{}คิด\wbr{}เลข \cmd{bc}\cindex{bc}\refcmd{bc} แล้ว\wbr{}กด \cmd{C-c} เพื่อ\wbr{}ยก\wbr{}เลิก\wbr{}การ\wbr{}ใช้\wbr{}การ\wbr{}ใช้\wbr{}งาน, ตัว\wbr{}โปรแกรม \cmd{bc} จะ\wbr{}ดัก\wbr{}สัญญาณ SIGINT แล้ว\wbr{}แสดง\wbr{}ข้อ\wbr{}ความ\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}ที่\wbr{}ถูก\wbr{}ต้อง\wbr{}ทาง\wbr{}หน้า\wbr{}จอ\wbr{}แทน\wbr{}ที่\wbr{}จะ\wbr{}จบ\wbr{}กระทำ\wbr{}การ\wbr{}กลางครร.\mymemo{ใน\wbr{}โปรแกรม \cmd{bc} ผู้\wbr{}ใช้\wbr{}สามารถ\wbr{}สร้าง\wbr{}ตัวแปร\wbr{}และ\wbr{}ใช้\wbr{}ฟัง\wbr{}ชัน\wbr{}คณิต\wbr{}ศาสตร์\wbr{}ต่างๆ\wbr{}ได้\wbr{}เช่น $sin$, $log$, ยก\wbr{}กำลัง\wbr{}เป็นต้น. ใน\wbr{}ตัว\wbr{}อย่าง\wbr{}มี\wbr{}การ\wbr{}กำหนด\wbr{}ค่า $\pi$ โดย\wbr{}อาศัย\wbr{}ฟัง\wbr{}ชัน $arctan(1)$ เข้า\wbr{}ช่วย, $\pi = 4 arctan(1)$. }\cindex{bc}

\begin{MyExample}[โปรแกรม\wbr{}ที่\wbr{}ดัก\wbr{}สัญญาณ \cmd{SIGINT}]
\begin{MyEx}
$ \cin{bc -l}
bc 1.06
Copyright 1991-1994, 1997, 1998, 2000 Free Software Foundation, Inc.
This is free software with ABSOLUTELY NO WARRANTY.
For details type `warranty'.
\cin{pi = 4*a(1)}
\cin{r = 2.5}
\cin{area = pi * r^2}
\cin{area}
19.63495408493620774025
\cin{4*a(1) * 2.5^2}
19.63495408493620774025
\ovalbox{Ctrl}+\ovalbox{c}
(interrupt) use quit to exit.
\cin{quit}
$ \cursorprompt
\end{MyEx}
\end{MyExample}

ตาม\wbr{}ตัว\wbr{}อย่าง\wbr{}ที่\wbr{}แสดง\wbr{}ไป\wbr{}ขั้น\wbr{}ต้น\wbr{}จะ\wbr{}เห็น\wbr{}ได้\wbr{}ว่า\wbr{}สัญญาณ\wbr{}บาง\wbr{}อย่าง\wbr{}ผู้\wbr{}ใช้\wbr{}สามารถ\wbr{}ส่ง\wbr{}ได้\wbr{}โดย\wbr{}ใช้ key binding เช่น \cmd{C-c}, \cmd{C-z}. แต่\wbr{}สำหรับ\wbr{}การ\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}โดย\wbr{}ทั่ว\wbr{}ไป\wbr{}แล้ว\wbr{}ผู้\wbr{}ใช้\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} โดย\wbr{}ส่ง\wbr{}โปร\wbr{}เซส ID เป็น\wbr{}อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง. ผู้\wbr{}ใช้\wbr{}สามารถ\wbr{}หา\wbr{}โปร\wbr{}เซส ID ได้\wbr{}จาก\wbr{}คำ\wbr{}สั่ง \cmd{ps} หรือ \cmd{pgrep} ที่\wbr{}ได้\wbr{}แนะ\wbr{}นำ\wbr{}ไป\wbr{}แล้ว (\ref{sec:process}).

โดย\wbr{}ปรกติ\wbr{}คำ\wbr{}สั่ง \cmd{kill}\cindex{kill}\refcmd{kill} จะ\wbr{}เป็น\wbr{}การ\wbr{}ทำ\wbr{}ให้\wbr{}โปร\wbr{}เซส\wbr{}หรือจ็\wbr{}อบ\wbr{}ที่\wbr{}ระบุ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}ทำ\wbr{}งาน. ใน\wbr{}หลัก\wbr{}การ\wbr{}แล้ว \cmd{kill} จะ\wbr{}เป็น\wbr{}ตัว\wbr{}ส่ง\wbr{}สัญญาณ SIGTERM เพื่อ\wbr{}ให้\wbr{}โปร\wbr{}เซส\wbr{}หรือจ็\wbr{}อบ\wbr{}ที่\wbr{}ต้องการ\wbr{}หยุด\wbr{}การ\wbr{}ทำ\wbr{}งาน. ตัว\wbr{}อย่าง\wbr{}เช่น %\myexplanation{emacs}{โปรแกรม\wbr{}บรรณาธิ\wbr{}กรณ์\wbr{}ที่\wbr{}สร้าง\wbr{}จาก\wbr{}ภาษา lisp บาง\wbr{}ส่วน\wbr{}และ\wbr{}เรียก\wbr{}ใช้\wbr{}ภาษา lisp ที่\wbr{}เรีย\wbr{}กว่า emacs lisp ได้\wbr{}ใน\wbr{}ตัว\wbr{}บรรณาธิ\wbr{}กรณ์. \cmd{emacs} สามารถ\wbr{}ใช้\wbr{}ได้\wbr{}ทั้ง\wbr{}บนเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล (terminal based) และ\wbr{}หน้า\wbr{}จอ X วิน\wbr{}โดว์ (GUI based)}
\begin{MyExample}[การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} โดย\wbr{}ระบุ\wbr{}หมาย\wbr{}เลข\wbr{}โปร\wbr{}เซส]
\begin{MyEx}
$ \cin{emacs &}
[1] 4362
$ \cin{kill 4362}
\end{MyEx}
\end{MyExample}
แทน\wbr{}ที่\wbr{}จะ\wbr{}ระบุ\wbr{}หมาย\wbr{}เลข\wbr{}โปร\wbr{}เซส\wbr{}เรา\wbr{}อาจ\wbr{}จะ\wbr{}ระบุ\wbr{}หมาย\wbr{}เลขจ็\wbr{}อบ\wbr{}แทน\wbr{}ก็\wbr{}ได้\wbr{}เช่น
\begin{MyExample}[การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} โดย\wbr{}ระบุ\wbr{}หมาย\wbr{}เลขจ็\wbr{}อบ]
\begin{MyEx}
$ \cin{emacs &}
[1] 4410
$ \cin{kill %1}
\end{MyEx}
\end{MyExample}

\bigskip
นอก\wbr{}จาก\wbr{}สัญญาณ SIGTERM แล้ว, โปรแกรม \cmd{kill} ยัง\wbr{}สามารถ\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}อื่นๆ\wbr{}ให้\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}ด้วย. ราย\wbr{}การ\wbr{}สัญญาณ\wbr{}ที่\wbr{}โปรแกรม \cmd{kill} ส่ง\wbr{}ได้\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-l} ใน\wbr{}การ\wbr{}แสดง.
\begin{MyExample}[ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} แสดง\wbr{}ชื่อ\wbr{}สัญญาณ\wbr{}ต่างๆ]
\begin{MyEx}
$ \cin{kill -l}
 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL
 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE
 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2
13) SIGPIPE     14) SIGALRM     15) SIGTERM     17) SIGCHLD
18) SIGCONT     19) SIGSTOP     20) SIGTSTP     21) SIGTTIN
22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO
30) SIGPWR      31) SIGSYS      32) SIGRTMIN    33) SIGRTMIN+1
34) SIGRTMIN+2  35) SIGRTMIN+3  36) SIGRTMIN+4  37) SIGRTMIN+5
38) SIGRTMIN+6  39) SIGRTMIN+7  40) SIGRTMIN+8  41) SIGRTMIN+9
42) SIGRTMIN+10 43) SIGRTMIN+11 44) SIGRTMIN+12 45) SIGRTMIN+13
46) SIGRTMIN+14 47) SIGRTMIN+15 48) SIGRTMAX-15 49) SIGRTMAX-14
50) SIGRTMAX-13 51) SIGRTMAX-12 52) SIGRTMAX-11 53) SIGRTMAX-10
54) SIGRTMAX-9  55) SIGRTMAX-8  56) SIGRTMAX-7  57) SIGRTMAX-6
58) SIGRTMAX-5  59) SIGRTMAX-4  60) SIGRTMAX-3  61) SIGRTMAX-2
62) SIGRTMAX-1  63) SIGRTMAX
\end{MyEx}
\end{MyExample}%$

ใน\wbr{}กรณี\wbr{}ที่ \cmd{kill} ไม่\wbr{}สามารถ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ\wbr{}ได้, ผู้\wbr{}ใช้\wbr{}สามารถ\wbr{}ส่ง\wbr{}สัญญาณ SIGKILL ด้วย\wbr{}อาร์กิวเ\wbr{}มนต์ \cmd{-9} หรือ \cmd{-SIGKILL} ซึ่ง\wbr{}มี\wbr{}ความ\wbr{}หมาย\wbr{}เหมือน\wbr{}กัน. สัญญาณ\wbr{}นี้\wbr{}ใช้\wbr{}สำหรับ\wbr{}ฆ่า\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ผิด\wbr{}ปรกติ\wbr{}เช่น\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ไม่\wbr{}ตอบ\wbr{}สนอง\wbr{}การ\wbr{}ทำ\wbr{}งาน. เนื่อง\wbr{}จาก SIGKILL เป็น\wbr{}สัญญาณ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ไม่\wbr{}สามารถ\wbr{}ปฏิเสธ\wbr{}ได้, เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ SIGKILL แล้ว, ตัว\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}จะ\wbr{}สิ้น\wbr{}สุด\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}แน่\wbr{}นอน.

การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} ฆ่า\wbr{}โปร\wbr{}เซส\wbr{}ต้อง\wbr{}รู้\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ\wbr{}ก่อน\wbr{}จึง\wbr{}จะ\wbr{}ใช้\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}หา\wbr{}โปร\wbr{}เซส\wbr{}นั้นๆ\wbr{}ได้. ใน\wbr{}ความ\wbr{}เป็น\wbr{}จริง, ผู้\wbr{}ใช้\wbr{}ต้อง\wbr{}ค้น\wbr{}หา\wbr{}โปร\wbr{}เซส ID ด้วย\wbr{}คำ\wbr{}สั่ง \cmd{ps} หรือ \cmd{pgrep} เอง. เมื่อ\wbr{}รู้\wbr{}โปร\wbr{}เซส ID แล้ว\wbr{}จึง\wbr{}สามารถ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} ส่ง\wbr{}สัญญาณ. บางดิสท\wbr{}ริ\wbr{}บิว\wbr{}ชัน\wbr{}อาจ\wbr{}จะ\wbr{}มี\wbr{}คำ\wbr{}สั่ง \cmd{pkill}\cindex{pkill}\refcmd{pkill} ซึ่ง\wbr{}รวม\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{kill} กับ \cmd{grep} เข้า\wbr{}ด้วย\wbr{}กัน\wbr{}ให้\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}ให้\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ\wbr{}โดย\wbr{}ระบุ\wbr{}ชื่อ\wbr{}หรือ regular expression. คำ\wbr{}สั่ง \cmd{pkill} จะ\wbr{}มี\wbr{}ตัว\wbr{}เลือก\wbr{}ส่วน\wbr{}ใหญ่\wbr{}เหมือน\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{pgrep}.

\medskip
คำ\wbr{}สั่ง\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}การ\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}อีก\wbr{}ตัว\wbr{}หนึ่ง\wbr{}คือ \cmd{killall}\cindex{killall}\refcmd{killall} ใช้\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}ให้\wbr{}โปร\wbr{}เซส\wbr{}ทุก\wbr{}ตัว\wbr{}ที่\wbr{}ต้องการ\wbr{}โดย\wbr{}การ\wbr{}ระบุ\wbr{}ชื่อ\wbr{}โปร\wbr{}เซส. จะ\wbr{}ต่าง\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{pkill} ที่\wbr{}ไม่\wbr{}สามารถ\wbr{}ใช้ regular expression. คำ\wbr{}สั่ง \cmd{killall} สำหรับ\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}ยู\wbr{}นิกซ์\wbr{}อื่นๆ\wbr{}ที่\wbr{}ไม่\wbr{}ใช้\wbr{}ลิ\wbr{}นุกซ์\wbr{}อาจ\wbr{}จะ\wbr{}มี\wbr{}พฤติกรรม\wbr{}ที่\wbr{}แตก\wbr{}ต่าง\wbr{}จาก\wbr{}คำ\wbr{}สั่ง \cmd{killall} ใน\wbr{}ลิ\wbr{}นุกซ์. เช่น\wbr{}ใน\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ Solaris, ถ้า\wbr{}สั่ง \cmd{killall} ด้วย root จะ\wbr{}ทำลาย\wbr{}โปร\wbr{}เซส\wbr{}ทุก\wbr{}ตัว\wbr{}ใน\wbr{}ระบบ\wbr{}ตาม\wbr{}คำ\wbr{}แปล\wbr{}ของ\wbr{}ชื่อ\wbr{}คำ\wbr{}สั่ง.

\section{ทรัพยากร}
คำ\wbr{}ว่า ``ทรัพยากร'' ใน\wbr{}ภาษา\wbr{}ไทย\wbr{}อาจ\wbr{}จะ\wbr{}ฟัง\wbr{}ดู\wbr{}แปลกๆ\wbr{}สำหรับ\wbr{}หนังสือ\wbr{}คอมพิวเตอร์. ถ้า\wbr{}จะ\wbr{}เขียน\wbr{}เป็น\wbr{}ภาษา\wbr{}อังกฤษ\wbr{}จะ\wbr{}ใช้\wbr{}คำ\wbr{}ว่า resource ซึ่ง\wbr{}หมาย\wbr{}ถึง\wbr{}ทรัพยากร\wbr{}ของ\wbr{}เครื่อง\wbr{}คอมพิวเตอร์\wbr{}ได้\wbr{}เช่น เวลา\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่งๆ, หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ที่\wbr{}ใช้\wbr{}ไป, พื้น\wbr{}ที่\wbr{}ของ\wbr{}ฮาร์ดดิสก์ เป็นต้น. เ\wbr{}คอร์เนล\wbr{}เป็น\wbr{}ตัว\wbr{}ที่\wbr{}ควบ\wbr{}คุม\wbr{}การ\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}ต่างๆ\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}เพื่อ\wbr{}ให้\wbr{}ระบบ\wbr{}ทั้ง\wbr{}ระบบ\wbr{}ทำ\wbr{}งาน\wbr{}ได้\wbr{}อย่าง\wbr{}มี\wbr{}ประสิทธิภาพ.

ลิ\wbr{}นุกซ์\wbr{}เป็น\wbr{}ระบบ\wbr{}ปฏิบัติ\wbr{}การ\wbr{}แบบมัล\wbr{}ติ\wbr{}ยูสเ\wbr{}ซอร์, มัล\wbr{}ติ\wbr{}ทาส์ก สามารถ\wbr{}มี\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}ลายๆ\wbr{}ตัว\wbr{}ทำ\wbr{}งาน\wbr{}ใน\wbr{}เวลา\wbr{}เดียว\wbr{}กัน. บาง\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}มาก, บาง\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}น้อย\wbr{}แตก\wbr{}ต่าง\wbr{}กัน\wbr{}ไป. คำ\wbr{}สั่ง \cmd{ps} สามารถ\wbr{}ดู\wbr{}ทรัพยากร\wbr{}ที่\wbr{}โปร\wbr{}เซ\wbr{}สห\wbr{}นึ่งๆ\wbr{}ใช้\wbr{}ไป\wbr{}ได้\wbr{}เช่น เปอร์\wbr{}เซนต์\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใน\wbr{}ช่วง\wbr{}เวลา\wbr{}สั้นๆ (CPU)\mymemo{ใช้\wbr{}วิธี\wbr{}การ\wbr{}เลือก\wbr{}คอลัมน์ \cmd{-o pcpu}.}, หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส ฯลฯ. แต่\wbr{}สำหรับ\wbr{}การ\wbr{}ดู\wbr{}การ\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}ต่างๆ\wbr{}ใน\wbr{}ระบบ\wbr{}แบบ\wbr{}ทัน\wbr{}ต่อ\wbr{}เวลา (real time) มัก\wbr{}จะ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{top}\cindex{top}\refcmd{top} เพราะ\wbr{}จะ\wbr{}แสดง\wbr{}การ\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}ต่างๆ\wbr{}ที่\wbr{}สำคัญๆ\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ตาม\wbr{}ลำดับ\wbr{}เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล.

\subsection{คำ\wbr{}สั่ง \cmd{top}}
\begin{figure}[!htb]
\plfigure{.5}{top_G1.eps}{คำ\wbr{}สั่ง \cmd{top} แสดง\wbr{}โปร\wbr{}เซส\wbr{}ต่างๆ\wbr{}และ\wbr{}ทรัพยากร\wbr{}ที่\wbr{}ใช้.}{top_G1}
\end{figure}

คำ\wbr{}สั่ง \cmd{top} เป็น\wbr{}โปรแกรม\wbr{}ที่\wbr{}ใช้เ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ชั่ว\wbr{}แสดง\wbr{}ผล\wbr{}จะ\wbr{}อัป\wbr{}เดท\wbr{}ข้อ\wbr{}มูล\wbr{}ทาง\wbr{}หน้า\wbr{}จอ\wbr{}ทุกๆ 3 วินาที\wbr{}โดย\wbr{}ปริยาย. ข้อ\wbr{}มูล\wbr{}ใน\wbr{}บรรทัด\wbr{}แรก\wbr{}เป็น\wbr{}ข้อ\wbr{}มูลโ\wbr{}หลด\wbr{}โดย\wbr{}เฉลี่ย (load average) ของ\wbr{}ระบบ\wbr{}ซึ่ง\wbr{}เหมือน\wbr{}กับ\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{uptime}. บรรทัด\wbr{}ที่ 2 แสดง\wbr{}จำนวน\wbr{}โปร\wbr{}เซส\wbr{}และ\wbr{}สถานะ\wbr{}ต่าง\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item จำนวน\wbr{}โปร\wbr{}เซส\wbr{}ทั้ง\wbr{}หมด\wbr{}ใน\wbr{}ระบบ (Tasks)
\item จำนวน\wbr{}โปร\wbr{}เซ\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}รัน\wbr{}คิว (running). ถ้า\wbr{}มี\wbr{}จำนวน\wbr{}โปร\wbr{}เซ\wbr{}สอ\wbr{}ยู่\wbr{}ใน\wbr{}รัน\wbr{}คิว\wbr{}มาก\wbr{}จำ\wbr{}ทำ\wbr{}ให้\wbr{}ค่าโ\wbr{}หลด\wbr{}โดย\wbr{}เฉลี่ย\wbr{}สูง.
\item จำนวน\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}กำลัง\wbr{}รอ\wbr{}ทำ\wbr{}งาน\wbr{}ต่อ\wbr{}ไป (sleeping)
\item จำนวน\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}หยุด\wbr{}ชั่ว\wbr{}คราว (stopped) คือ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ SIGSTOP.
\item จำนวน\wbr{}โปร\wbr{}เซส zombie.
\end{itemize}

บรรทัด\wbr{}ที่ 3 แสดง\wbr{}เปอร์เซ็นต์\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใน\wbr{}ช่วง\wbr{}ที่\wbr{}ผ่าน\wbr{}มา\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item user (us) เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ธรรม\wbr{}ดา\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}ใน user space.
\item system (sy) เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}ใน kernel space.
\item nice (ni) เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}มี\wbr{}ค่า nice ทำ\wbr{}งาน\wbr{}อยู่\wbr{}ใน user space.
\item idle (id) เปอร์เซ็นต์\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ไม่\wbr{}ได้\wbr{}ทำ\wbr{}อะไร.
\item iowait (wa) เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}รอ\wbr{}ให้ I/O เสร็จ\wbr{}เรียบ\wbr{}ร้อย.
\item irq (hi) เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}การ interrupt ของ\wbr{}ฮาร์ดแวร์.
\item softirq (si) เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}การ interrupt แบบ\wbr{}ซอฟต์แวร์.
\end{itemize}

บรรทัด\wbr{}ที่ 4 เป็น\wbr{}ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ใน\wbr{}ระบบ\wbr{}ใน\wbr{}หน่วย\wbr{}กิโลไบต์\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ทั้ง\wbr{}หมด (total).
\item จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ใช้\wbr{}อยู่ (used).
\item จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ยัง\wbr{}เหลือ\wbr{}อยู่ (free).
\item จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ \emph{buffer cache}\gindex{cache!buffer} %
\myvocab{c}{cache}{การ\wbr{}เก็บ\wbr{}ข้อ\wbr{}มูล\wbr{}บาง\wbr{}อย่าง\wbr{}ไว้\wbr{}ช่วย\wbr{}คราว\wbr{}เพื่อ\wbr{}ความ\wbr{}รวด\wbr{}เร็ว\wbr{}ใน\wbr{}การ\wbr{}เข้า\wbr{}ถึง\wbr{}ข้อ\wbr{}มูล\wbr{}นั้น\wbr{}ภาย\wbr{}หลัง. ถ้า\wbr{}ใช้\wbr{}คำ\wbr{}ว่า cache อย่าง\wbr{}เดียว\wbr{}ไม่\wbr{}สามารถ\wbr{}บอก\wbr{}ได้\wbr{}ว่า\wbr{}เป็น cache ของ\wbr{}อะไร. ลิ\wbr{}นุกซ์เ\wbr{}คอร์เนล\wbr{}ใช้\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ใน\wbr{}การ cache ข้อ\wbr{}มูล\wbr{}หลาย\wbr{}อย่าง\wbr{}เช่น buffer cache, page cache, inode cache, directory cache และ swap cache.}%
(buffers). หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ส่วน\wbr{}นี้\wbr{}ใช้\wbr{}สำหรับ\wbr{}เก็บ\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}จะ\wbr{}บันทึก\wbr{}ลง\wbr{}ใน\wbr{}ฮาร์ดดิสก์, หรือ\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}อ่าน\wbr{}มา\wbr{}จาก\wbr{}ฮาร์ดดิสก์. การ\wbr{}อ่าน\wbr{}ข้อ\wbr{}มูล\wbr{}จาก\wbr{}ฮาร์ดดิสก์\wbr{}จะ\wbr{}ใช้\wbr{}เวลา\wbr{}นาน\wbr{}เมื่อ\wbr{}เทียบ\wbr{}กับ\wbr{}การ\wbr{}อ่าน\wbr{}ข้อ\wbr{}มูล\wbr{}จาก\wbr{}หน่วย\wbr{}ความ\wbr{}จำ. ดัง\wbr{}นั้นเ\wbr{}คอร์เนล\wbr{}จึง\wbr{}ใช้\wbr{}เนื้อ\wbr{}ที่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ส่วน\wbr{}นี้\wbr{}ช่วย\wbr{}ทุ่น\wbr{}เวลา I/O ที่\wbr{}จะ\wbr{}เกิด\wbr{}กับ\wbr{}ฮาร์ดดิสก์.
\item จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ \emph{page cache}\gindex{cache!page} (cached) คือ cache ของ page ที่แม็ป\wbr{}ไว้\wbr{}กับ\wbr{}ไฟล์. ข้อ\wbr{}มูล\wbr{}นี้\wbr{}อยู่\wbr{}ใน\wbr{}บรรทัด\wbr{}ที่\wbr{}ห้า\wbr{}แต่\wbr{}เป็น\wbr{}ข้อ\wbr{}มูล\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ.
\end{itemize}

บรรทัด\wbr{}ที่ 5 แสดง\wbr{}ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ \emph{swap} ใน\wbr{}ระบบ. Swap เป็น\wbr{}พื้น\wbr{}ที่\wbr{}ใน\wbr{}ฮาร์ดดิสก์\wbr{}ใช้\wbr{}เก็บ\wbr{}ข้อ\wbr{}มูล\wbr{}แทน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\mymemo{swap ทำ\wbr{}งาน\wbr{}กลับ\wbr{}กัน\wbr{}กับ buffer cache.}. ตัว\wbr{}อย่าง\wbr{}การ\wbr{}ใช้ swap ของเ\wbr{}คอร์เนล\wbr{}เช่น\wbr{}ใน\wbr{}กรณี\wbr{}ที่\wbr{}มี\wbr{}ข้อ\wbr{}มูล\wbr{}บาง\wbr{}อย่าง\wbr{}ใน\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ไม่\wbr{}มี\wbr{}ความ\wbr{}จำ\wbr{}เป็น\wbr{}ต้อง\wbr{}อยู่\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ก็\wbr{}จะ\wbr{}เก็บ\wbr{}ไว้\wbr{}ใน swap (ฮาร์ดดิสก์) แทน\wbr{}ไม่\wbr{}ให้\wbr{}เปลือง\wbr{}ที่\wbr{}โดย\wbr{}ใช่\wbr{}เหตุ\wbr{}เป็นต้น. หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ไป\wbr{}อยู่\wbr{}ใน swap นี้\wbr{}เรีย\wbr{}กว่า\wbr{}ถูก \emph{swap out} ถ้า\wbr{}มี\wbr{}การ\wbr{}เรียก\wbr{}ข้อ\wbr{}มูล\wbr{}จาก swap เข้า\wbr{}ไป\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ใหม่\wbr{}ก็\wbr{}เรีย\wbr{}กว่า \emph{swap in}
\begin{itemize}
\item จำนวน swap ที่\wbr{}มี\wbr{}อยู่\wbr{}ใน\wbr{}ระบบ (total).
\item จำนวน swap ที่\wbr{}ใช้\wbr{}ไป (used).
\item จำนวน swap ที่\wbr{}ยัง\wbr{}เหลือ\wbr{}อยู่ (free).
\end{itemize}

\medskip
ถัด\wbr{}จาก\wbr{}สถิติ\wbr{}โดย\wbr{}รวม\wbr{}ของ\wbr{}ระบบ\wbr{}แล้ว\wbr{}ก็\wbr{}จะ\wbr{}เป็น\wbr{}ราย\wbr{}งาน\wbr{}การ\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}ต่างๆ\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}เรียง\wbr{}ตาม\wbr{}ลำดับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}มาก. ถ้า\wbr{}ต้องการ\wbr{}จะ\wbr{}ออก\wbr{}จาก\wbr{}โปรแกรม \cmd{top} ให้\wbr{}กด\wbr{}คีย์ ``q'' หมาย\wbr{}ถึง quit ก็\wbr{}จะ\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}แสดง\wbr{}เชลล์\wbr{}พร\wbr{}อมต์\wbr{}ต่อ\wbr{}ไป.

ราย\wbr{}ละเอียด\wbr{}การ\wbr{}ใช้\wbr{}ทรัพยากร\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}จะ\wbr{}คล้าย\wbr{}เมหื\wbr{}อน\wbr{}กับ\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{ps} เช่น PID, USER, PR, NI เป็นต้น. ส่วน\wbr{}ที่\wbr{}ต้อง\wbr{}อธิบาย\wbr{}เพิ่ม\wbr{}เติม\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item \textbf{VIRT}\\
หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}ใน\wbr{}หน่วย\wbr{}ของ kB ประกอบ\wbr{}ด้วย\wbr{}จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ code, data, shared library และ page ที่\wbr{}ถูก swap out ออก\wbr{}ไป. VIRT = SWAP + RES.
\item \textbf{RES}\\
ได้\wbr{}แก่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ Resident Size ใน\wbr{}หน่วย kB ได้\wbr{}แก่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ที่\wbr{}ไม่\wbr{}ได้ swap out. RES = CODE + DATA.
\item \textbf{SHR}\\
Shared memory ได้\wbr{}แก่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ใช้\wbr{}ร่วม\wbr{}กัน\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}ใน\wbr{}หน่วย kB.
\end{itemize}

\subsection{กลุ่ม\wbr{}การ\wbr{}แสดง\wbr{}ผล\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{top}}
คำ\wbr{}สั่ง \cmd{top} จะ\wbr{}แสดง\wbr{}ผล\wbr{}โดย\wbr{}ใช้\wbr{}หน้า\wbr{}ต่างเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}และ\wbr{}หน้า\wbr{}ต่าง\wbr{}ที่\wbr{}แสดง\wbr{}ใน\wbr{}รูป\wbr{}ที่ \ref{fig:top_G1} เป็น\wbr{}เพียง 1 ใน 4 ของ\wbr{}กลุ่ม\wbr{}แสดง\wbr{}ผล\wbr{}ที่\wbr{}เตรียม\wbr{}และ\wbr{}คอลัมน์\wbr{}ต่างๆ\wbr{}ที่\wbr{}แสดง\wbr{}ใน\wbr{}แต่\wbr{}ละ\wbr{}กลุ่ม\wbr{}จะ\wbr{}แยก\wbr{}แยะ\wbr{}ไว้\wbr{}ไม่\wbr{}เหมือน\wbr{}กัน\wbr{}แล้ว\wbr{}แต่\wbr{}จุด\wbr{}ประสงค์\wbr{}ของ\wbr{}กลุ่ม\wbr{}แสดง\wbr{}ผล. กลุ่ม\wbr{}แสดง\wbr{}ผล\wbr{}มี\wbr{}ดัง\wbr{}นี้
\begin{enumerate}
\item \textbf{Def} (Default) กลุ่ม\wbr{}นี้\wbr{}เป็น\wbr{}หน้า\wbr{}ต่าง\wbr{}โดย\wbr{}ปริยาย\wbr{}ใช้\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}โปร\wbr{}เซส\wbr{}ต่างๆ\wbr{}ตาม\wbr{}ลำดับ\wbr{}โดย\wbr{}เน้น\wbr{}เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}เป็น\wbr{}หลัก.
\item \textbf{Job} สำหรับ\wbr{}แสดง\wbr{}ผล\wbr{}เน้นจ็\wbr{}อบ. จะ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ตาม\wbr{}ลำดับ\wbr{}โปร\wbr{}เซส ID จาก\wbr{}มาก\wbr{}ไป\wbr{}หา\wbr{}น้อย\wbr{}โดย\wbr{}ปริยาย. คอลัมน์\wbr{}ต่างๆ\wbr{}ที่\wbr{}แสดง\wbr{}ไม่\wbr{}ต่าง\wbr{}จาก\wbr{}กลุ่ม Def มาก\wbr{}นัก. ข้อ\wbr{}มูล\wbr{}ที่\wbr{}แสดง\wbr{}แทน\wbr{}หรือ\wbr{}เพิ่ม\wbr{}เข้า\wbr{}มา\wbr{}ได้\wbr{}แก่ PPID, UID และ SWAP.

\begin{figure}[!htb]
\plfigure{.5}{top_G2.eps}{กลุ่ม\wbr{}การ\wbr{}แสดง\wbr{}ผล Job ของ\wbr{}คำ\wbr{}สั่ง \cmd{top}.}{top_G2}
\end{figure}


\begin{itemize}
\item \textbf{PPID} โปร\wbr{}เซส ID ของ\wbr{}โปร\wbr{}เซส\wbr{}พ่อ\wbr{}แม่.
\item \textbf{UID} ยูสเ\wbr{}ซอร์ ID.
\item \textbf{SWAP} แสดง\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ถูก swap out จาก\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}ใน\wbr{}หน่วย kB.
\end{itemize}
\item \textbf{Mem} (Memory) กลุ่ม\wbr{}แสดง\wbr{}ผล\wbr{}ที่\wbr{}เน้น\wbr{}สำหรับ\wbr{}ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}โดย\wbr{}เฉพาะ. ราย\wbr{}การ\wbr{}โปร\wbr{}เซส\wbr{}จะ\wbr{}เรียง\wbr{}ลำดับ\wbr{}ตาม\wbr{}ค่า \%MEM ซึ่ง\wbr{}ได้\wbr{}แก่\wbr{}จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ที่\wbr{}ใช้. ราย\wbr{}ละเอียด\wbr{}ที่\wbr{}แสดง\wbr{}เพิ่ม\wbr{}เติม\wbr{}ใน\wbr{}กลุ่ม\wbr{}นี้\wbr{}ได้\wbr{}แก่

\begin{figure}[!htb]
\plfigure{.5}{top_G3.eps}{กลุ่ม\wbr{}การ\wbr{}แสดง\wbr{}ผล Mem ของ\wbr{}คำ\wbr{}สั่ง \cmd{top}.}{top_G3}
\end{figure}


\begin{itemize}
\item \textbf{CODE} หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ที่\wbr{}ใช้\wbr{}สำหรับ\wbr{}ส่วน\wbr{}ที่\wbr{}เป็น code. รู้\wbr{}จัก\wbr{}กัน\wbr{}ใน\wbr{}อีก\wbr{}ชื่อ\wbr{}ว่า \emph{Text Resident Set (TRS)}\gindex{text resident set}\gindex{trs@TRS|see{text resident set}}.
\item \textbf{nFLT} จำนวน major page fault ที่\wbr{}เกิด\wbr{}ขึ้น\wbr{}เนื่อง\wbr{}จาก\wbr{}การ\wbr{}เขียน\wbr{}หรือ\wbr{}อ่าน address ที่\wbr{}ไม่\wbr{}ได้\wbr{}อยู่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}แต่\wbr{}อยู่\wbr{}ใน\wbr{}ฮาร์ดดิสก์.
\item \textbf{nDRT} จำนวน dirty page ได้\wbr{}แก่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่\wbr{}ข้อ\wbr{}มูล\wbr{}มี\wbr{}การ\wbr{}เปลี่ยน\wbr{}แปลง\wbr{}ต้อง\wbr{}บันทึก\wbr{}ลง\wbr{}ใน\wbr{}ฮาร์ดดิสก์.
\end{itemize}
\item \textbf{Usr} (User) กลุ่ม\wbr{}แสดง\wbr{}ผล\wbr{}เน้น\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}ยูสเ\wbr{}ซอร์\wbr{}โดย\wbr{}เรียง\wbr{}ลำดับ\wbr{}โปร\wbr{}เซส\wbr{}ตาม\wbr{}ชื่อ\wbr{}ยูสเ\wbr{}ซอร์. ราย\wbr{}ละเอียด\wbr{}ที่\wbr{}เพิ่ม\wbr{}เข้า\wbr{}มา\wbr{}ได้\wbr{}แก่

\begin{figure}[!htb]
\plfigure{.5}{top_G4.eps}{กลุ่ม\wbr{}การ\wbr{}แสดง\wbr{}ผล Usr ของ\wbr{}คำ\wbr{}สั่ง \cmd{top}.}{top_G4}
\end{figure}


\begin{itemize}
\item \textbf{RUSER} ยูสเ\wbr{}ซอร์\wbr{}จริง\wbr{}ที่\wbr{}เป็น\wbr{}เจ้า\wbr{}ของ\wbr{}โปร\wbr{}เซส.
\item \textbf{TTY} ชื่อเ\wbr{}ทอร์\wbr{}มิ\wbr{}นอล\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส.
\end{itemize}
\end{enumerate}

การ\wbr{}เปลี่ยน\wbr{}กลุ่ม\wbr{}การ\wbr{}แสดง\wbr{}ผล\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}การ\wbr{}กด\wbr{}คีย์ ``G'' แล้ว\wbr{}กด\wbr{}เลข 1 ถึง 4 ตาม\wbr{}กลุ่ม\wbr{}ที่\wbr{}ต้องการ\wbr{}แสดง. ถ้า\wbr{}ต้องการ\wbr{}แสดง\wbr{}หน้า\wbr{}ต่าง\wbr{}ทั้ง 4 แบบ\wbr{}พร้อมๆ\wbr{}กัน\wbr{}ให้\wbr{}กด\wbr{}คีย์ ``A''. มุม\wbr{}บน\wbr{}ซ้าย\wbr{}ของ\wbr{}หน้า\wbr{}จอ\wbr{}จะ\wbr{}แสดง\wbr{}หน้า\wbr{}ต่าง\wbr{}ปัจจุบัน\wbr{}ที่\wbr{}เลือก\wbr{}อยู่. ถ้า\wbr{}มี\wbr{}การ\wbr{}โต้\wbr{}ตอบ\wbr{}กับ\wbr{}โปรแกรม \cmd{top} จะ\wbr{}ถือ\wbr{}ว่า\wbr{}เป็น\wbr{}การ\wbr{}กระทำ\wbr{}กับ\wbr{}หน้า\wbr{}นั้น. ถ้า\wbr{}ต้องการ\wbr{}เปลี่ยน\wbr{}หน้า\wbr{}ต่าง\wbr{}ที่\wbr{}เลือก\wbr{}อยู่\wbr{}เป็น\wbr{}หน้า\wbr{}ต่าง\wbr{}อื่น\wbr{}ให้\wbr{}กด\wbr{}คีย์ ``a''.

\begin{figure}[!htb]
\plfigure{.5}{top_A.eps}{หน้า\wbr{}จอ \cmd{top} เมื่อ\wbr{}แสดง\wbr{}หน้า\wbr{}ต่าง 4 แบบ\wbr{}พร้อมๆ\wbr{}กัน.}{top_A}
\end{figure}

\subsection{คำ\wbr{}สั่ง\wbr{}ใน\wbr{}โปรแกรม \cmd{top}}
โปรแกรม \cmd{top} เป็น\wbr{}โปรแกรม\wbr{}แบบ\wbr{}โต้\wbr{}ตอบ, ผู้\wbr{}ใช้\wbr{}สามารถ\wbr{}กด\wbr{}คีย์\wbr{}ต่อ\wbr{}ไป\wbr{}นี้\wbr{}กระทำ\wbr{}การ\wbr{}ต่างๆ\wbr{}ได้. คำ\wbr{}สั่ง\wbr{}เหล่า\wbr{}นี้\wbr{}ใช้\wbr{}ได้\wbr{}กับ\wbr{}หน้า\wbr{}ต่าง\wbr{}กลุ่ม\wbr{}การ\wbr{}แสดง\wbr{}แสดง\wbr{}ผล\wbr{}ทุก\wbr{}แบบ.


\begin{itemize}
\item ``q'' จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน.
\item ``h'' แสดง\wbr{}หน้า\wbr{}จอ\wbr{}ช่วย\wbr{}เหลือ. การ\wbr{}ออก\wbr{}จาก\wbr{}หน้า\wbr{}จอ\wbr{}ช่วย\wbr{}เหลือ\wbr{}ให้\wbr{}กด\wbr{}คีย์\wbr{}ใดๆ.
\item ``z'' ใช้\wbr{}สี\wbr{}ใน\wbr{}การ\wbr{}แสดง\wbr{}ผล. ถ้า\wbr{}กด ``Z'' จะ\wbr{}แสดง\wbr{}คำ\wbr{}อธิบาย\wbr{}สั้นๆ\wbr{}ก่อน\wbr{}แล้ว\wbr{}ใช้\wbr{}สี\wbr{}ตาม\wbr{}ภาย\wbr{}หลัง. ถ้า\wbr{}ต้องการ\wbr{}เลิก\wbr{}ใช้\wbr{}สี\wbr{}ให้\wbr{}กด ``z'' อีก\wbr{}ที.
\item ``b'' แสดง\wbr{}บรรทัด\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}รัน\wbr{}คิว (สถานะ R) ให้\wbr{}มี\wbr{}สี\wbr{}พื้น\wbr{}หลัง\wbr{}กับ\wbr{}สี\wbr{}ตัว\wbr{}อักษร\wbr{}กลับ\wbr{}กัน. ใน\wbr{}กรณี\wbr{}จะ\wbr{}ทำ\wbr{}ให้\wbr{}เห็น\wbr{}โปร\wbr{}เซส\wbr{}สถานะ R เด่น\wbr{}ชัด\wbr{}ขึ้น.
\item ``B'' แสดง\wbr{}บรรทัด\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}สถานะ R และ\wbr{}ค่า\wbr{}สถิติ\wbr{}โดย\wbr{}รวม\wbr{}ต่างๆ\wbr{}ด้วย\wbr{}ตัว\wbr{}หนา.
\item ``l'' ซ่อน/แสดง บรรทัด\wbr{}แรก\wbr{}ที่\wbr{}เป็น\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ \cmd{uptime}.
\item ``t'' ซ่อน/แสดง บรรทัด\wbr{}สถิติ\wbr{}จำนวน\wbr{}โปร\wbr{}เซส\wbr{}แบบ\wbr{}ต่างๆ.
\item ``m'' ซ่อน/แสดง บรรทัด\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}และ swap.
\item ``u'' แสดง\wbr{}โปร\wbr{}เซส\wbr{}ของ\wbr{}ยูสเ\wbr{}ซอร์\wbr{}ที่\wbr{}ต้องการ. ให้\wbr{}ผล\wbr{}เหมือน\wbr{}กับ\wbr{}การ\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง\wbr{}ด้วย\wbr{}ตัว\wbr{}เลือก \cmd{-u \textit{user}}.
\item ``n'' หรือ ``\#'' ระบุ\wbr{}จำนวน\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ\wbr{}ดู.
\item ``d'' หรือ ``s'' ตั้ง\wbr{}ช่วง\wbr{}เวลา\wbr{}การ\wbr{}แสดง\wbr{}ผล\wbr{}ใน\wbr{}แต่\wbr{}ละ\wbr{}ครั้ง\wbr{}ใน\wbr{}หน่วย\wbr{}วินาที. คำ\wbr{}สั่ง \cmd{top} จะ\wbr{}แสดง\wbr{}ผล\wbr{}ทุกๆ 3 วินาที\wbr{}โดย\wbr{}ปริยาย. การ\wbr{}ตั้ง\wbr{}ช่วง\wbr{}เวลา\wbr{}การ\wbr{}แสดง\wbr{}ผล\wbr{}สามารถ\wbr{}ทำ\wbr{}ได้\wbr{}ด้วย\wbr{}ตัว\wbr{}เลือก \cmd{-d \textit{seconds}} เช่น\wbr{}กัน.
\item ``W'' เขียน\wbr{}ไฟล์\wbr{}ตั้ง\wbr{}ค่า\wbr{}เริ่ม\wbr{}ต้น\wbr{}ใน\wbr{}ไฟล์. การ\wbr{}ปรับ\wbr{}แต่ง\wbr{}โปรแกรม\wbr{}ต่างๆ\wbr{}เช่น สี ฯลฯ จะ\wbr{}เขียน\wbr{}เก็บ\wbr{}ไว้\wbr{}ใน\wbr{}ไฟล์  \cmd{~\ /.toprc} และ\wbr{}ใช้\wbr{}ได้\wbr{}ใหม่\wbr{}ครั้ง\wbr{}หน้า.
\item ``R'' เรียง\wbr{}ลำดับ\wbr{}จาก\wbr{}น้อย\wbr{}ไป\wbr{}หา\wbr{}มาก. คำ\wbr{}สั่ง \cmd{top} จะ\wbr{}เรียง\wbr{}ลำดับ\wbr{}โปร\wbr{}เซส\wbr{}ตาม\wbr{}คอลัมน์\wbr{}ที่\wbr{}จัด\wbr{}ลำดับ\wbr{}อยู่\wbr{}จาก\wbr{}ค่า\wbr{}มาก\wbr{}ไป\wbr{}หา\wbr{}น้อย\wbr{}โดย\wbr{}ปริยาย.
\item ``f'' เพิ่ม/ลด คอลัมน์\wbr{}ข้อ\wbr{}มูล\wbr{}ที่\wbr{}ต้องการ\wbr{}แสดง. หลัง\wbr{}จาก\wbr{}ที่\wbr{}กด\wbr{}คีย์ ``f'' แล้\wbr{}วจะ\wbr{}เปลี่ยน\wbr{}เป็น\wbr{}หน้า\wbr{}จอ\wbr{}ให้\wbr{}เลือก\wbr{}คอลัมน์\wbr{}ที่\wbr{}ต้อง\wbr{}แสดง.
\item ``o'' จัด\wbr{}ลำดับ\wbr{}คอลัมน์\wbr{}ที่\wbr{}ต้องการ\wbr{}แสดง\wbr{}ก่อน\wbr{}หลัง\wbr{}ตาม\wbr{}ต้องการ.
\item ``F'' เลือก\wbr{}คอลัมน์\wbr{}ที่\wbr{}ต้องการ\wbr{}ให้\wbr{}เรียง\wbr{}ลำดับ\wbr{}ราย\wbr{}การ\wbr{}โปร\wbr{}เซส. เช่น\wbr{}ถ้า\wbr{}คอลัมน์ \%CPU เป็น\wbr{}คอลัมน์\wbr{}สำหรับ\wbr{}เรียง\wbr{}ลำดับ\wbr{}โปร\wbr{}เซส\wbr{}ก็\wbr{}จะ\wbr{}เรียง\wbr{}ลำดับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}มี\wbr{}เปอร์เซ็นต์\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}จาก\wbr{}มาก\wbr{}ไป\wbr{}หา\wbr{}น้อย\wbr{}โดย\wbr{}ปริยาย.
\item ``k'' (kill) ส่ง\wbr{}สัญญาณ\wbr{}ให้\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}เหมือน\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{kill}. โปรแกรม \cmd{top} จะ\wbr{}ถาม PID ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ\wbr{}ส่ง\wbr{}สัญญาณ\wbr{}ไป\wbr{}ให้\wbr{}และ\wbr{}ถาม\wbr{}สัญญาณ\wbr{}ที่\wbr{}ต้องการ\wbr{}ส่ง\wbr{}ซึ่ง\wbr{}จะ\wbr{}ส่ง\wbr{}สัญญาณ SIGTERM โดย\wbr{}ปริยาย\wbr{}ถ้า\wbr{}ไม่\wbr{}ระบุ.
\item ``r'' (renice) ให้\wbr{}ผล\wbr{}เหมือน\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{renice} ใช้\wbr{}เปลี่ยน\wbr{}ค่า nice ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ.
\end{itemize}


\subsection{ทรัพยากร\wbr{}หน่วย\wbr{}ความ\wbr{}จำ}
ใน\wbr{}ลิ\wbr{}นุกซ์\wbr{}จะ\wbr{}มี\wbr{}คำ\wbr{}สั่ง \cmd{free}\cindex{free}\refcmd{free} ใช้\wbr{}สำหรับ\wbr{}แสดง\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}โดย\wbr{}รวม\wbr{}ของ\wbr{}ระบบ\wbr{}ซึ่ง\wbr{}จะ\wbr{}ให้\wbr{}ผล\wbr{}คล้าย\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{top} ใน\wbr{}ช่วง\wbr{}สรุป\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ. สิ่ง\wbr{}ที่\wbr{}แตก\wbr{}ต่าง\wbr{}จาก\wbr{}คำ\wbr{}สั่ง \cmd{top} คือ\wbr{}จะ\wbr{}แสดง\wbr{}จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}ที่\wbr{}หัก\wbr{}ลบ\wbr{}ส่วน\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}กับ buffer และ cached แสดง\wbr{}ใน\wbr{}ตัว\wbr{}อย่าง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้.

\begin{MyExample}[คำ\wbr{}สั่ง \cmd{free} แสดง\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ใน\wbr{}ระบบ.]
\begin{MyEx}
$ \cin{free}
             total       used       free     shared    buffers     cached
Mem:        903544     655784     247760          0      22348     436352
-/+ buffers/cache:     197084     706460
Swap:       505848          0     505848
\end{MyEx}
\end{MyExample}%$

ถ้า\wbr{}เป็น\wbr{}การ\wbr{}สั่ง\wbr{}คำ\wbr{}สั่ง\wbr{}โดย\wbr{}ไม่\wbr{}มี\wbr{}อาร์กิวเ\wbr{}มนต์, คำ\wbr{}สั่ง \cmd{free} จะ\wbr{}แสดง\wbr{}จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ใน\wbr{}หน่วย kB โดย\wbr{}ปริยาย.

คำ\wbr{}สั่ง\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}การ\wbr{}ตรวจ\wbr{}สอบ\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}อีก\wbr{}ตัว\wbr{}ได้\wbr{}แก่ \cmd{vmstat}\cindex{vmstat}\refcmd{vmstat}. คำ\wbr{}สั่ง \cmd{vmstat} คล้าย\wbr{}กับ \cmd{free} ที่\wbr{}ราย\wbr{}งาน\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}โดย\wbr{}รวม\wbr{}แต่\wbr{}จะ\wbr{}ให้\wbr{}ข้อ\wbr{}มูล\wbr{}อื่นๆ\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}ใน\wbr{}ระบบ\wbr{}ด้วย.

\begin{MyExample}[ใช้ \cmd{vmstat} ตรวจ\wbr{}สอบ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}ระบบ.]
\begin{MyEx}
$ vmstat 10 6
procs -----------memory---------- ---swap-- -----io---- --system-- ----cpu----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in    cs us sy id wa
 2  0      0 239848  23404 437448    0    0    26    80 1101   853 11  1 87  1
 1  0      0 239920  23440 437580    0    0    16     4 1021  1485 10  2 86  2
 0  1      0 230328  25452 438844    0    0   326     8 1071  1504 13  2 42 44
 0  1      0 224952  28108 440980    0    0   476     9 1124  1055  5  2  0 94
 0  1      0 220216  30396 441796    0    0   308    48 1069   851  3  0  0 97
 0  1      0 216184  32752 441796    0    0   235    14 1064   787  3  1  0 96
\end{MyEx}
\end{MyExample}%$

ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{vmstat} ได้\wbr{}แก่.
\begin{itemize}
\item procs\\
ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ใน\wbr{}ระบบ\wbr{}ว่า\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}กี่\wbr{}ตัว\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}รัน\wbr{}คิว (r), โปร\wbr{}เซส\wbr{}ที่\wbr{}ถูก\wbr{}บล็อก (b) หรือ\wbr{}อยู่\wbr{}ใน\wbr{}สภาพ sleep แบบ\wbr{}รบ\wbr{}กวน\wbr{}ไม่\wbr{}ได้ (uninterruptible).
\item memory\\
ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เหมือน\wbr{}คำ\wbr{}สั่ง \cmd{free} และ \cmd{top}.
\item swap\\
จำนวน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ที่ swap in (si) เข้า\wbr{}มา\wbr{}จาก\wbr{}ฮาร์ดดิสก์\wbr{}และ swap out (so) จาก\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง.หน่วย\wbr{}เป็น kB ต่อ\wbr{}วินาที.
\item IO\\
ความเร็ว\wbr{}การ\wbr{}เขียน (bo) อ่าน (bi) ข้อ\wbr{}มูล\wbr{}หน่วย\wbr{}เป็น block\mymemo{โดย\wbr{}ปรกติ 1 block มี\wbr{}ค่า 512 ไบต์.} ต่อ\wbr{}วิ\wbr{}นา\wbr{}ที่.
\item system\\
จำนวน interrupt ต่อ\wbr{}วินาที\wbr{}ที่\wbr{}เกิด\wbr{}ขึ้น (in). จำนวน context switch (cs) ต่อ\wbr{}วินาที.
\item CPU\\
เปอร์\wbr{}เซ็น\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ที่\wbr{}อยู่\wbr{}ใน user mode (us). เปอร์เซ็นต์\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}หน่วย\wbr{}ประมวล\wbr{}ใน kernel mode (sys). เปอร์เซ็นต์\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ว่าง (id) และ\wbr{}เปอร์เซ็นต์\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}รอ IO (wa).
\end{itemize}

นอก\wbr{}จาก\wbr{}คำ\wbr{}สั่ง \cmd{vmstat} ยัง\wbr{}มี\wbr{}คำ\wbr{}สั่ง\wbr{}ราย\wbr{}งาน\wbr{}สถิติ\wbr{}ต่างๆ\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}ระบบ\wbr{}ใน\wbr{}ทำนอง\wbr{}เดียว\wbr{}กัน\wbr{}ได้\wbr{}แก่ \cmd{iostat}\cindex{iostat} ใช้\wbr{}แสดง\wbr{}สถิติ\wbr{}การ\wbr{}ถ่าย\wbr{}โอน\wbr{}ข้อ\wbr{}มูล\wbr{}ของดิสก์\wbr{}และ \cmd{mpstat}\cindex{mpstat} ใช้\wbr{}แสดง\wbr{}สถิติ\wbr{}เกี่ยว\wbr{}กับ\wbr{}การ\wbr{}ใช้\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ซึ่ง\wbr{}จะ\wbr{}ไม่\wbr{}กล่าว\wbr{}ถึง\wbr{}ใน\wbr{}ที่\wbr{}นี้.


\section{จับ\wbr{}เวลา\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส}
การ\wbr{}จับ\wbr{}เวลา\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}เป็น\wbr{}เรื่อง\wbr{}ที่\wbr{}เกิด\wbr{}ขึ้น\wbr{}บ่อย\wbr{}ครั้ง\wbr{}โดย\wbr{}เฉพาะ\wbr{}เวลา\wbr{}ที่\wbr{}ต้องการ\wbr{}สำรวจ\wbr{}เวลา\wbr{}ที่\wbr{}ใช้\wbr{}ใน\wbr{}การ\wbr{}รัน\wbr{}โปรแกรม\wbr{}ที่\wbr{}สร้าง\wbr{}ขึ้น\wbr{}เอง. คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ใช้\wbr{}จับ\wbr{}เวลา\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}คือ \cmd{time}.\cindex{time}\refcmd{time}
\begin{MyExample}[จับ\wbr{}เวลา\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}คำ\wbr{}สั่ง.]
\begin{MyEx}
$ \cin{time cp aowthai-5.5.92-i386-cd1.iso /mnt/usb}

real    0m45.845s
user    0m0.033s
sys     0m2.040s
\end{MyEx}
\end{MyExample}%$

เวลา\wbr{}ที่\wbr{}ใช้\wbr{}ทำ\wbr{}งาน\wbr{}จริง\wbr{}ตั้ง\wbr{}แต่\wbr{}เริ่ม\wbr{}ทำ\wbr{}งาน\wbr{}จน\wbr{}จบ (real) ได้\wbr{}แก่\wbr{}ค่าที่\wbr{}แสดง\wbr{}ใน\wbr{}บรรทัด\wbr{}แรก. เวลา\wbr{}ที่\wbr{}ใช้\wbr{}ไป\wbr{}จะ\wbr{}ช้า\wbr{}หรือ\wbr{}เร็ว\wbr{}ขึ้น\wbr{}กับ\wbr{}ระบบ\wbr{}ตอน\wbr{}นั้น\wbr{}ว่า\wbr{}ทำ\wbr{}งาน\wbr{}หนัก\wbr{}อยู่\wbr{}หรือ\wbr{}ไม่. ส่วน\wbr{}เวลา\wbr{}ที่\wbr{}แสดง\wbr{}ใน\wbr{}บรรทัด\wbr{}ที่\wbr{}สอง (user) บอก\wbr{}เวลา\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ใน user mode. และ\wbr{}บรรทัด\wbr{}สุด\wbr{}ท้าย (sys) แสดง\wbr{}เวลา\wbr{}ที่\wbr{}หน่วย\wbr{}ประมวล\wbr{}ผล\wbr{}ใช้\wbr{}ไป\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ใน kernel mode. จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}ข้าง\wbr{}บน\wbr{}เป็น\wbr{}การ\wbr{}ก็\wbr{}อป\wbr{}ปี้\wbr{}ไฟล์\wbr{}ใหญ่ๆ. ใน\wbr{}กรณี\wbr{}นี้\wbr{}ทำ\wbr{}ให้\wbr{}รู้\wbr{}ว่า\wbr{}หน่วย\wbr{}ประมวล\wbr{}ใช้\wbr{}เวลา\wbr{}ไป\wbr{}กับ\wbr{}ระบบ (kernel) มาก\wbr{}กว่า\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}จริงๆ (user).


%\section{limit resource}
%
%ulimit, sysctl

\section{ไฟล์\wbr{}และ\wbr{}โปร\wbr{}เซส}
โปร\wbr{}เซส\wbr{}จะ\wbr{}มี\wbr{}ความ\wbr{}สัมพันธ์\wbr{}กับ\wbr{}ไฟล์\wbr{}หรือ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}เสมอ. เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}เริ่ม\wbr{}กระทำ\wbr{}การ, โปร\wbr{}เซส\wbr{}จะ\wbr{}รับ\wbr{}รู้\wbr{}สภาพ\wbr{}แวด\wbr{}ล้อม\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}เช่น\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่ (current working directory). \mymemo{ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}นี้\wbr{}สามารถ\wbr{}ตรวจ\wbr{}สอบ\wbr{}ได้\wbr{}จาก\wbr{}ไฟล์ \cmd{/proc/\textit{PID}/cwd}. cwd ย่อ\wbr{}มา\wbr{}จาก current working directory.}, ไฟล์\wbr{}ที่\wbr{}เปิด\wbr{}ใช้\wbr{}อยู่ เป็นต้น.

\subsection{หา\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์}
ถ้า\wbr{}ต้องการ\wbr{}ตรวจ\wbr{}ไฟล์\wbr{}ฉบับ\wbr{}หนึ่ง\wbr{}ว่า\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}อะไร\wbr{}บ้าง\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}นั้น\wbr{}อยู่, ให้\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{fuser}\refcmd{fuser}\cindex{fuser} โดย\wbr{}ระบุ\wbr{}ชื่อ\wbr{}ไฟล์.

\begin{MyExample}[ตรวจ\wbr{}ดู\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์ \cmd{/bin/bash}.]
\begin{MyEx}
$ \cin{fuser -uv /bin/bash}

                     USER        PID ACCESS COMMAND
/bin/bash            poonlap    7820 ...e.  bash
                     poonlap    7826 ...e.  firefox
                     poonlap    7848 ...e.  thunderbird
                     poonlap    8213 ...e.  xdvi
\end{MyEx}
\end{MyExample}%$

ใน\wbr{}กรณี\wbr{}นี้\wbr{}มี\wbr{}การ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-u} เพื่อ\wbr{}ให้\wbr{}คำ\wbr{}สั่ง \cmd{fuser} (user) แสดง\wbr{}ชื่อ\wbr{}ผู้\wbr{}ใช้, และ\wbr{}ตัว\wbr{}เลือก \cmd{-v} (verbose) เพื่อ\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}ไฟล์\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}นั้น. ใน\wbr{}คอลัมน์ ACCESS เป็น\wbr{}ราย\wbr{}ละเอียด\wbr{}การ\wbr{}ใช้\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ต่อ\wbr{}ไฟล์\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}มี\wbr{}ความ\wbr{}หมาย\wbr{}ดัง\wbr{}นี้.
\begin{itemize}
\item c: ไดเ\wbr{}รกท\wbr{}อร\wbr{}ที่\wbr{}ตรวจ\wbr{}สอบ\wbr{}เป็น\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ปัจจุบัน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}นั้นๆ.
\item e: ไฟล์\wbr{}นั้น\wbr{}กำลัง\wbr{}ถู\wbr{}กรัน\wbr{}อยู่.
\item f: ไฟล์\wbr{}ถูก\wbr{}เปิด\wbr{}ใช้\wbr{}อยู่.
\item r: รูท\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี.
\item m: ไฟล์\wbr{}ถูกแม็ป\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}หรือ\wbr{}เป็น shared library.
\end{itemize}

จาก\wbr{}ตัว\wbr{}อย่าง\wbr{}ทำ\wbr{}ให้\wbr{}เรา\wbr{}รู้\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}ชื่อ bash, firefox, thunderbird และ xdvi กำลัง\wbr{}รัน\wbr{}ไฟล์ \cmd{/bin/bash} อยู่\mymemo{ใน\wbr{}กรณี\wbr{}นี้ \cmd{firefox}, \cmd{thunderbird} และ \cmd{xdvi} เป็น\wbr{}เชลล์สค\wbr{}ริปต์, ไม่\wbr{}ใช่\wbr{}ไฟล์ไบ\wbr{}นารี. ไฟล์ไบ\wbr{}นารี\wbr{}ที่\wbr{}แท้\wbr{}จริง\wbr{}ได้\wbr{}แก่ \cmd{firefox-bin}, \cmd{thunderbird-bin} และ \cmd{xdvi.bin}.}. นี่\wbr{}เป็น\wbr{}วิธี\wbr{}หนึ่ง\wbr{}ที่\wbr{}สามารถ\wbr{}ตรวจ\wbr{}เวลา\wbr{}สงสัย\wbr{}ว่า\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}อะไร\wbr{}บ้าง\wbr{}ใช้\wbr{}ไฟล์\wbr{}ที่\wbr{}ระบุ. มี\wbr{}ประโยชน์\wbr{}ใช้\wbr{}หา\wbr{}โปร\wbr{}เซส\wbr{}แปลก\wbr{}ปลอม\wbr{}ที่\wbr{}กำลัง\wbr{}จะ\wbr{}เข้า\wbr{}ถึง\wbr{}ไฟล์\wbr{}สำคัญๆ\wbr{}ใน\wbr{}ระบบ\wbr{}ได้.


บาง\wbr{}ครั้ง\wbr{}เรา\wbr{}ต้องการ\wbr{}จะ unmount พาร์ทิ\wbr{}ชัน\wbr{}ออก\wbr{}จาก\wbr{}ระบบ\wbr{}ไฟล์\wbr{}แต่\wbr{}ไม่\wbr{}สามารถ umount ได้\wbr{}และ\wbr{}เกิด error ว่า ``device is busy''. สาเหตุ\wbr{}ที่\wbr{}ไม่\wbr{}สามารถ unmount อาจ\wbr{}เกิด\wbr{}จาก\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}ไฟล์\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}พาร์ทิ\wbr{}ชัน\wbr{}นั้น, หรือ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}พาร์ทิ\wbr{}ชัน\wbr{}นั้น\wbr{}เป็น\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}บาง\wbr{}ตัว. ใน\wbr{}กรณี\wbr{}นี้\wbr{}ก็\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{fuser} ตรวจ\wbr{}สอบ\wbr{}กับ\wbr{}ตัว\wbr{}เลือก \cmd{-m} หมาย\wbr{}ถึง\wbr{}ต้องการ\wbr{}ตรวจ\wbr{}สอบ\wbr{}ทั้ง\wbr{}ระบบ\wbr{}ไฟล์, ไม่\wbr{}ใช้\wbr{}ไฟล์\wbr{}เดี่ยวๆ.

\begin{MyExample}[หา\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ระบบ\wbr{}ไฟล์.]
\begin{MyEx}
$ \cmd{eject}
umount: /mnt/cdrom: device is busy
umount: /mnt/cdrom: device is busy
eject: unmount of `/dev/cdrom' failed
$ \cin{fuser -muv /mnt/cdrom}

                     USER        PID ACCESS COMMAND
/mnt/cdrom/          poonlap    7941 ..c..  bash
                     poonlap   27237 f.c.m  mpg321
\end{MyEx}
\end{MyExample}

ตัว\wbr{}อย่าง\wbr{}ข้าง\wbr{}บน\wbr{}เป็น\wbr{}การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{eject}\cindex{eject}\refcmd{eject} เพื่อ\wbr{}เอา CD ออก\wbr{}จากไ\wbr{}ดรว์\wbr{}ได้. คำ\wbr{}สั่ง \cmd{eject} จะ\wbr{}พยายาม unmount ก่อน\wbr{}แล้ว\wbr{}ดีด CD ออก\wbr{}มา. แต่\wbr{}ใน\wbr{}กรณี\wbr{}นี้\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}หรือ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{/mnt/cdrom} อยู่\wbr{}จึง\wbr{}ต้อง\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{fuser} ตรวจ\wbr{}สอบ\wbr{}โปร\wbr{}เซส.

จาก\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง\wbr{}ทำ\wbr{}ให้\wbr{}เรา\wbr{}รู้\wbr{}ว่า\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{/mnt/cdrom} ไม่\wbr{}สามารถ unmount ได้\wbr{}เพราะ\wbr{}มี\wbr{}โปร\wbr{}เซส bash และ mpg321 ทำ\wbr{}งาน\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}กับ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}นั้น\wbr{}อยู่. ถ้า\wbr{}ต้องการ unmount ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{/mnt/cdrom} ต้อง\wbr{}ฆ่า\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}การ\wbr{}กับ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}นั้น\wbr{}ก่อน, ซึ่ง\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{kill} โดย\wbr{}ให้\wbr{}โปร\wbr{}เซส ID ที\wbr{}แสดง\wbr{}ใน\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{fuser}. หรือ\wbr{}ถ้า\wbr{}ไม่\wbr{}สน\wbr{}ใจ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{/mnt/cdrom} เป็น\wbr{}โปร\wbr{}เซส\wbr{}อะไร\wbr{}แต่\wbr{}ต้องการ\wbr{}จะ\wbr{}ฆ่า\wbr{}โปร\wbr{}เซส\wbr{}ทุก\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}หรือ\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}กับ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}นั้น\wbr{}อยู่, ให้\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-k} ประกอบ\wbr{}กับ\wbr{}คำ\wbr{}สั่ง \cmd{fuser}.

\begin{MyExample}[ใช้ \cmd{fuser} ฆ่า\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}หรือ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}ระบุ.]
\begin{MyEx}
$ \cin{fuser -k /mnt/cdrom/}
/mnt/cdrom/:          7941c 27237c
kill 27237: No such process
No automatic removal. Please use  umount /mnt/cdrom
\end{MyEx}
\end{MyExample}%$

ใน\wbr{}กรณี\wbr{}นี้\wbr{}คำ\wbr{}สั่ง \cmd{fuser} จะ\wbr{}ฆ่า\wbr{}โปร\wbr{}เซส 7941 และ 27237 ตาม\wbr{}ลำดับ. แต่\wbr{}มี error ว่า\wbr{}หา\wbr{}โปร\wbr{}เซส 27237 ไม่\wbr{}เจอ\wbr{}เพราะ\wbr{}ใน\wbr{}ความ\wbr{}เป็น\wbr{}จริง\wbr{}แล้ว\wbr{}โปร\wbr{}เซส 27237 เป็น\wbr{}โปรแกรม \cmd{mpg321}\mymemo{โปรแกรม \cmd{mpg321} เป็น\wbr{}โปรแกรม\wbr{}คำ\wbr{}สั่ง\wbr{}สำหรับ\wbr{}เล่น\wbr{}ไฟล์ mp3, ogg ฯลฯ.} ที่\wbr{}รัน\wbr{}อยู่\wbr{}ใน\wbr{}เชลล์ (โปร\wbr{}เซส 7941) เมื่อ\wbr{}โปร\wbr{}เซส 7941 ตาย\wbr{}ไป\wbr{}แล้ว\wbr{}ทำ\wbr{}ให้\wbr{}โปร\wbr{}เซส 27237 ตาย\wbr{}ตาม\wbr{}ไป\wbr{}ด้วย.

ตัว\wbr{}เลือก \cmd{-m} ไม่\wbr{}ได้\wbr{}ใช้\wbr{}สำหรับ\wbr{}หา\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}ใต้\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}ระบุ, แต่\wbr{}เป็น\wbr{}การ\wbr{}หา\wbr{}ทั้ง\wbr{}ระบบ\wbr{}ไฟล์\wbr{}ของ\wbr{}ไฟล์\wbr{}ที่\wbr{}ระบุ. ตัว\wbr{}อย่าง\wbr{}เช่น\wbr{}ถ้า\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-m} และ\wbr{}ระบุ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}จะ\wbr{}ได้\wbr{}ผล\wbr{}ดัง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้.
\begin{MyExample}[ผล\wbr{}ของ\wbr{}ตัว\wbr{}เลือก \cmd{-m} ต่อ\wbr{}ชื่อ\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}หรือ\wbr{}ไฟล์.]
\begin{MyEx}
$ \cin{fuser -muv /tmp}

                     USER        PID ACCESS COMMAND
/tmp                 root          1 .rce.  init
                     root          2 .rc..  ksoftirqd/0
                     root          3 .rc..  events/0
                     root          4 .rc..  kblockd/0
\abb
$ \cin{mount}
/dev/hdb1 on / type ext3 (rw,noatime)
devfs on /dev type devfs (rw)
none on /proc type proc (rw)
none on /sys type sysfs (rw)
none on /dev/pts type devpts (rw)
/dev/hdb2 on /home type ext3 (rw,noatime)
/dev/hda3 on /mnt/hda type ext3 (rw,noatime)
none on /dev/shm type tmpfs (rw)
none on /proc/bus/usb type usbfs (rw)
/dev/cdrom on /mnt/cdrom type iso9660 (ro,noexec,nosuid,nodev,user=poonlap)
\end{MyEx}
\end{MyExample}%
คำ\wbr{}สั่ง \cmd{fuser} จะ\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}จริงๆ\wbr{}แล้ว\wbr{}ไม่\wbr{}ได้\wbr{}ใช้\wbr{}ไฟล์\wbr{}ที่\wbr{}อยู่\wbr{}ใต้\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{tmp} เพราะ\wbr{}ตัว\wbr{}เลือก \cmd{-m} หมาย\wbr{}ถึง\wbr{}ระบบ\wbr{}ไฟล์ (พาร์ทิ\wbr{}ชัน). ใน\wbr{}กรณี\wbr{}นี้, ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{tmp} อยู่\wbr{}ใน\wbr{}พาร์ทิ\wbr{}ชัน \cmd{/dev/hdb1}, ดัง\wbr{}นั้น\wbr{}คำ\wbr{}สั่ง \cmd{fuser} จึง\wbr{}แสดง\wbr{}โปร\wbr{}เซส\wbr{}ทั้ง\wbr{}หมด\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}กับ\wbr{}พาร์ทิ\wbr{}ชัน\wbr{}นั้น.

\medskip
คำ\wbr{}สั่ง\wbr{}ที่\wbr{}คล้าย\wbr{}กับ \cmd{fuser} แต่\wbr{}สามารถ\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ได้\wbr{}มาก\wbr{}กว่า\wbr{}ได้\wbr{}แก่\wbr{}คำ\wbr{}สั่ง \cmd{lsof}\cindex{lsof}\refcmd{lsof}. ถ้า\wbr{}ต้องการ\wbr{}หา\wbr{}ว่า\wbr{}มี\wbr{}โปร\wbr{}เซส\wbr{}อะไร\wbr{}บ้าง\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}ใต้\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{/tmp} รวม\wbr{}ถึง\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ย่อย, จะ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{+D}.
\begin{MyExample}[ใช้ \cmd{lsof} หา\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ใช้\wbr{}ไฟล์\wbr{}ใน\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}ระบุ.]
\begin{MyEx}
# \cin{lsof +D /tmp}
COMMAND     PID    USER   FD   TYPE     DEVICE SIZE   NODE NAME
cannaserv  5914    root    0u  unix 0xecc81380        9957 /tmp/.iroha_unix/IROHA
cannaserv  5914    root    3u  unix 0xf7311380        6687 /tmp/.iroha_unix/IROHA
famd       7216 poonlap    4u  unix 0xf254e200        9279 /tmp/.fampnWIDy
famd       7216 poonlap    5u  unix 0xf0e58800        9437 /tmp/.famL21ZzK
\abb
\end{MyEx}
\end{MyExample}

คำ\wbr{}สั่ง \cmd{lsof} จะ\wbr{}แสดง\wbr{}ราย\wbr{}ละเอียด\wbr{}ต่างๆ\wbr{}ใน\wbr{}แต่\wbr{}ละ\wbr{}คอลัมน์\wbr{}ได้\wbr{}แก่ ชื่อ\wbr{}คำ\wbr{}สั่ง (COMMAND), โปร\wbr{}เซส ID (PID), ชื่อ\wbr{}ผู้\wbr{}ใช้ (USER), file descriptor (FD), ประเภท\wbr{}ของ\wbr{}ไฟล์ (TYPE), ประเภท\wbr{}ดี\wbr{}ไวซ์ (DEVICE), ขนาด (SIZE), เลข i-node (NODE) และ\wbr{}ชื่อ\wbr{}ไฟล์ (NAME).

คอลัมน์\wbr{}ที่\wbr{}น่า\wbr{}สน\wbr{}ใจ\wbr{}ที่\wbr{}ควร\wbr{}รู้\wbr{}จัก\wbr{}ใน\wbr{}ที่\wbr{}นี้\wbr{}ได้\wbr{}แก่\wbr{}คอลัมน์ FD ซึ่ง\wbr{}จะ\wbr{}บอ\wbr{}กราย\wbr{}เอียด\wbr{}เกี่ยว\wbr{}กับ file descriptor แบ่ง\wbr{}เป็น
\begin{itemize}
\item \textbf{cwd} (current working directory) ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}งาน\wbr{}อยู่.
\item \textbf{ltx} (library text) ข้อ\wbr{}มูล\wbr{}ของ shared library ได้\wbr{}แก่\wbr{}ส่วน\wbr{}ที่\wbr{}เป็น code และ data.
\item \textbf{mem} (memory-mapped file) ไฟล์\wbr{}ที่แม็ป\wbr{}ไว้\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ.
\item \textbf{mmap} (memory-mapped device) ไฟล์\wbr{}ดี\wbr{}ไวส์\wbr{}ที่แม็ป\wbr{}ไว้\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ.
\item \textbf{pd} (parent directory) ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}พ่อ\wbr{}แม่.
\item \textbf{rtd} (root directory) ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}รูท.
\item \textbf{txt} (program text) ข้อ\wbr{}มูล\wbr{}ของ\wbr{}โปรแกรม\wbr{}ใน\wbr{}ส่วน\wbr{}ของ code และ data.
\item \textbf{\textit{N}} ตัว\wbr{}เลข\wbr{}เฉพาะ\wbr{}ของ file descriptor. ตาม\wbr{}ด้วย\wbr{}อักษร\wbr{}ต่อ\wbr{}ไป\wbr{}นี้\wbr{}บ่ง\wbr{}บอก\wbr{}ถึง\wbr{}การ\wbr{}เข้า\wbr{}ถึง\wbr{}ของ\wbr{}ไฟล์\wbr{}นั้น\wbr{}ได้\wbr{}แก่
\begin{itemize}
\item \textbf{r} สิทธิ์\wbr{}การ\wbr{}อ่าน
\item \textbf{w} สิทธิ์\wbr{}การ\wbr{}เขียน
\item \textbf{u} สิทธิ์\wbr{}การ\wbr{}อ่าน\wbr{}และ\wbr{}เขียน
\end{itemize}
\end{itemize}

คอลัมน์ TYPE แสดง\wbr{}ประเภท\wbr{}ของ\wbr{}ไฟล์\wbr{}เช่น
\begin{itemize}
\item \textbf{DIR} (directory) ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี
\item \textbf{REG} (regular file) ไฟล์\wbr{}ธรรม\wbr{}ดา
\item \textbf{CHR} (character device) ไฟล์\wbr{}ดี\wbr{}ไวซ์\wbr{}แบบ character.
\item \textbf{IPv4} (IPv4 socket) เน็ตเ\wbr{}วิร์ก socket สื่อ\wbr{}สาร\wbr{}ประเภท IP version 4.
\item \textbf{FIFO} (first in first out) ไปป์
\item \textbf{unix} (Unix domain socket) ไฟล์ socket
\end{itemize}


\subsection{หา\wbr{}ไฟล์\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้}
ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ต่างๆ\wbr{}จะ\wbr{}อยู่\wbr{}ใน\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ชื่อ\wbr{}เป็น\wbr{}โปร\wbr{}เซส ID ใต้\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{proc}. เรา\wbr{}สามารถ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{cat} ดู\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}เหล่า\wbr{}นั้น\wbr{}กำลัง\wbr{}ใช้\wbr{}ไฟล์\wbr{}อะไร\wbr{}อยู่\wbr{}ได้. แต่\wbr{}วิธี\wbr{}นี้\wbr{}ไม่\wbr{}สะดวก\wbr{}มาก\wbr{}นัก\wbr{}เพราะ\wbr{}เป็น\wbr{}การ\wbr{}ดู\wbr{}ข้อ\wbr{}มูล\wbr{}ดิบ\wbr{}โดย\wbr{}ตรง. คำ\wbr{}สั่ง\wbr{}ที่\wbr{}อำนวย\wbr{}ความ\wbr{}สะดวก\wbr{}ใช้\wbr{}ตรวจ\wbr{}สอบ\wbr{}ดู\wbr{}โปร\wbr{}เซส\wbr{}ว่า\wbr{}กำลัง\wbr{}ใช้\wbr{}ไฟล์\wbr{}อะไร\wbr{}อยู่\wbr{}บ้าง\wbr{}ได้\wbr{}แก่ \cmd{lsof}\cindex{lsof}\refcmd{lsof} แสดง\wbr{}ไฟล์\wbr{}ทั้ง\wbr{}หมด\wbr{}ที่\wbr{}เปิด\wbr{}ใช้\wbr{}อยู่\wbr{}และ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}เกี่ยว\wbr{}ข้อง\wbr{}กับ\wbr{}ไฟล์\wbr{}นั้น.
%ใน\wbr{}ทาง\wbr{}กลับ\wbr{}กัน\wbr{}ถ้า\wbr{}ต้องการ\wbr{}ตรวจ\wbr{}สอบ\wbr{}ดู\wbr{}โปร\wbr{}เซส\wbr{}ว่า\wbr{}กำลัง\wbr{}เปิด\wbr{}ใช้\wbr{}ไฟล์\wbr{}อะไร\wbr{}อยู่\wbr{}บ้าง, สามารถ\wbr{}ดู\wbr{}จาก\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{fd} (file descriptor) ใต้ \cmd{/pro/\textit{PID}}. ก่อน\wbr{}อื่น\wbr{}ต้อง\wbr{}หา\wbr{}โปร\wbr{}เซส ID ของ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ\wbr{}ตรวจ\wbr{}สอบ, เช่น\wbr{}โปร\wbr{}เซส xdvi.bin กำลัง\wbr{}ใช้\wbr{}ไฟล์\wbr{}อะไร\wbr{}อยู่\wbr{}บ้าง\wbr{}สามารถ\wbr{}ตรวจ\wbr{}สอบ\wbr{}ได้\wbr{}ตาม\wbr{}ตัว\wbr{}อย่าง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้.
%\begin{MyExample}[ดู\wbr{}ไฟล์\wbr{}ที่\wbr{}เปิด\wbr{}ใช้\wbr{}งาน\wbr{}โดย\wbr{}โปร\wbr{}เซส\wbr{}จาก\wbr{}ระบบ\wbr{}ไฟล์ \cmd{/proc}]
%\begin{MyEx}
%$ \cin{ls -l /proc/`pgrep xdvi.bin`/fd}
%total 12
%lrwx------    1 poonlap  users          64 Dec  8 20:42 0 -> /dev/pts/0
%lrwx------    1 poonlap  users          64 Dec  8 20:42 1 -> /dev/pts/0
%l-wx------    1 poonlap  users          64 Dec  8 20:42 11 -> pipe:[10725]
%lr-x------    1 poonlap  users          64 Dec  8 20:42 12 -> pipe:[10726]
%l-wx------    1 poonlap  users          64 Dec  8 20:42 2 -> /dev/null
%lrwx------    1 poonlap  users          64 Dec  8 20:42 3 -> socket:[10718]
%lr-x------    1 poonlap  users          64 Dec  8 20:42 4 -> /home/poonlap/.mail
%cap
%lr-x------    1 poonlap  users          64 Dec  8 20:42 5 -> /home/poonlap/BOOK/
%linuxbook/linux.dvi
%lr-x------    1 poonlap  users          64 Dec  8 20:42 6 -> /var/cache/fonts/pk
%/ljfour/jknappen/tc/tctt1440.600pk
%lr-x------    1 poonlap  users          64 Dec  8 20:42 7 -> /var/cache/fonts/pk
%/ljfour/jknappen/tc/tctt0800.600pk
%lr-x------    1 poonlap  users          64 Dec  8 20:42 8 -> /var/cache/fonts/pk
%/ljfour/jknappen/tc/tctt1200.600pk
%lr-x------    1 poonlap  users          64 Dec  8 20:42 9 -> /var/cache/fonts/pk
%/ljfour/jknappen/tc/tcrm1200.600pk
%\end{MyEx}
%\end{MyExample}%$
%
%ชื่อ\wbr{}ไฟล์\wbr{}ที่\wbr{}อยู่\wbr{}ใต้\wbr{}ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี \cmd{fd} จะ\wbr{}เป็น\wbr{}ตัว\wbr{}เลข\wbr{}ได้\wbr{}แก่ file descriptor ของ\wbr{}โปร\wbr{}เซส\wbr{}และ\wbr{}เป็น symbolic link ไป\wbr{}หา\wbr{}ไฟล์\wbr{}จริง\wbr{}ที่\wbr{}ใช้\wbr{}อยู่. จาก\wbr{}การ\wbr{}แสดง\wbr{}ผล\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{ls} ข้าง\wbr{}บน\wbr{}ทำ\wbr{}ให้\wbr{}เรา\wbr{}รู้\wbr{}ว่า\wbr{}โปร\wbr{}เซส xdvi.bin กำลัง\wbr{}ใช้\wbr{}ไฟล์\wbr{}อะไร\wbr{}อยู่\wbr{}บ้าง, มี\wbr{}ทั้ง\wbr{}ไฟล์\wbr{}ธรรม\wbr{}ดา, ไฟล์\wbr{}ดี\wbr{}ไวซ์, socket และ\wbr{}ไปป์.


ตัว\wbr{}อย่าง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้\wbr{}เป็น\wbr{}การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{lsof} ตรวจ\wbr{}สอบ\wbr{}ดู\wbr{}ว่า\wbr{}โปร\wbr{}เซส xdvi.bin กำลัง\wbr{}เปิด\wbr{}ใช้\wbr{}ไฟล์\wbr{}อะไร\wbr{}บ้าง. ตัว\wbr{}เลือก \cmd{-c} ใช้\wbr{}สำหรับ\wbr{}เลือก\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ขึ้น\wbr{}ต้น\wbr{}ด้วย\wbr{}อักษร\wbr{}ที่\wbr{}กำหนด\wbr{}เป็น\wbr{}อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}ตัว\wbr{}เลือก.

\begin{MyExample}[ดู\wbr{}ไฟล์\wbr{}ที่\wbr{}เปิด\wbr{}ใช้\wbr{}โดย\wbr{}โปร\wbr{}เซส xdvi.bin ทั้ง\wbr{}หมด.]
\begin{MyEx}
$ \cin{/usr/sbin/lsof -c xdvi.bin}
COMMAND   PID    USER   FD   TYPE     DEVICE    SIZE    NODE NAME
xdvi.bin 8677 poonlap  cwd    DIR       3,66    4096  587529 /home/poonlap/BOOK/\wrap
linuxbook
xdvi.bin 8677 poonlap  rtd    DIR       3,65    4096       2 /
xdvi.bin 8677 poonlap  txt    REG       3,65  344180  725577 /usr/bin/xdvi.bin
xdvi.bin 8677 poonlap  mem    REG       3,65   90796 1313292 /lib/ld-2.3.4.so
xdvi.bin 8677 poonlap  mem    REG       3,65   10572  823279 /usr/X11R6/lib/X11/\wrap
locale/lib/common/xlcDef.so.2
xdvi.bin 8677 poonlap  mem    REG       3,65   15480  724869 /usr/lib/libwwwsql.
so.0.1.0
xdvi.bin 8677 poonlap  mem    REG       3,65    8472  724849 /usr/lib/libwwwinit\wrap
.so.0.1.0
\abb
xdvi.bin 8677 poonlap  mem    REG       3,65   40759  826417 /usr/X11R6/lib/libX\wrap
cursor.so.1.0
xdvi.bin 8677 poonlap  mem    REG       3,65   32191  826396 /usr/X11R6/lib/libX\wrap
render.so.1.2
xdvi.bin 8677 poonlap    0u   CHR      136,0               2 /dev/pts/0
xdvi.bin 8677 poonlap    1u   CHR      136,0               2 /dev/pts/0
xdvi.bin 8677 poonlap    2w   CHR        1,3               6 /dev/null
xdvi.bin 8677 poonlap    3u  unix 0xe8cdf980           10718 socket
xdvi.bin 8677 poonlap    4r   REG       3,66    2361  575351 /home/poonlap/.mail\wrap
cap
xdvi.bin 8677 poonlap    5r   REG       3,66 1964924  604123 /home/poonlap/BOOK/\wrap
linuxbook/linux.dvi
xdvi.bin 8677 poonlap    6r   REG       3,65   14312 1204286 /var/cache/fonts/pk\wrap
/ljfour/jknappen/tc/tctt1440.600pk
xdvi.bin 8677 poonlap    7r   REG       3,65    7572  923858 /var/cache/fonts/pk\wrap
/ljfour/jknappen/tc/tctt0800.600pk
xdvi.bin 8677 poonlap    8r   REG       3,65   11524  923854 /var/cache/fonts/pk\wrap
/ljfour/jknappen/tc/tctt1200.600pk
xdvi.bin 8677 poonlap    9r   REG       3,65   14220  923849 /var/cache/fonts/pk\wrap
/ljfour/jknappen/tc/tcrm1200.600pk
xdvi.bin 8677 poonlap   11w  FIFO        0,7           10725 pipe
xdvi.bin 8677 poonlap   12r  FIFO        0,7           10726 pipe
\end{MyEx}
\end{MyExample}%$

จะ\wbr{}เห็น\wbr{}ว่า\wbr{}โปร\wbr{}เซสๆ\wbr{}หนึ่ง\wbr{}เปิด\wbr{}ใช้\wbr{}ไฟล์\wbr{}หลาย\wbr{}ไฟล์\wbr{}ใน\wbr{}เวลา\wbr{}เดียว\wbr{}กัน, ไดเ\wbr{}รก\wbr{}ทอ\wbr{}รี\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่, ไฟล์\wbr{}โปรแกรม\wbr{}ของ\wbr{}โปร\wbr{}เซส, ไปป์, ไฟล์ไ\wbr{}ลบ\wbr{}รา\wbr{}รี\wbr{}ที่แม็ป\wbr{}ไว้\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ ฯลฯ.

\medskip
คำ\wbr{}สั่ง \cmd{lsof} มี\wbr{}ประโยชน์\wbr{}อย่าง\wbr{}ยิ่ง\wbr{}ต่อ\wbr{}การ\wbr{}ดู\wbr{}แล\wbr{}ระบบ, สามารถ\wbr{}หา\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}กำลัง\wbr{}เปิด\wbr{}ใช้\wbr{}ไฟล์\wbr{}ได้\wbr{}และ\wbr{}หา\wbr{}ไฟล์\wbr{}ที่\wbr{}ใช้\wbr{}โดย\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}เช่น\wbr{}กัน. ข้อ\wbr{}มูล\wbr{}เหล่า\wbr{}นี้\wbr{}บาง\wbr{}ที\wbr{}สามารถ\wbr{}บอก\wbr{}ได้\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}นั้นๆ\wbr{}เป็น\wbr{}โปร\wbr{}เซส\wbr{}แปลก\wbr{}ปลอม\wbr{}หรือ\wbr{}ไม่. ตัว\wbr{}เลือก\wbr{}ที่\wbr{}น่า\wbr{}สน\wbr{}ใจ\wbr{}อื่นๆ\wbr{}เช่น \cmd{-u \textit{user}} สามารถ\wbr{}ใช้\wbr{}ดู\wbr{}ไฟล์\wbr{}และ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}รัน\wbr{}อยู่\wbr{}โดย\wbr{}ผู้\wbr{}ใช้\wbr{}ที่\wbr{}ระบุ\wbr{}ได้. คำ\wbr{}สั่ง \cmd{lsof} เป็น\wbr{}คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ค่อน\wbr{}ข้าง\wbr{}ซับ\wbr{}ซ้อน\wbr{}อีก\wbr{}คำ\wbr{}สั่ง\wbr{}และ\wbr{}มี\wbr{}ตัว\wbr{}เลือก\wbr{}หลาย\wbr{}ตัว. สำหรับ\wbr{}ราย\wbr{}ละเอียด\wbr{}ของ\wbr{}ตัว\wbr{}เลือก\wbr{}ให้\wbr{}อ่าน\wbr{}จาก \cmd{man lsof}.


\section{ดู\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส}
การ\wbr{}ดู\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}ได้\wbr{}หลาย\wbr{}วิธี\wbr{}เช่น ดู\wbr{}รหัส\wbr{}ต้น\wbr{}ฉบับ\wbr{}ของ\wbr{}ซอฟต์แวร์\wbr{}นั้นๆ, ถ้า\wbr{}เป็น\wbr{}โปรแกรม\wbr{}ที่\wbr{}คอมไพล์\wbr{}เอง\wbr{}ก็\wbr{}อาจ\wbr{}จะ\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก\wbr{}เวลา\wbr{}คอมไพล์\wbr{}โปรแกรม\wbr{}ให้ debug ดู\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ได้\wbr{}ภาย\wbr{}หลัง. วิธี\wbr{}การ\wbr{}เหล่า\wbr{}นี้\wbr{}มี\wbr{}ข้อ\wbr{}จำกัด\wbr{}คือ\wbr{}ต้อง\wbr{}มี\wbr{}ต้น\wbr{}ฉบับ\wbr{}ของ\wbr{}ซอฟต์แวร์\wbr{}จึง\wbr{}จะ\wbr{}ใช้\wbr{}วิธี\wbr{}นี้\wbr{}ได้. ทาง\wbr{}เลือก\wbr{}อีก\wbr{}ทาง\wbr{}เวลา\wbr{}ต้องการ\wbr{}ดู\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}แต่\wbr{}ไม่\wbr{}มี\wbr{}รหัส\wbr{}ต้น\wbr{}ฉบับ\wbr{}ให้\wbr{}ศึกษา, อาจ\wbr{}ทำ\wbr{}ได้\wbr{}โดย\wbr{}การ\wbr{}ดู\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}นั้นๆ\wbr{}เรียก\wbr{}ใช้\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}อะไร. เรา\wbr{}เรียก\wbr{}วิธี\wbr{}นี้\wbr{}ว่า\wbr{}การ trace จะ\wbr{}ทำ\wbr{}ให้\wbr{}เรา\wbr{}รู้\wbr{}คร่าวๆ\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}ทำ\wbr{}งาน\wbr{}อย่าง\wbr{}ไร.

คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ใช้\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}เรียก\wbr{}ใช้\wbr{}คือ \cmd{strace}\cindex{strace}\refcmd{strace}. คำ\wbr{}สั่ง \cmd{strace} จะ\wbr{}แสดง\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ต่างๆ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}เรียก\wbr{}ใช้\wbr{}และ\wbr{}สัญญาณ\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}รับ. โปร\wbr{}เซส\wbr{}ที่\wbr{}ต้องการ trace เป็น\wbr{}ได้\wbr{}ทั้ง\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}รัน\wbr{}อยู่\wbr{}แล้ว, หรือ\wbr{}กำลัง\wbr{}จะ\wbr{}รัน\wbr{}จาก\wbr{}บรรทัด\wbr{}คำ\wbr{}สั่ง\wbr{}ก็\wbr{}ได้. ตัว\wbr{}อย่าง\wbr{}ต่อ\wbr{}ไป\wbr{}นี้\wbr{}จะ\wbr{}แสดง\wbr{}การ trace การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปรแกรม \cmd{cat} ซึ่ง\wbr{}มี\wbr{}อาร์กิวเ\wbr{}มนต์\wbr{}เป็น\wbr{}ไฟล์\wbr{}ชื่อ \cmd{hello.txt}.

\begin{MyExample}[การ\wbr{}ใช้ \cmd{strace} ดู\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส.]
\begin{MyEx}
$ \cin{cat hello.txt}
hello
$ \cin{strace cat hello.txt}
execve("/bin/cat", ["cat", "hello.txt"], [/* 57 vars */]) = 0
uname({sys="Linux", node="toybox", ...}) = 0
brk(0)                                  = 0x804d000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY)      = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=150692, ...}) = 0
mmap2(NULL, 150692, PROT_READ, MAP_PRIVATE, 3, 0) = 0x40017000
close(3)                                = 0
open("/lib/tls/libc.so.6", O_RDONLY)    = 3
read(3, "\bs{}177ELF\bs{}1\bs{}1\bs{}1\bs{}0\bs{}0\bs{}0\bs{}0\bs{}0\bs{}0\bs{}0\bs{}0\bs{}0\bs{}3\bs{}0\bs{}3\bs{}0\bs{}1\bs{}0\bs{}0\bs{}0\bs{}275P\bs{}1"..., 512) = 512
fstat64(3, {st_mode=S_IFREG|0755, st_size=1174064, ...}) = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x40\wrap
03c000
mmap2(NULL, 1105132, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x4\wrap
003d000
mmap2(0x40145000, 16384, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRI\wrap
TE, 3, 0x107) = 0x40145000
mmap2(0x40149000, 7404, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOU\wrap
S, -1, 0) = 0x40149000
close(3)                                = 0
mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x40\wrap
14b000
mprotect(0x40145000, 4096, PROT_READ)   = 0
mprotect(0x40015000, 4096, PROT_READ)   = 0
set_thread_area(\{entry_number:-1 -> 6, base_addr:0x4014b6c0, limit:1048575, seg_\wrap
32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, usea\wrap
ble:1\}) = 0
munmap(0x40017000, 150692)              = 0
open("/dev/urandom", O_RDONLY)          = 3
read(3, "\bs{}214;^\bs{}222", 4)                = 4
close(3)                                = 0
brk(0)                                  = 0x804d000
brk(0x806e000)                          = 0x806e000
fstat64(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 2), ...}) = 0
open("hello.txt", O_RDONLY|O_LARGEFILE) = 3
fstat64(3, {st_mode=S_IFREG|0644, st_size=6, ...}) = 0
read(3, "hello\bs{}n", 4096)                = 6
write(1, "hello\bs{}n", 6\textbf{hello} \mycomment{``\cmd{hello}'' แสดง\wbr{}ทาง \cmd{stdout} แทรก\wbr{}ใน \cmd{stderr}}
)                  = 6
read(3, "", 4096)                       = 0
close(3)                                = 0
close(1)                                = 0
exit_group(0)                           = ?
\end{MyEx}
\end{MyExample}

จาก\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง \cmd{strace} ทำ\wbr{}ให้\wbr{}เรา\wbr{}รู้\wbr{}ว่า\wbr{}คำ\wbr{}สั่ง \cmd{cat hello.txt} ซึ่ง\wbr{}ใช้\wbr{}อ่าน\wbr{}เนื้อ\wbr{}หา\wbr{}ที่\wbr{}อยู่\wbr{}ใน\wbr{}ไฟล์ \cmd{hello.txt} และ\wbr{}แสดง\wbr{}ผล\wbr{}ออก\wbr{}ทาง\wbr{}หน้า\wbr{}จอ\wbr{}เรียก\wbr{}ใช้\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ถึง 35 อย่าง. ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง\wbr{}จะ\wbr{}แสดง\wbr{}ทาง stderr จึง\wbr{}ไม่\wbr{}สามารถ\wbr{}ไปป์\wbr{}หรือ\wbr{}รี\wbr{}ไดเ\wbr{}รก\wbr{}บันทึก\wbr{}ใน\wbr{}ไฟล์\wbr{}ได้. ถ้า\wbr{}ต้องการ\wbr{}เก็บ\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง\wbr{}ลง\wbr{}ใน\wbr{}ไฟล์, ให้\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-o \textit{file}}.

ข้อ\wbr{}มูล\wbr{}ที่\wbr{}แสดง\wbr{}ใน\wbr{}แต่\wbr{}ละ\wbr{}บรรทัด\wbr{}ได้\wbr{}แก่\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ซึ่ง\wbr{}ก็\wbr{}คือ\wbr{}ฟังก์ชัน\wbr{}ใน\wbr{}ภาษา C, อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}ฟังก์ชัน, และ\wbr{}ค่า\wbr{}ตอบ\wbr{}กลับ\wbr{}ของ\wbr{}ฟังก์ชัน\wbr{}นั้น. บรรทัด\wbr{}แรก\wbr{}ได้\wbr{}แก่\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{execve}\mymemo{ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{execve}}. ถ้า\wbr{}ต้องการ\wbr{}รู้\wbr{}ความ\wbr{}หมาย\wbr{}ของ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}นี้\wbr{}ก็\wbr{}ให้\wbr{}อ่าน \cmd{man 2 execve} ก็\wbr{}จะ\wbr{}รู้\wbr{}เป็น\wbr{}การ\wbr{}รัน\wbr{}โปรแกรม \cmd{/bin/cat} มี\wbr{}อาร์กิวเ\wbr{}มนต์\wbr{}เป็น\wbr{}สาย\wbr{}อักขระ\wbr{}ได้\wbr{}แก่ \cmd{cat} และ \cmd{hello.txt}. และ\wbr{}มี\wbr{}ตัวแปร\wbr{}สภาพ\wbr{}แวด\wbr{}ล้อม\wbr{}อีก 57 ตัว\wbr{}ซึ่ง\wbr{}ไม่\wbr{}ได้\wbr{}แสดง\wbr{}ใน\wbr{}ที่\wbr{}นี้\wbr{}เป็น\wbr{}อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์. ตัว\wbr{}เลข\wbr{}ที่\wbr{}อยู่\wbr{}หลัง\wbr{}เครื่อง\wbr{}หมาย = คือ\wbr{}ค่า\wbr{}ตอบ\wbr{}กลับ\wbr{}ของ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ใน\wbr{}กรณี\wbr{}นี้\wbr{}มี\wbr{}ค่า\wbr{}เป็น 0.

การ\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}ยัง\wbr{}ทำ\wbr{}ให้\wbr{}รู้\wbr{}อี\wbr{}กว่า\wbr{}โปร\wbr{}เซส\wbr{}นั้น\wbr{}พยายาม\wbr{}จะ\wbr{}เข้า\wbr{}ถึง\wbr{}ไฟล์\wbr{}อะไร, อย่าง\wbr{}ไร, และ\wbr{}เกิด\wbr{}อะไร\wbr{}ขึ้น\wbr{}ได้\wbr{}ด้วย. เช่น\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{access}\mymemo{ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{access}, \cmd{open}} ซึ่ง\wbr{}เป็น\wbr{}การ\wbr{}ตรวจ\wbr{}สอบ\wbr{}สิทธิ์\wbr{}การ\wbr{}ใช้\wbr{}ไฟล์\wbr{}ของ\wbr{}ไฟล์ \cmd{/etc/ld.so.preload} แต่\wbr{}มี\wbr{}ค่า\wbr{}ตอบ\wbr{}กลับ\wbr{}เป็น -1 มี\wbr{}รหัส\wbr{}เป็น ENOENT หมาย\wbr{}ถึง\wbr{}เกิด\wbr{}ข้อ\wbr{}ผิด\wbr{}พลาด\wbr{}และ\wbr{}มี\wbr{}ราย\wbr{}ละเอียด\wbr{}บอก\wbr{}ให้\wbr{}รู้\wbr{}ว่า ``No such file or directory''. ทำ\wbr{}ให้\wbr{}รู้\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}พยายาม\wbr{}จะ\wbr{}ตรวจ\wbr{}สอบ\wbr{}ไฟล์\wbr{}นี้\wbr{}แต่\wbr{}หา\wbr{}ไม่\wbr{}เจอ. บรรทัด\wbr{}ถัด\wbr{}มา\wbr{}เป็น\wbr{}ซิส\wbr{}เต็ม\wbr{}ที่\wbr{}ใช้\wbr{}บ่อย\wbr{}คือ \cmd{open}. โปร\wbr{}เซส\wbr{}พยายาม\wbr{}จะ\wbr{}เปิด\wbr{}ไฟล์ \cmd{/etc/ld.so.cache} แบบ \cmd{O\_RDONLY} คือ\wbr{}อ่าน\wbr{}อย่าง\wbr{}เดียว. ค่า\wbr{}ตอบ\wbr{}กลับ\wbr{}ของ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}จะ\wbr{}เป็น file descriptor ซึ่ง\wbr{}ใน\wbr{}กรณี\wbr{}นี้\wbr{}มี\wbr{}ค่า\wbr{}เป็น 3. อย่า\wbr{}ลืม\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}ทุก\wbr{}ตัว\wbr{}จะ\wbr{}มี file descriptor 0 (stdin), 1 (stdout), และ 2 (stderr) โดย\wbr{}ปริยาย. ดัง\wbr{}นั้น file descriptor ที่\wbr{}ได้\wbr{}จาก\wbr{}การ\wbr{}เปิด\wbr{}ไฟล์\wbr{}ใหม่\wbr{}จึง\wbr{}เป็น 3.

ต่อ\wbr{}จาก\wbr{}นั้น\wbr{}ใช้\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{fstat64}\mymemo{ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{fstat}, \cmd{mmap2}, \cmd{close}} ดึง\wbr{}ข้อ\wbr{}มูล\wbr{}เกี่ยว\wbr{}กับ\wbr{}ไฟล์\wbr{}ที่\wbr{}เปิด. เรียก\wbr{}ใช้\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{mmap2} เพื่อแม็ป\wbr{}ข้อ\wbr{}มูล\wbr{}จาก\wbr{}ไฟล์\wbr{}เข้า\wbr{}สู่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ. และ\wbr{}ปิด\wbr{}ไฟล์\wbr{}ที่\wbr{}เปิด\wbr{}ไว้\wbr{}ด้วย\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{close}. เปิด\wbr{}ไฟล์\wbr{}อื่นๆ\wbr{}และ\wbr{}กระทำ\wbr{}การ\wbr{}ต่อ\wbr{}ไป\wbr{}เรื่อยๆ.

\mymemo{ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{open}, \cmd{read}, \cmd{write}, \cmd{close}}คำ\wbr{}สั่ง \cmd{cat} ใน\wbr{}ตัว\wbr{}อย่าง\wbr{}จะ\wbr{}เปิด\wbr{}ไฟล์ \cmd{hello.txt} หลัง\wbr{}จาก\wbr{}ที่\wbr{}จัด\wbr{}การ\wbr{}ไฟล์ไ\wbr{}ลบ\wbr{}รา\wbr{}รี\wbr{}ต่างๆ\wbr{}เรียบ\wbr{}ร้อย\wbr{}แล้ว. ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}ใช้\wbr{}เปิด\wbr{}ไฟล์\wbr{}ไฟล์\wbr{}คือ \cmd{open} และ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}ใช้\wbr{}อ่าน\wbr{}ไฟล์\wbr{}คือ \cmd{read}. หลัง\wbr{}จาก\wbr{}นั้น\wbr{}เขียน\wbr{}ข้อ\wbr{}มูล\wbr{}ออก\wbr{}ทาง stdout ซึ่ง\wbr{}มี file descriptor เป็น 1 ด้วย\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์ \cmd{write}. และ\wbr{}สุด\wbr{}ท้าย\wbr{}ปิด\wbr{}ไฟล์\wbr{}ด้วย \cmd{close} และ\wbr{}จบ\wbr{}การ\wbr{}ทำ\wbr{}งาน.

\medskip
สำหรับ\wbr{}โปร\wbr{}เซส\wbr{}ที่\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}แล้ว\wbr{}และ\wbr{}ต้องการ trace โปร\wbr{}เซส\wbr{}นั้น\wbr{}ให้\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-p \textit{pid}}. บาง\wbr{}ครั้ง\wbr{}โปรแกรม\wbr{}บาง\wbr{}ตัว\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}แต่\wbr{}ดู\wbr{}เหมือน\wbr{}ไม่\wbr{}ทำ\wbr{}งาน\wbr{}หรือ\wbr{}ทำ\wbr{}งาน\wbr{}ผิด\wbr{}ปรกติ, เรา\wbr{}สามารถ trace ด้วย\wbr{}คำ\wbr{}สั่ง \cmd{strace} ดู\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}งาน\wbr{}อยู่\wbr{}จริง\wbr{}หรือ\wbr{}ไม่. หรือ\wbr{}ถ้า\wbr{}ไม่\wbr{}ทำ\wbr{}งาน, โปร\wbr{}เซส\wbr{}นั้น\wbr{}ไป\wbr{}ค้าง\wbr{}อยู่\wbr{}ตรง\wbr{}ไหน\wbr{}สามารถ\wbr{}รู้\wbr{}ได้\wbr{}จาก\wbr{}ผล\wbr{}ลัพธ์\wbr{}ของ\wbr{}คำ\wbr{}สั่ง. โปร\wbr{}เซส\wbr{}บาง\wbr{}ตัว\wbr{}อาจ\wbr{}จะ fork โปร\wbr{}เซส\wbr{}ลูก. ใน\wbr{}กรณี\wbr{}นี้\wbr{}คำ\wbr{}สั่ง \cmd{strace} จะ\wbr{}ไม่ trace ดู\wbr{}ไป\wbr{}ถึง\wbr{}โปร\wbr{}เซส\wbr{}ลูก\wbr{}ว่า\wbr{}ทำ\wbr{}อะไร\wbr{}บ้าง\wbr{}ต้อง\wbr{}ใช้\wbr{}ตัว\wbr{}เลือก \cmd{-f} มิ\wbr{}ฉะนั้น\wbr{}คำ\wbr{}สั่ง\wbr{}จะ trace เฉพาะ\wbr{}โปร\wbr{}เซส\wbr{}แม่\wbr{}ที่\wbr{}ดู\wbr{}เท่า\wbr{}นั้น.

ตัว\wbr{}เลือก\wbr{}ที่\wbr{}มี\wbr{}ประโยชน์\wbr{}อีก\wbr{}ตัว\wbr{}ได้\wbr{}แก่ \cmd{-e} ใช้\wbr{}เลือก\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}หรือ\wbr{}เหตุ\wbr{}การณ์\wbr{}ที่\wbr{}ต้องการ\wbr{}ดู. อาร์กิวเ\wbr{}มนต์\wbr{}ของ\wbr{}ตัว\wbr{}เลือก \cmd{-e} เป็น\wbr{}ได้\wbr{}ทั้ง\wbr{}ชื่อ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}ต้องการ\wbr{}จับ\wbr{}ตา\wbr{}ดู\wbr{}หรือ\wbr{}ชื่อ\wbr{}เหตุ\wbr{}การณ์\wbr{}ที่\wbr{}เตรียม\wbr{}ไว้\wbr{}อยู่\wbr{}แล้ว\wbr{}ใน\wbr{}ตา\wbr{}ราง\wbr{}ที่ \ref{tab:strace}.

\begin{table}[htb]
\center
\caption{ตัว\wbr{}เลือก\wbr{}ของ \cmd{strace} สำหรับ\wbr{}เลือก\wbr{}เหตุ\wbr{}การณ์\wbr{}ที่\wbr{}ต้องการ.}\label{tab:strace}
\begin{tabular}{lp{.7\textwidth}}
\toprule
\multicolumn{1}{c}{ตัว\wbr{}เลือก} & \multicolumn{1}{c}{คำ\wbr{}อธิบาย}\\
\midrule
\cmd{-e trace=file} & สำรวจ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}ไฟล์\wbr{}เช่น \cmd{open}, \cmd{stat}, \cmd{chmod} ฯลฯ.\\
\cmd{-e trace=process} & สำรวจ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}การ\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\wbr{}เช่น \cmd{fork}, \cmd{wait}, \cmd{exec} ฯลฯ.\\
\cmd{-e trace=network} & สำรวจ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับเน็ตเ\wbr{}วิร์ก.\\
\cmd{-e trace=signal} & สำรวจ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}สัญญาณ.\\
\cmd{-e trace=ipc} & สำรวจ\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ IPC (Inter Process Communication)\\
\cmd{-e trace=\textit{syscall}} & เลือก\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}ระบุ. เช่น\wbr{}ถ้า\wbr{}ต้องการ\wbr{}ดู\wbr{}ว่า\wbr{}โปร\wbr{}เซส\wbr{}เปิด\wbr{}ไฟล์\wbr{}อะไร\wbr{}บ้าง\wbr{}ให้\wbr{}ใช้ \cmd{-e trace=open}.\\
\bottomrule
\end{tabular}
\end{table}



การ\wbr{}ใช้\wbr{}คำ\wbr{}สั่ง \cmd{strace} นอก\wbr{}จาก\wbr{}จะ\wbr{}เป็น\wbr{}ดู\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}โดย\wbr{}อาศัย\wbr{}การ\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}แล้ว\wbr{}ยัง\wbr{}มี\wbr{}ประโยชน์\wbr{}ใน\wbr{}การ debug โปรแกรม\wbr{}ใน\wbr{}กรณี\wbr{}ที่\wbr{}เกิด error โดย\wbr{}ไม่\wbr{}รู้\wbr{}สาเหตุ\wbr{}อีก\wbr{}ด้วย.

\section{สรุป\wbr{}ท้าย\wbr{}บท}
%\section{สำรวจ\wbr{}ฮาร์ดแวร์}
%lspci dmesg lpinfo lsdev lsusb hdparam
\begin{itemize}
\item โปร\wbr{}เซส\wbr{}คือ\wbr{}โปรแกรม\wbr{}ที่โ\wbr{}หลด\wbr{}เข้า\wbr{}สู่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เพื่อ\wbr{}กระทำ\wbr{}การ\wbr{}โดย\wbr{}ที่เ\wbr{}คอร์เนล\wbr{}เป็น\wbr{}ตัว\wbr{}ควบ\wbr{}คุม\wbr{}โปร\wbr{}เซส\wbr{}ใน\wbr{}ระบบ.
\item โปร\wbr{}เซส\wbr{}แต่\wbr{}ละ\wbr{}ตัว\wbr{}จะ\wbr{}มี\wbr{}พื้น\wbr{}ที่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}ของ\wbr{}ตัว\wbr{}เอง. ที่\wbr{}อยู่\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}จะ\wbr{}ถูก\wbr{}แปลง\wbr{}ไป\wbr{}เป็น\wbr{}ที่\wbr{}อยู่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}เมื่อ\wbr{}ใช้. ที่\wbr{}อยู่\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}ไม่\wbr{}จำ\wbr{}เป็น\wbr{}ต้อง\wbr{}อยู่\wbr{}ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}จริง\wbr{}ทุก\wbr{}ส่วน. ที่\wbr{}อยู่\wbr{}ของ\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}เสมือน\wbr{}บาง\wbr{}ส่วย\wbr{}อาจ\wbr{}จะ\wbr{}อยู่\wbr{}ใน\wbr{}พื้น\wbr{}ที่ swap ใน\wbr{}หน่วย\wbr{}ความ\wbr{}จำ\wbr{}ถาวร.
\item สัญญาณ\wbr{}เป็น\wbr{}วิธี\wbr{}การ\wbr{}สื่อ\wbr{}สาร\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส. เมื่อ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}รับ\wbr{}สัญญาณ\wbr{}หนึ่งๆ\wbr{}จะ\wbr{}มี\wbr{}การ\wbr{}ตอบ\wbr{}สนอง\wbr{}ต่อ\wbr{}สัญญาณ\wbr{}ที่\wbr{}ได้\wbr{}รับ. บาง\wbr{}สัญญาณ\wbr{}ที่\wbr{}ได้\wbr{}รับ\wbr{}อาจ\wbr{}ปฏิบัติ\wbr{}เพิกเฉย\wbr{}การ\wbr{}ตอบ\wbr{}สนอง\wbr{}ได้\wbr{}โดย\wbr{}การ\wbr{}สร้าง signal trap. สัญญาณ\wbr{}ที่\wbr{}ไม่\wbr{}สามารถ\wbr{}เพิกเฉย\wbr{}ได้\wbr{}แก่ SIGSTOP, SIGKILL.
\item คำ\wbr{}สั่ง\wbr{}สำคัญ\wbr{}ที่\wbr{}เกี่ยว\wbr{}กับ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}แก่ \cmd{ps}, \cmd{kill}, \cmd{top}
\item คำ\wbr{}สั่ง\wbr{}ที่\wbr{}ใช้\wbr{}ตรวจ\wbr{}สอบ\wbr{}ความ\wbr{}สัมพันธ์\wbr{}ระหว่าง\wbr{}โปร\wbr{}เซส\wbr{}และ\wbr{}ไฟล์\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}ได้\wbr{}แก่ \cmd{fuser} และ \cmd{lsof}.
\item คำ\wbr{}สั่ง \cmd{strace} ใช้\wbr{}สำหรับ\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}เรียก\wbr{}ใช้. การ\wbr{}ดู\wbr{}ซิส\wbr{}เต็ม\wbr{}คอลล์\wbr{}ที่\wbr{}โปร\wbr{}เซส\wbr{}ใช้\wbr{}ช่วย\wbr{}ให้\wbr{}เข้า\wbr{}ใจ\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}คร่าวๆ. สามารถ\wbr{}ใช้\wbr{}ใน\wbr{}การ\wbr{}แก้\wbr{}ปัญหา\wbr{}การ\wbr{}ทำ\wbr{}งาน\wbr{}ของ\wbr{}โปร\wbr{}เซส\wbr{}ได้\wbr{}ด้วย\wbr{}เช่น\wbr{}การ debug โปรแกรม\wbr{}เมื่อ\wbr{}เกิด\wbr{}ข้อ\wbr{}ผิด\wbr{}พลาด\wbr{}หรือ\wbr{}โปร\wbr{}เซส\wbr{}ทำ\wbr{}งาน\wbr{}ผิด\wbr{}ปรกติ.
\end{itemize}

%\section{แบบ\wbr{}ฝึก\wbr{}หัด\wbr{}และ\wbr{}คำ\wbr{}ถาม\wbr{}ทบ\wbr{}ทวน\wbr{}ความ\wbr{}เข้า\wbr{}ใจ}
%\begin{description}
%\myprac จง\wbr{}เขียน\wbr{}คำ\wbr{}สั่ง\wbr{}บรรทัด\wbr{}เดียว\wbr{}โดย\wbr{}ใช้ \cmd{kill} และ \cmd{grep} ฆ่า\wbr{}โปร\wbr{}เซส\wbr{}ตาม\wbr{}ชื่อ\wbr{}ที่\wbr{}ระบุ.\pageref{q_5_1}
%\end{description}
